

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Scientific software engineering with a simple ODE model as example</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/sidebar.js"></script>

        <script src="http://sagecell.sagemath.org/static/jquery.min.js"></script>
        <script src="http://sagecell.sagemath.org/static/embedded_sagecell.js"></script>

        <script>sagecell.makeSagecell({inputLocation: ".sage"});</script>

        <style type="text/css">
                .sagecell .CodeMirror-scroll {
                        overflow-y: hidden;
                        overflow-x: auto;
                }
                .sagecell .CodeMirror {
                        height: auto;
                }
        </style>

    
    <link rel="top" title="Scientific software engineering with a simple ODE model as example" href="index.html" />
    <link rel="next" title="Bibliography" href="._main_softeng1001.html" />
    <link rel="prev" title="Scientific software engineering with a simple ODE model as example" href="index.html" />
 
  
   <style type="text/css">
     div.admonition {
       background-color: whiteSmoke;
       border: 1px solid #bababa;
     }
   </style>
  </head>

  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="._main_softeng1001.html" title="Bibliography"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Scientific software engineering with a simple ODE model as example"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Scientific software engineering with a simple ODE model as example</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="scientific-software-engineering-with-a-simple-ode-model-as-example">
<h1>Scientific software engineering with a simple ODE model as example<a class="headerlink" href="#scientific-software-engineering-with-a-simple-ode-model-as-example" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Authors:</th><td class="field-body">Hans Petter Langtangen</td>
</tr>
<tr class="field-even field"><th class="field-name">Date:</th><td class="field-body">Mar 21, 2015</td>
</tr>
</tbody>
</table>
<p>Teaching material on scientific computing has traditionally been very
focused on the mathematics and the applications, while details on how
the computer is programmed to solve the problems have received little attention.
Many end up writing as simple programs as possible and are
not aware of much useful computer science technology that would increase
the fun, efficiency, and reliability of the their scientific computing
activities.</p>
<p>This document demonstrates a series of good practices and tools
from modern computer science, using a very simple mathematical problem
with a very simple implementation such that we minimize the
mathematical details.  Our goal is to increase the technological
quality of computer programming and make it match the more
well-established quality of the mathematics of scientific computing.</p>
<p>More specifically we address the following scientific topics:</p>
<blockquote>
<div><ul class="simple">
<li>How to structure a code in terms of functions</li>
<li>How to make a module</li>
<li>How to read input data flexibly from the command line</li>
<li>How to create graphical/web user interfaces</li>
<li>How to write unit tests (test functions or doctests)</li>
<li>How to refactor code in terms of classes (instead of functions only)</li>
<li>How to conduct and automate large-scale numerical experiments</li>
<li>How to write scientific reports in various formats (LaTeX, HTML)</li>
</ul>
</div></blockquote>
<p>The conventions and techniques outlined here will save you a lot of time
when you incrementally extend software over time from simpler to more
complicated problems. In particular, you will benefit from
many good habits:</p>
<blockquote>
<div><ul class="simple">
<li>new code is added in a modular fashion to a library (modules),</li>
<li>programs are run through convenient user interfaces,</li>
<li>it takes one quick command to let all your code can undergo heavy testing,</li>
<li>tedious manual work with running programs is automated,</li>
<li>your scientific investigations are reproducible,</li>
<li>scientific reports with top quality typesetting are written both
for paper and electronic devices.</li>
</ul>
</div></blockquote>
<div class="section" id="basic-implementations">
<span id="softeng1-basic"></span><h2>Basic implementations<a class="headerlink" href="#basic-implementations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="mathematical-problem-and-solution-technique">
<span id="softeng1-basic-math"></span><h3>Mathematical problem and solution technique<a class="headerlink" href="#mathematical-problem-and-solution-technique" title="Permalink to this headline">¶</a></h3>
<p>We address the perhaps simplest possible differential equation problem</p>
<div class="math" id="equation-softeng1:ode">
<span id="eq-softeng1-ode"></span><span class="eqno">(1)</span>\[     u'(t) = -au(t), \quad t \in (0,T],\]</div>
<div class="math" id="equation-softeng1:u0">
<span id="eq-softeng1-u0"></span><span class="eqno">(2)</span>\[     u(0)  = I,\]</div>
<p>where <span class="math">\(a\)</span>, <span class="math">\(I\)</span>, and <span class="math">\(T\)</span> are prescribed parameters, and <span class="math">\(u(t)\)</span> is
the unknown function to be estimated. This mathematical model
is relevant for physical phenomena featuring exponential decay
in time, e.g., vertical pressure variation in the atmosphere,
cooling of an object, and radioactive decay.</p>
<p>The time domain is discretized with points <span class="math">\(0 = t_0 &lt; t_1 \cdots &lt; t_{N_t}=T\)</span>,
here with a constant spacing <span class="math">\(\Delta t\)</span> between the
mesh points: <span class="math">\(\Delta t = t_{n}-t_{n-1}\)</span>, <span class="math">\(n=1,\ldots,N_t\)</span>. Let
<span class="math">\(u^n\)</span> be the numerical approximation to the exact solution at <span class="math">\(t_n\)</span>.
A family of popular numerical methods can be written in the form</p>
<div class="math" id="equation-softeng1:utheta">
<span id="eq-softeng1-utheta"></span><span class="eqno">(3)</span>\[     u^{n+1} = \frac{1 - (1-\theta) a\Delta t}{1 + \theta a\Delta t}u^n,\]</div>
<p>for <span class="math">\(n=0,1,\ldots,N_t-1\)</span>. This numerical scheme corresponds to
the <a class="reference external" href="http://en.wikipedia.org/wiki/Forward_Euler_method">Forward Euler</a>
scheme when <span class="math">\(\theta=0\)</span>,
the <a class="reference external" href="http://en.wikipedia.org/wiki/Backward_Euler_method">Backward Euler</a>
scheme when <span class="math">\(\theta=1\)</span>,
and the <a class="reference external" href="http://en.wikipedia.org/wiki/Crank-Nicolson">Crank-Nicolson</a>
scheme when <span class="math">\(\theta=1/2\)</span>.
The initial condition <a href="#equation-softeng1:u0">(2)</a> is key to start
the recursion with a value for <span class="math">\(u^0\)</span>.</p>
</div>
<div class="section" id="a-first-quick-implementation">
<span id="softeng1-basic-impl1"></span><h3>A first, quick implementation<a class="headerlink" href="#a-first-quick-implementation" title="Permalink to this headline">¶</a></h3>
<p>Solving <a href="#equation-softeng1:utheta">(3)</a> in a program is very straightforward:
just make a loop over <span class="math">\(n\)</span> and evaluate the formula. The <span class="math">\(u(t_n\)</span>)
values for discrete <span class="math">\(n\)</span> can be stored in an array. This makes it easy
to also plot the solution. We may with little work add the exact
solution <span class="math">\(u(t)=Ie^{-at}\)</span> to the plot. A typical program is listed
below.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">A</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">dt</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">theta</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">theta</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

<span class="n">y_e</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">y_e</span> <span class="o">-</span> <span class="n">y</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="k">print</span> <span class="s">&#39;Norm of the error: </span><span class="si">%.3E</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">E</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&#39;r--o&#39;</span><span class="p">)</span>
<span class="n">t_e</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>
<span class="n">y_e</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t_e</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">y_e</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">([</span><span class="s">&#39;numerical, theta=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">theta</span><span class="p">,</span> <span class="s">&#39;exact&#39;</span><span class="p">])</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>This program is very easy to read, and as long it is correct, many will
claim that it has sufficient quality. Nevertheless, this program suffers
from serious bad habits that might be crucial for writing correct
programs for more complicated mathematical problems. First we list
two really serious issues:</p>
<ol class="arabic simple">
<li>The notation in the program does not correspond exactly to
the notation in the mathematical problem: the solution is called
<tt class="docutils literal"><span class="pre">y</span></tt> and corresponds to <span class="math">\(u\)</span> in the mathematical description,
the variable <tt class="docutils literal"><span class="pre">A</span></tt> corresponds to the mathematical parameter <span class="math">\(I\)</span>,
<tt class="docutils literal"><span class="pre">N</span></tt> in the program is called <span class="math">\(N_t\)</span> in the mathematics.</li>
<li>There are no comments in the program.</li>
</ol>
<p>Fixing notation and comments results in</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">I</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">Nt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">dt</span><span class="p">))</span>     <span class="c"># no of time intervals</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>           <span class="c"># array of u[n] values</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># time mesh</span>
<span class="n">theta</span> <span class="o">=</span> <span class="mi">1</span>                 <span class="c"># Backward Euler method</span>

<span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span>                  <span class="c"># assign initial condition</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nt</span><span class="p">):</span>    <span class="c"># n=0,1,...,Nt-1</span>
    <span class="n">u</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">theta</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

<span class="c"># Compute norm of the error</span>
<span class="n">u_e</span> <span class="o">=</span> <span class="n">I</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">u</span>     <span class="c"># exact u at the mesh points</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">u_e</span> <span class="o">-</span> <span class="n">u</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="k">print</span> <span class="s">&#39;Norm of the error: </span><span class="si">%.3E</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">E</span>

<span class="c"># Compare numerical (u) and exact solution (u_e) in a plot</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="s">&#39;r--o&#39;</span><span class="p">)</span>               <span class="c"># red dashes w/circles</span>
<span class="n">t_e</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>       <span class="c"># very fine mesh for u_e</span>
<span class="n">u_e</span> <span class="o">=</span> <span class="n">I</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t_e</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">u_e</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>             <span class="c"># blue line for u_e</span>
<span class="n">legend</span><span class="p">([</span><span class="s">&#39;numerical, theta=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">theta</span><span class="p">,</span> <span class="s">&#39;exact&#39;</span><span class="p">])</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>At first sight, this is a good starting point for playing around
with the example: we can just change parameters and rerun.
Let us embed the program in an IPython notebook such that we
can get the plot up in the notebook, see Figure <a class="reference internal" href="#softeng1-ipynb"><em>Flat experimental code in a notebook</em></a>.</p>
<div class="figure" id="softeng1-ipynb">
<a class="reference internal image-reference" href="_images/ipynb_flat.png"><img alt="_images/ipynb_flat.png" src="_images/ipynb_flat.png" style="width: 700px;" /></a>
<p class="caption"><em>Flat experimental code in a notebook</em></p>
</div>
<p>Although such an interactive session is good for initial exploration,
one will soon extend the experiments and start developing the code
further. Say we want to compare <span class="math">\(\theta =0,1,0.5\)</span> in the same
plot. This extension requires changes all over the code and quickly
lead to errors. To do something serious with
this program we have to break it into smaller pieces and make sure
each piece is well tested, is general, and can be reused in new
contexts without changes.
The next natural step is therefore to isolate the numerical computations and
the visualization in separate functions.</p>
</div>
<div class="section" id="isolating-the-numerical-algorithm-in-a-function">
<span id="softeng1-basic-func"></span><h3>Isolating the numerical algorithm in a function<a class="headerlink" href="#isolating-the-numerical-algorithm-in-a-function" title="Permalink to this headline">¶</a></h3>
<p>The solution formula <a href="#equation-softeng1:utheta">(3)</a> is completely general and
should be available as a Python function with all input data as
function arguments and all output data returned to the calling code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Solve u&#39;=-a*u, u(0)=I, for t in (0,T] with steps of dt.&quot;&quot;&quot;</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>               <span class="c"># avoid integer division</span>
    <span class="n">Nt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">dt</span><span class="p">))</span>        <span class="c"># no of time intervals</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">Nt</span><span class="o">*</span><span class="n">dt</span>                    <span class="c"># adjust T to fit time step dt</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>           <span class="c"># array of u[n] values</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># time mesh</span>

    <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span>                  <span class="c"># assign initial condition</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nt</span><span class="p">):</span>    <span class="c"># n=0,1,...,Nt-1</span>
        <span class="n">u</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">theta</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">u</span><span class="p">,</span> <span class="n">t</span>
</pre></div>
</div>
<div class="admonition-tip-always-use-a-doc-string-to-document-a-function admonition">
<p class="first admonition-title">Tip: Always use a doc string to document a function</p>
<p class="last">Python has a convention for documenting the purpose and usage of
a function in a <em>doc string</em>: simply place the documentation
in a one- or multi-line triple-quoted string right after the
function header.</p>
</div>
<div class="admonition-be-careful-with-unintended-integer-division admonition">
<p class="first admonition-title">Be careful with unintended integer division</p>
<p class="last">Note that we in the <tt class="docutils literal"><span class="pre">solver</span></tt> function explicitly covert <tt class="docutils literal"><span class="pre">dt</span></tt> to a
<tt class="docutils literal"><span class="pre">float</span></tt> object. If not, the updating formula for <tt class="docutils literal"><span class="pre">u[n+1]</span></tt> may evaluate
to zero because of integer division when <tt class="docutils literal"><span class="pre">theta</span></tt>, <tt class="docutils literal"><span class="pre">a</span></tt>, and <tt class="docutils literal"><span class="pre">dt</span></tt> are integers!</p>
</div>
<p>With the aid of the <tt class="docutils literal"><span class="pre">solver</span></tt> function, we can solve any problem
of the type <a href="#equation-softeng1:ode">(1)</a>-<a href="#equation-softeng1:u0">(2)</a> by a one-line
statement:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<p>One of the most serious flaws in computational work is to have several
slightly different implementations of the same computational algorithms
lying around in various program files. This is very likely to happen,
because busy scientists often want to test a slight variation of a code to see
what happens. A quick copy and edit do the task, but such quick hacks have
a tendency to survive. When a real correction is needed in the implementation,
it is difficult to ensure that the correction is done in all relevant files.
In fact, this is a general problem in programming, which has led to
an important principle.</p>
<div class="admonition-the-dry-principle-don-t-repeat-yourself admonition">
<p class="first admonition-title">The DRY principle: Don&#8217;t repeat yourself</p>
<p class="last">When implementing a particular functionality in a computer program, make sure
this functionality and its variations are implemented in just one piece
of code. That is, if you need to revise the implementation, there should be
<em>one and only one</em> place to edit. It follows that you should never
duplicate code (don&#8217;t repeat yourself!), and code snippets that are
similar should be factored into one piece (function) and parameterized (by
function arguments).</p>
</div>
</div>
<div class="section" id="making-a-module">
<span id="softeng1-basic-module"></span><h3>Making a module<a class="headerlink" href="#making-a-module" title="Permalink to this headline">¶</a></h3>
<p>As soon as you start making Python functions in a program, you should
make sure the program file fulfills the requirement of a module.
This means that you can import and reuse your functions in other
programs too. For example, if our <tt class="docutils literal"><span class="pre">solver</span></tt> function resides in a
module <tt class="docutils literal"><span class="pre">decay</span></tt> in a module file <tt class="docutils literal"><span class="pre">decay.py</span></tt>, we can in any program
do</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">decay</span> <span class="kn">import</span> <span class="n">solver</span>
<span class="c"># Solve a decay problem</span>
<span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<p>or prefix function names by the module name:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">decay</span>
<span class="c"># Solve a decay problem</span>
<span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">decay</span><span class="o">.</span><span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<p>The requirements for a program to qualify for a module are simple:</p>
<ol class="arabic simple">
<li>The filename without <tt class="docutils literal"><span class="pre">.py</span></tt> must be a valid Python variable name.</li>
<li>The main program must be executed (through statements or
a function call) in the <em>test block</em>.</li>
</ol>
<p>The <em>test block</em> is normally placed at the end of a module file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c"># Statements</span>
</pre></div>
</div>
<p>When the module file is executed as a stand-alone program, the if test
is true and the indented statements are run, but when the module file
is imported, <tt class="docutils literal"><span class="pre">__name__</span></tt> equals the module name and the test block
is not executed.</p>
<p>To explain the importance of the test block, consider the trivial module
file <tt class="docutils literal"><span class="pre">hello.py</span></tt> with one function and a call to this function as main program:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">arg</span><span class="o">=</span><span class="s">&#39;World!&#39;</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&#39;Hello, &#39;</span> <span class="o">+</span> <span class="n">arg</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">hello</span><span class="p">()</span>
</pre></div>
</div>
<p>Without the test block,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">arg</span><span class="o">=</span><span class="s">&#39;World!&#39;</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&#39;Hello, &#39;</span> <span class="o">+</span> <span class="n">arg</span>

<span class="n">hello</span><span class="p">()</span>
</pre></div>
</div>
<p>any attempt to import <tt class="docutils literal"><span class="pre">hello</span></tt> will also execute the call <tt class="docutils literal"><span class="pre">hello()</span></tt> and
hence write <cite>Hello, World!&#8217; to the screen.
Such output is not desired when importing a module! However,
with the test block, ``hello()`</cite> is not called during import, but
running the file as <tt class="docutils literal"><span class="pre">python</span> <span class="pre">hello.py</span></tt> will make the block active
and lead to the desired printing.</p>
<div class="admonition-all-coming-functions-are-placed-in-a-module admonition">
<p class="first admonition-title">All coming functions are placed in a module</p>
<p class="last">The many functions to be explained in the following text are
put in one module file <a class="reference external" href="http://tinyurl.com/nm5587k/decay/decay.py">decay.py</a>.</p>
</div>
<p>What more than the <tt class="docutils literal"><span class="pre">solver</span></tt> function is needed in our <tt class="docutils literal"><span class="pre">decay</span></tt> module
to do everything we did in the previous, flat program?
We need import statements for <tt class="docutils literal"><span class="pre">numpy</span></tt> and <tt class="docutils literal"><span class="pre">matplotlib</span></tt> as well as
another function for producing the plot. It can also be convenient
to put the exact solution in a Python function.
Our module <tt class="docutils literal"><span class="pre">decay.py</span></tt> then looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">exact_solution</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">I</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">experiment_compare_numerical_and_exact</span><span class="p">():</span>
    <span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>  <span class="n">T</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>  <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">;</span>  <span class="n">theta</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>

    <span class="n">t_e</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>       <span class="c"># very fine mesh for u_e</span>
    <span class="n">u_e</span> <span class="o">=</span> <span class="n">exact_solution</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

    <span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span>   <span class="n">u</span><span class="p">,</span>   <span class="s">&#39;r--o&#39;</span><span class="p">)</span>           <span class="c"># dashed red line with circles</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">u_e</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>             <span class="c"># blue line for u_e</span>
    <span class="n">legend</span><span class="p">([</span><span class="s">&#39;numerical, theta=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">theta</span><span class="p">,</span> <span class="s">&#39;exact&#39;</span><span class="p">])</span>
    <span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">)</span>
    <span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">)</span>
    <span class="n">plotfile</span> <span class="o">=</span> <span class="s">&#39;tmp&#39;</span>
    <span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.png&#39;</span><span class="p">);</span>  <span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.pdf&#39;</span><span class="p">)</span>

    <span class="n">error</span> <span class="o">=</span> <span class="n">exact_solution</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">u</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">print</span> <span class="s">&#39;Error norm:&#39;</span><span class="p">,</span> <span class="n">E</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">experiment_compare_numerical_and_exact</span><span class="p">()</span>
</pre></div>
</div>
<p>This module file does exactly the same as the previous, flat program,
but it becomes much easier to extend the code with other plots or
experiments in new functions.  And even more important, the numerical
algorithm is coded and tested once and for all in the <tt class="docutils literal"><span class="pre">solver</span></tt>
function, and any need to solve the mathematical problem is a matter
of one function call.</p>
</div>
<div class="section" id="prefixing-imported-functions-by-the-module-name">
<span id="softeng1-basic-modprefix"></span><h3>Prefixing imported functions by the module name<a class="headerlink" href="#prefixing-imported-functions-by-the-module-name" title="Permalink to this headline">¶</a></h3>
<p id="index-0">Import statements of the form <tt class="docutils literal"><span class="pre">from</span> <span class="pre">module</span> <span class="pre">import</span> <span class="pre">*</span></tt> import
functions and variables in <tt class="docutils literal"><span class="pre">module.py</span></tt> into the current file.
For example, when doing</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>we get mathematical functions like <tt class="docutils literal"><span class="pre">sin</span></tt> and <tt class="docutils literal"><span class="pre">exp</span></tt>
as well as MATLAB-style functions like <tt class="docutils literal"><span class="pre">linspace</span></tt> and <tt class="docutils literal"><span class="pre">plot</span></tt>,
which can be called by these well-known names.
Unfortunately, it sometimes becomes confusing to
know where a particular function comes from. Is it from <tt class="docutils literal"><span class="pre">numpy</span></tt>? Or
<tt class="docutils literal"><span class="pre">matplotlib.pyplot</span></tt>?
Or is it our own function?</p>
<p>An alternative import is</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span>
</pre></div>
</div>
<p>and such imports require functions to be prefixed by the module name, e.g.,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">u_e</span> <span class="o">=</span> <span class="n">I</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u_e</span><span class="p">)</span>
</pre></div>
</div>
<p>This is normally regarded as a better habit because it is explicitly stated
from which module a function comes from.</p>
<p>The modules <tt class="docutils literal"><span class="pre">numpy</span></tt> and <tt class="docutils literal"><span class="pre">matplotlib.pyplot</span></tt> are so frequently used,
and their full names quite tedious to write, so two standard abbreviations
have evolved in the Python scientific computing community:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">u_e</span> <span class="o">=</span> <span class="n">I</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u_e</span><span class="p">)</span>
</pre></div>
</div>
<p>A version of the <tt class="docutils literal"><span class="pre">decay_mod</span></tt> module where we use the <tt class="docutils literal"><span class="pre">np</span></tt> and <tt class="docutils literal"><span class="pre">plt</span></tt>
prefixes is found in the file
<a class="reference external" href="http://tinyurl.com/nm5587k/softeng1/decay_mod_prefix.py">decay_mod_prefix.py</a>.</p>
<p>The downside of prefixing functions by the module name is that
mathematical expressions like <span class="math">\(e^{-at}\sin(2\pi t)\)</span> get
cluttered with module names,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
<span class="c"># or</span>
<span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
<p>Such an expression looks like <tt class="docutils literal"><span class="pre">exp(-a*t)*sin(2*pi*t)</span></tt> in most
other programming languages. Similarly,
<tt class="docutils literal"><span class="pre">np.linspace</span></tt> and <tt class="docutils literal"><span class="pre">plt.plot</span></tt> look less familiar to people who are
used to MATLAB and who have not adopted Python&#8217;s prefix style.
Whether to do <tt class="docutils literal"><span class="pre">from</span> <span class="pre">module</span> <span class="pre">import</span> <span class="pre">*</span></tt> or <tt class="docutils literal"><span class="pre">import</span> <span class="pre">module</span></tt> depends
on personal taste and the problem at hand. In these writings we use
<tt class="docutils literal"><span class="pre">from</span> <span class="pre">module</span> <span class="pre">import</span></tt> in more basic, shorter programs where similarity with
MATLAB could be an advantage. Prefix of mathematical
functions in formulas is something we often avoid to obtain
a one-to-one correspondence between
mathematical formulas and the Python code.</p>
<p>Our <tt class="docutils literal"><span class="pre">decay</span></tt> module can be edited to use the module prefix for
<tt class="docutils literal"><span class="pre">matplotlib.pyplot</span></tt> and <tt class="docutils literal"><span class="pre">numpy</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">exact_solution</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">I</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">experiment_compare_numerical_and_exact</span><span class="p">():</span>
    <span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>  <span class="n">T</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>  <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">;</span>  <span class="n">theta</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>

    <span class="n">t_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>       <span class="c"># very fine mesh for u_e</span>
    <span class="n">u_e</span> <span class="o">=</span> <span class="n">exact_solution</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span>   <span class="n">u</span><span class="p">,</span>   <span class="s">&#39;r--o&#39;</span><span class="p">)</span>       <span class="c"># dashed red line with circles</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">u_e</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>         <span class="c"># blue line for u_e</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&#39;numerical, theta=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">theta</span><span class="p">,</span> <span class="s">&#39;exact&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">)</span>
    <span class="n">plotfile</span> <span class="o">=</span> <span class="s">&#39;tmp&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.png&#39;</span><span class="p">);</span>  <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.pdf&#39;</span><span class="p">)</span>

    <span class="n">error</span> <span class="o">=</span> <span class="n">exact_solution</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">u</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">print</span> <span class="s">&#39;Error norm:&#39;</span><span class="p">,</span> <span class="n">E</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">experiment_compare_numerical_and_exact</span><span class="p">()</span>
</pre></div>
</div>
<p>We remark that some would prefer to get rid of the prefix in
mathematical formulas:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">exp</span><span class="p">,</span> <span class="nb">sum</span><span class="p">,</span> <span class="n">sqrt</span>

<span class="k">def</span> <span class="nf">exact_solution</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">I</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

<span class="n">error</span> <span class="o">=</span> <span class="n">exact_solution</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">u</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="comparing-numerical-schemes-in-one-plot">
<span id="softeng1-basic-experiment2"></span><h3>Comparing numerical schemes in one plot<a class="headerlink" href="#comparing-numerical-schemes-in-one-plot" title="Permalink to this headline">¶</a></h3>
<p>Let us specifically demonstrate one extension of the
flat program in Section ref
that would require substantial editing of the flat code, while
in a structured module, we can simply add a new function without
affecting the existing code and with reusing the implementation
of the numerics.</p>
<p>Our aim is to make a comparison between the numerical solutions
for various schemes (<span class="math">\(\theta\)</span> values) and the exact solution:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/compare.png"><img alt="_images/compare.png" src="_images/compare.png" style="width: 600px;" /></a>
</div>
<div class="admonition-stop-a-minute admonition">
<p class="first admonition-title">Stop a minute</p>
<p class="last">Look at the flat program in
the section <a class="reference internal" href="#softeng1-basic-impl1"><em>A first, quick implementation</em></a>,
and try to imagine which edits that are required to solve this new problem.</p>
</div>
<p>With the <tt class="docutils literal"><span class="pre">solver</span></tt> function at hand, we can simply create a function
with a loop over <tt class="docutils literal"><span class="pre">theta</span></tt> values and add the necessary plot statements:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">experiment_compare_schemes</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Compare theta=0,1,0.5 in the same plot.&quot;&quot;&quot;</span>
    <span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>  <span class="n">T</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>  <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.4</span>
    <span class="n">legends</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]:</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="s">&#39;--o&#39;</span><span class="p">)</span>            <span class="c"># dashed lines with circles</span>
        <span class="n">legends</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;theta=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">theta</span><span class="p">)</span>
    <span class="n">t_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>       <span class="c"># very fine mesh for u_e</span>
    <span class="n">u_e</span> <span class="o">=</span> <span class="n">exact_solution</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">u_e</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>             <span class="c"># blue line for u_e</span>
    <span class="n">legends</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;exact&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legends</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s">&#39;upper right&#39;</span><span class="p">)</span>
    <span class="n">plotfile</span> <span class="o">=</span> <span class="s">&#39;tmp&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.png&#39;</span><span class="p">);</span>  <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.pdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>A call to this <tt class="docutils literal"><span class="pre">experiment_compare_schemes</span></tt> function must be placed
in the test block, or you can run the program from IPython instead:</p>
<div class="highlight-ipy"><div class="highlight"><pre><span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">decay</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">experiment_compare_schemes</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="user-interfaces">
<h2>User interfaces<a class="headerlink" href="#user-interfaces" title="Permalink to this headline">¶</a></h2>
<p>It is good programming practice to let programs read input from the
user rather than require the user to edit the source code when trying
out new values of input parameters. One reason is that any edit of the
code has a danger of introducing bugs. Another reason is that it is
easier and less manual work to supply data to a program instead of
editing the program code. A third reason is that a program that reads
input can easily be run by another program, and in this way we can
automate a large number of runs in scientific investigations.</p>
<p>Reading input data can be done in many ways. We have to decide on a
desired <em>user interface</em>, i.e., how we want to operate the program
when providing input, and then use appropriate tools to implement
the user interface. There are four basic types of user interface
of relevance to our programs, listed here with increasing complexity
of the implementation:</p>
<ol class="arabic simple">
<li>Questions and answers in the terminal window</li>
<li>Command-line arguments</li>
<li>Reading data from file</li>
<li>Graphical user interfaces (GUIs)</li>
</ol>
<p>Below, we shall address alternative 2 and 4, which are most
appropriate for the present problem and also in general the most
popular types of user interfaces.</p>
<div class="section" id="command-line-arguments">
<h3>Command-line arguments<a class="headerlink" href="#command-line-arguments" title="Permalink to this headline">¶</a></h3>
<p>The command-line arguments are all the words that appear on the
command line after the program name. Running a program <tt class="docutils literal"><span class="pre">prog</span></tt>
as <tt class="docutils literal"><span class="pre">prog</span> <span class="pre">arg1</span> <span class="pre">arg2</span></tt> means that there are two command-line arguments
(separated by white space): <tt class="docutils literal"><span class="pre">arg1</span></tt> and <tt class="docutils literal"><span class="pre">arg2</span></tt>.
Python stores all the command-line arguments in
the list <tt class="docutils literal"><span class="pre">sys.argv</span></tt>, and there are, in principle, two ways of programming with
command-line arguments in Python:</p>
<blockquote>
<div><ul class="simple">
<li>Decide upon a sequence of parameters on the command line and read
their values directly from the <tt class="docutils literal"><span class="pre">sys.argv[1:]</span></tt> list (<tt class="docutils literal"><span class="pre">sys.argv[0]</span></tt> is
the just program name).</li>
<li>Use option-value pairs (<tt class="docutils literal"><span class="pre">--option</span> <span class="pre">value</span></tt>) on
the command line to override default values of input parameters,
and utilize the <tt class="docutils literal"><span class="pre">argparse.ArgumentParser</span></tt> tool to interact with
the command line.</li>
</ul>
</div></blockquote>
<p>Suppose we want to run our program <tt class="docutils literal"><span class="pre">decay.py</span></tt> with
specification of <span class="math">\(a\)</span> and <span class="math">\(\Delta t\)</span> on the command line.
With positional command-line arguments we write</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python decay.py 2 0.5
</pre></div>
</div>
<p>knowing that the first argument <tt class="docutils literal"><span class="pre">2</span></tt> is <tt class="docutils literal"><span class="pre">a</span></tt> (<span class="math">\(a\)</span>) and the second <cite>0.5`is
``dt`</cite> (<span class="math">\(\Delta t\)</span>).</p>
<p>With option-value pairs we can run</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python decay.py --a 2 --dt 0.5
</pre></div>
</div>
<p>Both <tt class="docutils literal"><span class="pre">a</span></tt> and <tt class="docutils literal"><span class="pre">dt</span></tt> are supposed to have default values in the program,
so we need to specify only the parameter that is to be changed from
its default value, e.g.,</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python decay.py --a 2      # a=2, default dt
Terminal&gt; python decay.py --dt 0.7   # dt-0.7, default a
Terminal&gt; python decay.py            # default a and dt
</pre></div>
</div>
<p>As example, we want to read <span class="math">\(I\)</span>, <span class="math">\(a\)</span>, <span class="math">\(T\)</span>, <span class="math">\(\theta\)</span>,
and a range of <span class="math">\(\Delta t\)</span> values from the command line.
A plot is then to be made, comparing
the different numerical solutions for different <span class="math">\(\Delta t\)</span> values
against the exact solution.</p>
</div>
<div class="section" id="positional-command-line-arguments">
<h3>Positional command-line arguments<a class="headerlink" href="#positional-command-line-arguments" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-1"></span><p id="index-2">The simplest way of reading the input parameters is to
decide on their sequence on the command line and just index
the <tt class="docutils literal"><span class="pre">sys.argv</span></tt> list accordingly.
Say the sequence is <span class="math">\(I\)</span>, <span class="math">\(a\)</span>, <span class="math">\(T\)</span>, <span class="math">\(\theta\)</span> followed by an
arbitrary number of <span class="math">\(\Delta t\)</span> values. This code extract
these <em>positional</em> command-line arguments:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">I</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">a</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">T</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">theta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
<span class="n">dt_values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">5</span><span class="p">:]]</span>
</pre></div>
</div>
<div class="admonition-command-line-arguments-are-strings admonition">
<p class="first admonition-title">Command-line arguments are strings</p>
<p class="last">Note that all elements in <tt class="docutils literal"><span class="pre">sys.argv</span></tt> are string objects.
If the values will enter mathematical computations, we need
to explicitly convert the strings to numbers.</p>
</div>
<p>Instead of specifying the <span class="math">\(\theta\)</span> value, we could be a bit more
sophisticated and let the user write the name of the scheme:
<tt class="docutils literal"><span class="pre">BE</span></tt> for Backward Euler, <tt class="docutils literal"><span class="pre">FE</span></tt> for Forward Euler, and <tt class="docutils literal"><span class="pre">CN</span></tt>
for Crank-Nicolson. Then we must map this string to the proper
<span class="math">\(\theta\)</span> value, an operation elegantly done by a dictionary:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">scheme</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<span class="n">scheme2theta</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;BE&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;CN&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s">&#39;FE&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<span class="k">if</span> <span class="n">scheme</span> <span class="ow">in</span> <span class="n">scheme2theta</span><span class="p">:</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">scheme2theta</span><span class="p">[</span><span class="n">scheme</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;Invalid scheme name:&#39;</span><span class="p">,</span> <span class="n">scheme</span><span class="p">;</span> <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="option-value-pairs-on-the-command-line">
<h3>Option-value pairs on the command line<a class="headerlink" href="#option-value-pairs-on-the-command-line" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-3"></span><span class="target" id="index-4"></span><span class="target" id="index-5"></span><span class="target" id="index-6"></span><p id="index-7">Now we want specify option-value pairs on the command line,
using <tt class="docutils literal"><span class="pre">--I</span></tt> for <tt class="docutils literal"><span class="pre">I</span></tt> (<span class="math">\(I\)</span>), <tt class="docutils literal"><span class="pre">--a</span></tt> for <tt class="docutils literal"><span class="pre">a</span></tt> (<span class="math">\(a\)</span>), <tt class="docutils literal"><span class="pre">--T</span></tt> for <tt class="docutils literal"><span class="pre">T</span></tt> (<span class="math">\(T\)</span>),
<tt class="docutils literal"><span class="pre">--scheme</span></tt> for the scheme name (<tt class="docutils literal"><span class="pre">BE</span></tt>, <tt class="docutils literal"><span class="pre">FE</span></tt>, <tt class="docutils literal"><span class="pre">CN</span></tt>),
and <tt class="docutils literal"><span class="pre">--dt</span></tt> for the sequence of <tt class="docutils literal"><span class="pre">dt</span></tt> (<span class="math">\(\Delta t\)</span>) values.
Each parameter must have a sensible default value so
that we specify the option on the command line only when the default
value is not suitable. Here is a typical run:</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python decay.py --I 2.5 --dt 0.1 0.2 0.01 --a 0.4
</pre></div>
</div>
<p>Observe the major advantage over positional command-line arguments:
the input is much easier to read and much easier to write.
With positional arguments it is easy to mess up the sequence of
the input parameters and quite challenging to detect errors too,
unless there are just a couple of arguments.</p>
<p>Python&#8217;s <tt class="docutils literal"><span class="pre">ArgumentParser</span></tt> tool in the <tt class="docutils literal"><span class="pre">argparse</span></tt> module makes it easy
to create a professional command-line interface to any program. The
documentation of <a class="reference external" href="http://docs.python.org/library/argparse.html">ArgumentParser</a> demonstrates its
versatile applications, so we shall here just list an example
containing basic features. It always pays off to use <tt class="docutils literal"><span class="pre">ArgumentParser</span></tt>
rather than trying to inspect and interpret <tt class="docutils literal"><span class="pre">sys.argv</span></tt> manually!</p>
<p>The use of <tt class="docutils literal"><span class="pre">ArgumentParser</span></tt> typically involves three steps:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>

<span class="c"># Step 1: add arguments</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--option_name&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>

<span class="c"># Step 2: interpret the command line</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="c"># Step 3: extract values</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">option_name</span>
</pre></div>
</div>
<p>A function for setting up all the options is handy:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">define_command_line_options</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">argparse</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--I&#39;</span><span class="p">,</span> <span class="s">&#39;--initial_condition&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;initial condition, u(0)&#39;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;I&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--a&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;coefficient in ODE&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--T&#39;</span><span class="p">,</span> <span class="s">&#39;--stop_time&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;end time of simulation&#39;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;T&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--scheme&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;CN&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;FE, BE, or CN&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--dt&#39;</span><span class="p">,</span> <span class="s">&#39;--time_step_values&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;time step values&#39;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;dt&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s">&#39;+&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;dt_values&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parser</span>
</pre></div>
</div>
<p>Each command-line option is defined through the <tt class="docutils literal"><span class="pre">parser.add_argument</span></tt>
method. Alternative options, like the short <tt class="docutils literal"><span class="pre">--I</span></tt> and the more
explaining version <tt class="docutils literal"><span class="pre">--initial_condition</span></tt> can be defined. Other arguments
are <tt class="docutils literal"><span class="pre">type</span></tt> for the Python object type, a default value, and a help
string, which gets printed if the command-line argument <tt class="docutils literal"><span class="pre">-h</span></tt> or <tt class="docutils literal"><span class="pre">--help</span></tt> is
included. The <tt class="docutils literal"><span class="pre">metavar</span></tt> argument specifies the value associated with
the option when the help string is printed. For example, the option for
<span class="math">\(I\)</span> has this help output:</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python decay_argparse.py -h
  ...
  --I I, --initial_condition I
                        initial condition, u(0)
  ...
</pre></div>
</div>
<p>The structure of this output is</p>
<div class="highlight-text"><div class="highlight"><pre>--I metavar, --initial_condition metavar
                      help-string
</pre></div>
</div>
<p>Finally, the <tt class="docutils literal"><span class="pre">--dt</span></tt> option demonstrates how to allow for more than one
value (separated by blanks) through the <tt class="docutils literal"><span class="pre">nargs='+'</span></tt> keyword argument.
After the command line is parsed, we get an object where the values of
the options are stored as attributes. The attribute name is specified
by the <tt class="docutils literal"><span class="pre">dist</span></tt> keyword argument, which for the <tt class="docutils literal"><span class="pre">--dt</span></tt> option is
<tt class="docutils literal"><span class="pre">dt_values</span></tt>. Without the <tt class="docutils literal"><span class="pre">dest</span></tt> argument, the value of an option <tt class="docutils literal"><span class="pre">--opt</span></tt>
is stored as the attribute <tt class="docutils literal"><span class="pre">opt</span></tt>.</p>
<p>The code below demonstrates how to read the command line and extract
the values for each option:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">read_command_line_argparse</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">define_command_line_options</span><span class="p">()</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">scheme2theta</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;BE&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;CN&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s">&#39;FE&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">scheme2theta</span><span class="p">[</span><span class="n">args</span><span class="o">.</span><span class="n">scheme</span><span class="p">],</span>
            <span class="n">args</span><span class="o">.</span><span class="n">dt_values</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>
</div>
<p>As seen, the values of the command-line options are available as
attributes in <tt class="docutils literal"><span class="pre">args</span></tt>: <tt class="docutils literal"><span class="pre">args.opt</span></tt> holds the value of option <tt class="docutils literal"><span class="pre">--opt</span></tt>, unless
we used the <tt class="docutils literal"><span class="pre">dest</span></tt> argument (as for <tt class="docutils literal"><span class="pre">--dt_values</span></tt>) for specifying the
attribute name. The <tt class="docutils literal"><span class="pre">args.opt</span></tt> attribute has the object type specified
by <tt class="docutils literal"><span class="pre">type</span></tt> (<tt class="docutils literal"><span class="pre">str</span></tt> by default).</p>
<p>The making of the plot is not dependent on whether we read data from
the command line as positional arguments or option-value pairs:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">experiment_compare_dt</span><span class="p">(</span><span class="n">option_value_pairs</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">dt_values</span> <span class="o">=</span> \
       <span class="n">read_command_line_argparse</span><span class="p">()</span> <span class="k">if</span> <span class="n">option_value_pairs</span> <span class="k">else</span> \
       <span class="n">read_command_line_positional</span><span class="p">()</span>

    <span class="n">legends</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">dt_values</span><span class="p">:</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
        <span class="n">legends</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;dt=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">dt</span><span class="p">)</span>
    <span class="n">t_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>       <span class="c"># very fine mesh for u_e</span>
    <span class="n">u_e</span> <span class="o">=</span> <span class="n">exact_solution</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">u_e</span><span class="p">,</span> <span class="s">&#39;--&#39;</span><span class="p">)</span>            <span class="c"># dashed line for u_e</span>
    <span class="n">legends</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;exact&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legends</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s">&#39;upper right&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;theta=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">theta</span><span class="p">)</span>
    <span class="n">plotfile</span> <span class="o">=</span> <span class="s">&#39;tmp&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.png&#39;</span><span class="p">);</span>  <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.pdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-graphical-web-user-interface">
<h3>Creating a graphical web user interface<a class="headerlink" href="#creating-a-graphical-web-user-interface" title="Permalink to this headline">¶</a></h3>
<p>The Python package <a class="reference external" href="https://github.com/hplgit/parampool">Parampool</a>
can be used to automatically generate a web-based <em>graphical user interface</em>
(GUI) for our simulation program. Although the programming technique
dramatically simplifies the efforts to create a GUI, the forthcoming
material on equipping our <tt class="docutils literal"><span class="pre">decay_mod</span></tt> module with a GUI is quite technical
and of significantly less importance than knowing how to make
a command-line interface.</p>
<div class="section" id="making-a-compute-function">
<h4>Making a compute function<a class="headerlink" href="#making-a-compute-function" title="Permalink to this headline">¶</a></h4>
<p>The first step is to identify a function
that performs the computations and that takes the necessary input
variables as arguments. This is called the <em>compute function</em> in
Parampool terminology. The purpose of this function is to take
values of <span class="math">\(I\)</span>, <span class="math">\(a\)</span>, <span class="math">\(T\)</span> together with a sequence of <span class="math">\(\Delta t\)</span> values
and a sequence of <span class="math">\(\theta\)</span> and plot the numerical against the
exact solution for each pair of <span class="math">\((\theta, \Delta t)\)</span>.
The plots can be arranged as a table with the columns being scheme type
(<span class="math">\(\theta\)</span> value) and the rows reflecting the discretization parameter
(<span class="math">\(\Delta t\)</span> value). Figure <a class="reference internal" href="#softeng1-fig-gui"><em>Automatically generated graphical web interface</em></a> displays of the
graphical web interface may look like after results are computed
(there are <span class="math">\(3\times 3\)</span> plots in the GUI, but only <span class="math">\(2\times 2\)</span> are
visible in the figure).</p>
<div class="figure" id="softeng1-fig-gui">
<a class="reference internal image-reference" href="_images/web_GUI.png"><img alt="_images/web_GUI.png" src="_images/web_GUI.png" style="width: 800px;" /></a>
<p class="caption"><em>Automatically generated graphical web interface</em></p>
</div>
<p>To tell Parampool what type of input data we have,
we assign default values of the right type to all arguments in the
compute function, here called <tt class="docutils literal"><span class="pre">main_GUI</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">main_GUI</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">a</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span>
             <span class="n">dt_values</span><span class="o">=</span><span class="p">[</span><span class="mf">1.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
             <span class="n">theta_values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]):</span>
</pre></div>
</div>
<p>The compute function must return the HTML code we want for displaying
the result in a web page. Here we want to show a
table of plots.
Assume for now that the HTML code for one plot and the value of the
norm of the error can be computed by some other function <tt class="docutils literal"><span class="pre">compute4web</span></tt>.
The <tt class="docutils literal"><span class="pre">main_GUI</span></tt> function can then loop over <span class="math">\(\Delta t\)</span> and <span class="math">\(\theta\)</span>
values and put each plot in an HTML table. Appropriate code goes like</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">main_GUI</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">a</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span>
             <span class="n">dt_values</span><span class="o">=</span><span class="p">[</span><span class="mf">1.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
             <span class="n">theta_values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]):</span>
    <span class="c"># Build HTML code for web page. Arrange plots in columns</span>
    <span class="c"># corresponding to the theta values, with dt down the rows</span>
    <span class="n">theta2name</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;FE&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;BE&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">:</span> <span class="s">&#39;CN&#39;</span><span class="p">}</span>
    <span class="n">html_text</span> <span class="o">=</span> <span class="s">&#39;&lt;table&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">dt_values</span><span class="p">:</span>
        <span class="n">html_text</span> <span class="o">+=</span> <span class="s">&#39;&lt;tr&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="n">theta_values</span><span class="p">:</span>
            <span class="n">E</span><span class="p">,</span> <span class="n">html</span> <span class="o">=</span> <span class="n">compute4web</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
            <span class="n">html_text</span> <span class="o">+=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">&lt;td&gt;</span>
<span class="s">&lt;center&gt;&lt;b&gt;</span><span class="si">%s</span><span class="s">, dt=</span><span class="si">%g</span><span class="s">, error: </span><span class="si">%.3E</span><span class="s">&lt;/b&gt;&lt;/center&gt;&lt;br&gt;</span>
<span class="si">%s</span><span class="s"></span>
<span class="s">&lt;/td&gt;</span>
<span class="s">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">theta2name</span><span class="p">[</span><span class="n">theta</span><span class="p">],</span> <span class="n">dt</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>
        <span class="n">html_text</span> <span class="o">+=</span> <span class="s">&#39;&lt;/tr&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">html_text</span> <span class="o">+=</span> <span class="s">&#39;&lt;/table&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="k">return</span> <span class="n">html_text</span>
</pre></div>
</div>
<p>Making one plot is done in <tt class="docutils literal"><span class="pre">compute4web</span></tt>. The statements should be
straightforward from earlier examples, but there is one new feature:
we use a tool in Parampool to embed the PNG code for a plot file
directly in an HTML image tag. The details are hidden from the
programmer, who can just rely on
relevant HTML code in the string <tt class="docutils literal"><span class="pre">html_text</span></tt>. The function looks like</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">compute4web</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run a case with the solver, compute error measure,</span>
<span class="sd">    and plot the numerical and exact solutions in a PNG</span>
<span class="sd">    plot whose data are embedded in an HTML image tag.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
    <span class="n">u_e</span> <span class="o">=</span> <span class="n">exact_solution</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">u_e</span> <span class="o">-</span> <span class="n">u</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">t_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>    <span class="c"># fine mesh for u_e</span>
    <span class="n">u_e</span> <span class="o">=</span> <span class="n">exact_solution</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span>   <span class="n">u</span><span class="p">,</span>   <span class="s">&#39;r--o&#39;</span><span class="p">)</span>       <span class="c"># red dashes w/circles</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">u_e</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>         <span class="c"># blue line for exact sol.</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&#39;numerical&#39;</span><span class="p">,</span> <span class="s">&#39;exact&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;theta=</span><span class="si">%g</span><span class="s">, dt=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">dt</span><span class="p">))</span>
    <span class="c"># Save plot to HTML img tag with PNG code as embedded data</span>
    <span class="kn">from</span> <span class="nn">parampool.utils</span> <span class="kn">import</span> <span class="n">save_png_to_str</span>
    <span class="n">html_text</span> <span class="o">=</span> <span class="n">save_png_to_str</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="n">plotwidth</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">E</span><span class="p">,</span> <span class="n">html_text</span>
</pre></div>
</div>
</div>
<div class="section" id="generating-the-user-interface">
<h4>Generating the user interface<a class="headerlink" href="#generating-the-user-interface" title="Permalink to this headline">¶</a></h4>
<p>The web GUI is automatically generated by
the following code, placed in a file <a class="reference external" href="http://tinyurl.com/nm5587k/softeng1/decay_GUI_generate.py">decay_GUI_generate.py</a></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">parampool.generator.flask</span> <span class="kn">import</span> <span class="n">generate</span>
<span class="kn">from</span> <span class="nn">decay</span> <span class="kn">import</span> <span class="n">main_GUI</span>
<span class="n">generate</span><span class="p">(</span><span class="n">main_GUI</span><span class="p">,</span>
         <span class="n">filename_controller</span><span class="o">=</span><span class="s">&#39;decay_GUI_controller.py&#39;</span><span class="p">,</span>
         <span class="n">filename_template</span><span class="o">=</span><span class="s">&#39;decay_GUI_view.py&#39;</span><span class="p">,</span>
         <span class="n">filename_model</span><span class="o">=</span><span class="s">&#39;decay_GUI_model.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Running the <tt class="docutils literal"><span class="pre">decay_GUI_generate.py</span></tt> program results in three new
files whose names are specified in the call to <tt class="docutils literal"><span class="pre">generate</span></tt>:</p>
<blockquote>
<div><ol class="arabic simple">
<li><tt class="docutils literal"><span class="pre">decay_GUI_model.py</span></tt> defines HTML widgets to be used to set
input data in the web interface,</li>
<li><tt class="docutils literal"><span class="pre">templates/decay_GUI_views.py</span></tt> defines the layout of the web page,</li>
<li><tt class="docutils literal"><span class="pre">decay_GUI_controller.py</span></tt> runs the web application.</li>
</ol>
</div></blockquote>
<p>We only need to run the last program, and there is no need to look into
these files.</p>
</div>
<div class="section" id="running-the-web-application">
<h4>Running the web application<a class="headerlink" href="#running-the-web-application" title="Permalink to this headline">¶</a></h4>
<p>The web GUI is started by</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python decay_GUI_controller.py
</pre></div>
</div>
<p>Open a web browser at the location <tt class="docutils literal"><span class="pre">127.0.0.1:5000</span></tt>. Input fields for
<tt class="docutils literal"><span class="pre">I</span></tt>, <tt class="docutils literal"><span class="pre">a</span></tt>, <tt class="docutils literal"><span class="pre">T</span></tt>, <tt class="docutils literal"><span class="pre">dt_values</span></tt>, and <tt class="docutils literal"><span class="pre">theta_values</span></tt> are presented.  Figure
<a class="reference internal" href="#softeng1-fig-gui"><em>Automatically generated graphical web interface</em></a> shows a part of the resulting page if we run
with the default values for the input parameters.
With the techniques demonstrated here, one can
easily create a tailored web GUI for a particular type of application
and use it to interactively explore physical and numerical effects.</p>
</div>
</div>
</div>
<div class="section" id="tests-for-verifying-implementations">
<h2>Tests for verifying implementations<a class="headerlink" href="#tests-for-verifying-implementations" title="Permalink to this headline">¶</a></h2>
<p>Any module with functions should have a set of tests that check the
implementations.
There exists
well-established procedures and corresponding tools for automating
the execution of such tests. One can in this way, with a one-line command,
run large test sets and confirm that the software works (as far as the
tests tells). Here we shall illustrate two important
software testing techniques: <em>doctest</em> and <em>unit testing</em>.
The first one is Python specific, while unit testing is the dominating
test technique for computer software today.</p>
<div class="section" id="doctests">
<h3>Doctests<a class="headerlink" href="#doctests" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-8"></span><p id="index-9">A doc string, the first string after the function header, is used to
document the purpose of functions and their arguments
(see the section <a class="reference internal" href="#softeng1-basic-func"><em>Isolating the numerical algorithm in a function</em></a>). Very often it
is instructive to include an example on how to use the function.
Interactive examples in the Python shell are most illustrative as
we can see the output resulting from function calls. For example,
we can in the <tt class="docutils literal"><span class="pre">solver</span></tt> function include an example on calling
this function and printing the computed <tt class="docutils literal"><span class="pre">u</span></tt> and <tt class="docutils literal"><span class="pre">t</span></tt> arrays:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solve u&#39;=-a*u, u(0)=I, for t in (0,T] with steps of dt.</span>


<span class="sd">    &gt;&gt;&gt; u, t = solver(I=0.8, a=1.2, T=1.5, dt=0.5, theta=0.5)</span>
<span class="sd">    &gt;&gt;&gt; for t_n, u_n in zip(t, u):</span>
<span class="sd">    ...     print &#39;t=%.1f, u=%.14f&#39; % (t_n, u_n)</span>
<span class="sd">    t=0.0, u=0.80000000000000</span>
<span class="sd">    t=0.5, u=0.43076923076923</span>
<span class="sd">    t=1.0, u=0.23195266272189</span>
<span class="sd">    t=1.5, u=0.12489758761948</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>When such interactive demonstrations are inserted in doc strings,
Python&#8217;s <a class="reference external" href="http://docs.python.org/library/doctest.html">doctest</a>
module can be used to automate running all commands
in interactive sessions and compare new output with the output
appearing in the doc string.  All we have to do in the current example
is to run the module file <tt class="docutils literal"><span class="pre">decay.py</span></tt> with</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Terminal</span><span class="o">&gt;</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">doctest</span> <span class="n">decay</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>This command imports the <tt class="docutils literal"><span class="pre">doctest</span></tt> module, which runs all
doctests found in the file.</p>
<div class="admonition-doctests-prevent-command-line-arguments admonition">
<p class="first admonition-title">Doctests prevent command-line arguments</p>
<p class="last">No additional command-line argument is allowed when running doctests.
If your program relies on command-line input, make sure the tests
can be run with such input.</p>
</div>
<p>The execution command above will report any problem if a test fails.
For example, changing the last digit <tt class="docutils literal"><span class="pre">8</span></tt> in the output of the doctest
to <tt class="docutils literal"><span class="pre">7</span></tt> triggers a report:</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python -m doctest decay.py
********************************************************
File &quot;decay.py&quot;, line ...
Failed example:
    for t_n, u_n in zip(t, u):
        print &#39;t=%.1f, u=%.14f&#39; % (t_n, u_n)
Expected:
    t=0.0, u=0.80000000000000
    t=0.5, u=0.43076923076923
    t=1.0, u=0.23195266272189
    t=1.5, u=0.12489758761947
Got:
    t=0.0, u=0.80000000000000
    t=0.5, u=0.43076923076923
    t=1.0, u=0.23195266272189
    t=1.5, u=0.12489758761948
</pre></div>
</div>
<div class="admonition-pay-attention-to-the-number-of-digits-in-doctest-results admonition">
<p class="first admonition-title">Pay attention to the number of digits in doctest results</p>
<p class="last">Note that in the output of <tt class="docutils literal"><span class="pre">t</span></tt> and <tt class="docutils literal"><span class="pre">u</span></tt> we write <tt class="docutils literal"><span class="pre">u</span></tt> with 14 digits.
Writing all 16 digits is not a good idea: if the tests are run on
different hardware, round-off errors might be different, and
the <tt class="docutils literal"><span class="pre">doctest</span></tt> module detects that the numbers are not precisely the same
and reports failures. In the present application, where <span class="math">\(0 &lt; u(t) \leq 0.8\)</span>,
we expect round-off errors to be of size <span class="math">\(10^{-16}\)</span>, so comparing 15
digits would probably be reliable, but we compare 14 to be on the
safe side. On the other hand, comparing a small number of digits may
hide software errors.</p>
</div>
<p>Doctests are highly encouraged as they do two things: 1) demonstrate
how a function is used and 2) test that the function works.</p>
<div class="admonition-caution admonition">
<p class="first admonition-title">Caution</p>
<p class="last">Doctests requires careful coding if they use command-line input or
print results to the terminal window. Command-line input must
be simulated by filling <tt class="docutils literal"><span class="pre">sys.argv</span></tt> correctly, e.g.,
<tt class="docutils literal"><span class="pre">sys.argv</span> <span class="pre">=</span> <span class="pre">'--I</span> <span class="pre">1.0</span> <span class="pre">--a</span> <span class="pre">5'.split</span></tt>.
The output lines of print statements inside doctests
must be copied exactly as they
appear when running the statements in an interactive Python shell.</p>
</div>
</div>
<div class="section" id="unit-tests-and-test-functions">
<h3>Unit tests and test functions<a class="headerlink" href="#unit-tests-and-test-functions" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-10"></span><span class="target" id="index-11"></span><span class="target" id="index-12"></span><span class="target" id="index-13"></span><p id="index-14">The unit testing technique consists of identifying small units
of code, say a function, and write one or more tests for
each unit. One test should, ideally, not depend on the outcome of
other tests. The recommended practice is actually to
design and write the unit tests first and <em>then</em> implement the functions!</p>
<p>In scientific computing it is not always obvious how to best perform
unit testing. The units is naturally larger than in non-scientific
software. Very often the solution procedure of a mathematical problem
identifies a unit, such as our <tt class="docutils literal"><span class="pre">solver</span></tt> function.</p>
<span class="target" id="index-15"></span><div class="section" id="test-frameworks-nose-and-pytest">
<span id="index-16"></span><h4>Test frameworks: nose and pytest<a class="headerlink" href="#test-frameworks-nose-and-pytest" title="Permalink to this headline">¶</a></h4>
<p>Python offers two very easy-to-use software frameworks for implementing
unit tests: nose and pytest. These work (almost) in the same way,
but my recommendation is to go for pytest.</p>
</div>
<div class="section" id="test-function-requirements">
<h4>Test function requirements<a class="headerlink" href="#test-function-requirements" title="Permalink to this headline">¶</a></h4>
<p>Each test can in these frameworks be realized as a <em>test function</em>
that follows three rules:</p>
<blockquote>
<div><ol class="arabic simple">
<li>The name must start with <tt class="docutils literal"><span class="pre">test_</span></tt>.</li>
<li>Function arguments are not allowed.</li>
<li>An <tt class="docutils literal"><span class="pre">AssertionError</span></tt> exception must be raised if the test fails.</li>
</ol>
</div></blockquote>
<p>A specific example might be illustrative before proceeding.
Given a function that doubles the argument,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">double</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">n</span>
</pre></div>
</div>
<p>a corresponding test function may look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">test_double</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Test that double(n) works for one specific n.&quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="mi">4</span>
    <span class="n">computed</span> <span class="o">=</span> <span class="n">double</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">expected</span> <span class="o">!=</span> <span class="n">computed</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span>
</pre></div>
</div>
<p>The last two lines, however, are never written like this in unit tests.
Instead, use Python&#8217;s <tt class="docutils literal"><span class="pre">assert</span></tt> statement: <tt class="docutils literal"><span class="pre">assert</span> <span class="pre">success,</span> <span class="pre">msg</span></tt>, where
<tt class="docutils literal"><span class="pre">success</span></tt> is a boolean variable, here <tt class="docutils literal"><span class="pre">False</span></tt> if the test fails, and
<tt class="docutils literal"><span class="pre">msg</span></tt> is <em>an optional</em> message string that is printed when the test fails.
In detail, the test function looks like</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">test_double</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Test that double(n) works for one specific n.&quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="mi">4</span>
    <span class="n">computed</span> <span class="o">=</span> <span class="n">double</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;expected </span><span class="si">%g</span><span class="s">, computed </span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">computed</span><span class="p">)</span>
    <span class="n">success</span> <span class="o">=</span> <span class="n">expected</span> <span class="o">==</span> <span class="n">computed</span>
    <span class="k">assert</span> <span class="n">success</span><span class="p">,</span> <span class="n">msg</span>
</pre></div>
</div>
</div>
<div class="section" id="comparison-of-real-numbers">
<h4>Comparison of real numbers<a class="headerlink" href="#comparison-of-real-numbers" title="Permalink to this headline">¶</a></h4>
<p>In scientific computing we very often have to deal with real numbers and
round-off errors so the <tt class="docutils literal"><span class="pre">==</span></tt> operator must be replaced by a comparison
within a tolerance. Consider testing this function instead,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">third</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">/</span><span class="mf">3.</span>
</pre></div>
</div>
<p>We write a test function where the expected result is computed as
<span class="math">\(\frac{1}{3}x\)</span> rather than <span class="math">\(x/3\)</span>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">test_third</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span><span class="o">*</span><span class="n">x</span>
    <span class="n">computed</span> <span class="o">=</span> <span class="n">third</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">success</span> <span class="o">=</span> <span class="n">expected</span> <span class="o">==</span> <span class="n">computed</span>
    <span class="k">assert</span> <span class="n">success</span>
</pre></div>
</div>
<p>This <tt class="docutils literal"><span class="pre">test_third</span></tt> function executes silently, i.e., no failure, for <tt class="docutils literal"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">0.1</span></tt>,
but not if we set <tt class="docutils literal"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">0.15</span></tt>. The latter <tt class="docutils literal"><span class="pre">x</span></tt> value gives a round-off error.
The solution to this problem is to compare <tt class="docutils literal"><span class="pre">expected</span></tt> and <tt class="docutils literal"><span class="pre">computed</span></tt>
with a small tolerance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">test_third</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mf">0.15</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span><span class="o">*</span><span class="n">x</span>
    <span class="n">computed</span> <span class="o">=</span> <span class="n">third</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">tol</span> <span class="o">=</span> <span class="mf">1E-15</span>
    <span class="n">success</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">expected</span> <span class="o">-</span> <span class="n">computed</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span>
    <span class="k">assert</span> <span class="n">success</span>
</pre></div>
</div>
</div>
<div class="section" id="special-assert-functions-from-nose">
<h4>Special assert functions from nose<a class="headerlink" href="#special-assert-functions-from-nose" title="Permalink to this headline">¶</a></h4>
<p>The nose test framework contains more tailored
<em>assert functions</em> that can be called instead of using the <tt class="docutils literal"><span class="pre">assert</span></tt>
statement. For example, comparing two objects within
a tolerance, as in the present
case, can be done by <tt class="docutils literal"><span class="pre">assert_almost_equal</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">nose.tools</span> <span class="kn">as</span> <span class="nn">nt</span>

<span class="k">def</span> <span class="nf">test_third</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mf">0.15</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span><span class="o">*</span><span class="n">x</span>
    <span class="n">computed</span> <span class="o">=</span> <span class="n">third</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">nt</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span>
        <span class="n">expected</span><span class="p">,</span> <span class="n">computed</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">1E-15</span><span class="p">,</span>
        <span class="n">msg</span><span class="o">=</span><span class="s">&#39;diff=</span><span class="si">%.17E</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">expected</span> <span class="o">-</span> <span class="n">computed</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="locating-test-functions">
<h4>Locating test functions<a class="headerlink" href="#locating-test-functions" title="Permalink to this headline">¶</a></h4>
<p>Test functions can reside in a module together with the functions they
are supposed to verify, or the test functions can be collected in
separate files having names starting with <tt class="docutils literal"><span class="pre">test</span></tt>. Actually,
nose and pytest can automatically recursively run all test functions
in all <tt class="docutils literal"><span class="pre">test*.py</span></tt>
files in the current and all subdirectories!</p>
<p>The <a class="reference external" href="http://tinyurl.com/nm5587k/softeng1/decay.py">decay.py</a> module file features
test functions in the module, but we could equally well have made
a subdirectory <tt class="docutils literal"><span class="pre">tests</span></tt> and put the test functions in
(say) <tt class="docutils literal"><span class="pre">tests/test_decay.py</span></tt>.</p>
</div>
<div class="section" id="running-tests">
<h4>Running tests<a class="headerlink" href="#running-tests" title="Permalink to this headline">¶</a></h4>
<p>To run all test functions in the file <tt class="docutils literal"><span class="pre">decay.py</span></tt> do</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; nosetests -s -v decay.py
Terminal&gt; py.test -s -v decay.py
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">-s</span></tt> option ensures that output from the test functions is printed
in the terminal window, and <tt class="docutils literal"><span class="pre">-v</span></tt> prints the outcome of each individual
test function.</p>
<p>Alternatively, if the test functions are in some <tt class="docutils literal"><span class="pre">test*.py</span></tt> files,
we can just write <tt class="docutils literal"><span class="pre">py.test</span> <span class="pre">-s</span> <span class="pre">-v</span></tt>
to <em>recursively</em> run <em>all</em> test functions in the current
directory tree. The corresponding <tt class="docutils literal"><span class="pre">nosetests</span> <span class="pre">-s</span> <span class="pre">-v</span></tt> command
does the same, but requires subdirectory names to start
with <tt class="docutils literal"><span class="pre">test</span></tt> or end with <tt class="docutils literal"><span class="pre">_test</span></tt> or <tt class="docutils literal"><span class="pre">_tests</span></tt> (which is a good habit anyway).
An example of a <tt class="docutils literal"><span class="pre">tests</span></tt> directory with a <tt class="docutils literal"><span class="pre">test*.py</span></tt>
file is found in <a class="reference external" href="http://tinyurl.com/nm5587k/softeng1/tests">src/softeng1/tests</a>.</p>
</div>
<div class="section" id="installing-nose-and-pytest">
<h4>Installing nose and pytest<a class="headerlink" href="#installing-nose-and-pytest" title="Permalink to this headline">¶</a></h4>
<p>With <tt class="docutils literal"><span class="pre">pip</span></tt> available, it is trivial to install nose and/or pytest:
<tt class="docutils literal"><span class="pre">sudo</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">nose</span></tt> and <tt class="docutils literal"><span class="pre">sudo</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">pytest</span></tt>.</p>
</div>
</div>
<div class="section" id="test-function-for-the-solver">
<h3>Test function for the solver<a class="headerlink" href="#test-function-for-the-solver" title="Permalink to this headline">¶</a></h3>
<p>Finding good test problems for verifying the implementation of numerical
methods is a topic on its own. The challenge is that we very seldom know
what the numerical errors are. For the present model problem
<a href="#equation-softeng1:ode">(1)</a>-<a href="#equation-softeng1:u0">(2)</a> solved by
<a href="#equation-softeng1:utheta">(3)</a> one can, fortunately, derive a formula for
the numerical approximation:</p>
<div class="math">
\[u^n = I\left(
\frac{1 - (1-\theta) a\Delta t}{1 + \theta a \Delta t}
\right)^n{\thinspace .}\]</div>
<p>Then we know that the implementation should
produce numbers that agree with this formula to machine precision.
The formula for <span class="math">\(u^n\)</span> is known as an <em>exact discrete solution</em> of the
problem:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">exact_discrete_solution</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return exact discrete solution of the numerical schemes.&quot;&quot;&quot;</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>  <span class="c"># avoid integer division</span>
    <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">theta</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">a</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">I</span><span class="o">*</span><span class="n">A</span><span class="o">**</span><span class="n">n</span>
</pre></div>
</div>
<p>A test function can evaluate this solution on a time mesh
and check that the <tt class="docutils literal"><span class="pre">u</span></tt> values produced by the <tt class="docutils literal"><span class="pre">solver</span></tt> function
do not deviate with more than a small tolerance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">test_exact_discrete_solution</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Check that solver reproduces the exact discr. sol.&quot;&quot;&quot;</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">;</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">I</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span> <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.8</span>
    <span class="n">Nt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">8</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span>  <span class="c"># no of steps</span>
    <span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">Nt</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">)</span>
    <span class="c"># Evaluate exact discrete solution on the mesh</span>
    <span class="n">u_de</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">exact_discrete_solution</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">u_de</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>  <span class="c"># largest deviation</span>
    <span class="n">tol</span> <span class="o">=</span> <span class="mf">1E-14</span>
    <span class="n">success</span> <span class="o">=</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="n">tol</span>
    <span class="k">assert</span> <span class="n">success</span>
</pre></div>
</div>
<p>An important topic to address in test functions is potentially
problematic input to functions. For example, if <span class="math">\(a\)</span>, <span class="math">\(\Delta t\)</span>, and
<span class="math">\(\theta\)</span> are integers, one may face problems with unintended integer
division in the numerical solution algorithm for the present mathematical
problem. We should therefore add a test to make sure our <tt class="docutils literal"><span class="pre">solver</span></tt>
function does not fall into this potential trap:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">test_potential_integer_division</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Choose variables that can trigger integer division.&quot;&quot;&quot;</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">dt</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">Nt</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">Nt</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">u_de</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">exact_discrete_solution</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">u_de</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="mf">1E-14</span>
</pre></div>
</div>
</div>
<div class="section" id="test-function-for-reading-positional-command-line-arguments">
<h3>Test function for reading positional command-line arguments<a class="headerlink" href="#test-function-for-reading-positional-command-line-arguments" title="Permalink to this headline">¶</a></h3>
<p>The function <tt class="docutils literal"><span class="pre">read_command_line_positional</span></tt> extracts numbers from the
command line. To test it, decide on a set of numbers, fill <tt class="docutils literal"><span class="pre">sys.argv</span></tt>
appropriately, and check that we get the expected numbers:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">test_read_command_line_positional</span><span class="p">():</span>
    <span class="c"># Decide on a data set of input parameters</span>
    <span class="n">I</span> <span class="o">=</span> <span class="mf">1.6</span><span class="p">;</span>  <span class="n">a</span> <span class="o">=</span> <span class="mf">1.8</span><span class="p">;</span>  <span class="n">T</span> <span class="o">=</span> <span class="mf">2.2</span><span class="p">;</span>  <span class="n">theta</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">dt_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">]</span>
    <span class="c"># Expected return from read_command_line_positional</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">dt_values</span><span class="p">]</span>
    <span class="c"># Construct corresponding sys.argv array</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">I</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="s">&#39;CN&#39;</span><span class="p">]</span> <span class="o">+</span> \
               <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span> <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">dt_values</span><span class="p">]</span>
    <span class="n">computed</span> <span class="o">=</span> <span class="n">read_command_line_positional</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">expected_arg</span><span class="p">,</span> <span class="n">computed_arg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">computed</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">expected_arg</span> <span class="o">==</span> <span class="n">computed_arg</span>
</pre></div>
</div>
<p>Note that <tt class="docutils literal"><span class="pre">sys.argv[0]</span></tt> is always the program name and that we have to
copy that string from the original <tt class="docutils literal"><span class="pre">sys.argv</span></tt> array to the new one we
construct in the test function. (Actually, the test function destroys
the original <tt class="docutils literal"><span class="pre">sys.argv</span></tt> that Python fetched from the command line.)</p>
<p>Any numerical code writer should always be skeptical to the use of the exact
equality operator <tt class="docutils literal"><span class="pre">==</span></tt> in test functions, since round-off errors often
come into play. Here, however, we set some real values, convert them
to strings and convert back again to real numbers (of the same precision).
This string-number conversion does not involve approximation so we
can safely use <tt class="docutils literal"><span class="pre">==</span></tt> in tests. Note also that the last element in
<tt class="docutils literal"><span class="pre">expected</span></tt> and <tt class="docutils literal"><span class="pre">computed</span></tt> is the list <tt class="docutils literal"><span class="pre">dt_values</span></tt>, and <tt class="docutils literal"><span class="pre">==</span></tt> works
for comparing two lists too.</p>
</div>
<div class="section" id="test-function-for-reading-option-value-pairs">
<h3>Test function for reading option-value pairs<a class="headerlink" href="#test-function-for-reading-option-value-pairs" title="Permalink to this headline">¶</a></h3>
<p>Testing the function <tt class="docutils literal"><span class="pre">read_command_line_argparse</span></tt> follows the
set up for the similar function for positional command-line arguments.
However, the construction of the command line is a bit more complicated.
We find it convenient to construct the line as a string and then
split the line into words to get the desired list <tt class="docutils literal"><span class="pre">sys.argv</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">test_read_command_line_argparse</span><span class="p">():</span>
    <span class="n">I</span> <span class="o">=</span> <span class="mf">1.6</span><span class="p">;</span>  <span class="n">a</span> <span class="o">=</span> <span class="mf">1.8</span><span class="p">;</span>  <span class="n">T</span> <span class="o">=</span> <span class="mf">2.2</span><span class="p">;</span>  <span class="n">theta</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">dt_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">]</span>
    <span class="c"># Expected return from read_command_line_positional</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">dt_values</span><span class="p">]</span>
    <span class="c"># Construct corresponding sys.argv array</span>
    <span class="n">cml</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> --a </span><span class="si">%s</span><span class="s"> --I </span><span class="si">%s</span><span class="s"> --T </span><span class="si">%s</span><span class="s"> --scheme CN --dt &#39;</span> <span class="o">%</span> \
          <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
    <span class="n">cml</span> <span class="o">=</span> <span class="n">cml</span> <span class="o">+</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span> <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">dt_values</span><span class="p">])</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="n">cml</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">computed</span> <span class="o">=</span> <span class="n">read_command_line_argparse</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">expected_arg</span><span class="p">,</span> <span class="n">computed_arg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">computed</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">expected_arg</span> <span class="o">==</span> <span class="n">computed_arg</span>
</pre></div>
</div>
<div class="admonition-let-silent-test-functions-speak-up-during-development admonition">
<p class="first admonition-title">Let silent test functions speak up during development</p>
<p>When you develop test functions in a module, it is common to use IPython
to reload the module and call the test function as it gets developed:</p>
<div class="highlight-ipy"><div class="highlight"><pre><span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">decay</span>

<span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">decay</span><span class="o">.</span><span class="n">test_read_command_line_argparse</span><span class="p">()</span>

<span class="n">In</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">reload</span><span class="p">(</span><span class="n">decay</span><span class="p">)</span>  <span class="c"># force new import</span>

<span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">decay</span><span class="o">.</span><span class="n">test_read_command_line_argparse</span><span class="p">()</span>  <span class="c"># test again</span>
</pre></div>
</div>
<p class="last">However, a working test function is completely silent! Many
find it psychologically annoying to convince themselves that a
completely silent function is doing the right things. It can therefore,
during development of a test function, be convenient to insert
print statements in the function to monitor that the function body
is indeed executed... For example, one can print the expected and
computed values in the terminal window.</p>
</div>
</div>
<div class="section" id="classical-class-based-unit-testing">
<span id="softeng1-basic-unittest"></span><h3>Classical class-based unit testing<a class="headerlink" href="#classical-class-based-unit-testing" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-17"></span><span class="target" id="index-18"></span><p id="index-19">The test functions written for the nose and pytest frameworks are
very straightforward and to the point, with no framework-required boilerplate
code. We just write the statements we need to make the computations and
comparisons and then make the require <tt class="docutils literal"><span class="pre">assert</span></tt>.</p>
<p>The classical way implementing unit tests derives from the JUnit
tool in Java and leads to much more comprehensive implementations with
much more boilerplate code.
Python comes with a built-in module <tt class="docutils literal"><span class="pre">unittest</span></tt> for doing this type of
unit tests. Although I strongly recommend to use nose or pytest over
<tt class="docutils literal"><span class="pre">unittest</span></tt>, class-based unit testing in the style of <tt class="docutils literal"><span class="pre">unittest</span></tt>
has a very strong position in computer science and is so widespread
that even computational scientists should have an idea how such
unit test code is written. A short demo of <tt class="docutils literal"><span class="pre">unittest</span></tt> is therefore
included next.</p>
<span class="target" id="index-20"></span><p id="index-21">Suppose we have a function <tt class="docutils literal"><span class="pre">double(x)</span></tt> in a module file <tt class="docutils literal"><span class="pre">mymod.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">double</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span>
</pre></div>
</div>
<p>Unit testing with the aid of the <tt class="docutils literal"><span class="pre">unittest</span></tt> module
consists of writing a file <tt class="docutils literal"><span class="pre">test_mymod.py</span></tt> for testing the functions
in <tt class="docutils literal"><span class="pre">mymod.py</span></tt>. The individual tests must be methods with names
starting with <tt class="docutils literal"><span class="pre">test_</span></tt> in a class derived from class <tt class="docutils literal"><span class="pre">TestCase</span></tt> in
<tt class="docutils literal"><span class="pre">unittest</span></tt>. With one test method for the function <tt class="docutils literal"><span class="pre">double</span></tt>, the
<tt class="docutils literal"><span class="pre">test_mymod.py</span></tt> file becomes</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">mymod</span>

<span class="k">class</span> <span class="nc">TestMyCode</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_double</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span>
        <span class="n">computed</span> <span class="o">=</span> <span class="n">mymod</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">computed</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>The test is run by executing the test file <tt class="docutils literal"><span class="pre">test_mymod.py</span></tt> as a standard
Python program. There is no support in <tt class="docutils literal"><span class="pre">unittest</span></tt> for automatically
locating and running all tests in all test files in a directory tree.</p>
<p>We could use the basic <tt class="docutils literal"><span class="pre">assert</span></tt> statement as we did with nose and pytest
functions, but those who write code based on <tt class="docutils literal"><span class="pre">unittest</span></tt> almost
exclusively use the wide range of built-in assert functions such
as <tt class="docutils literal"><span class="pre">assertEqual</span></tt>, <tt class="docutils literal"><span class="pre">assertNotEqual</span></tt>, <tt class="docutils literal"><span class="pre">assertAlmostEqual</span></tt>, to mention
some of them.</p>
<p>Translation of <tt class="docutils literal"><span class="pre">test_exact_discrete_solution</span></tt>,
<tt class="docutils literal"><span class="pre">test_potential_integer_division</span></tt>, and the other test functions in <tt class="docutils literal"><span class="pre">decay.py</span></tt>
to <tt class="docutils literal"><span class="pre">unittest</span></tt> means making a new file <tt class="docutils literal"><span class="pre">test_decay.py</span></tt> file with a
test class <tt class="docutils literal"><span class="pre">TestDecay</span></tt> where the stand-alone functions for
nose/pytest now become methods in this class.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">decay</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">exact_discrete_solution</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">class</span> <span class="nc">TestDecay</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_exact_discrete_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">;</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">I</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span> <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.8</span>
        <span class="n">Nt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">8</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span>  <span class="c"># no of steps</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">decay</span><span class="o">.</span><span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">Nt</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">)</span>
        <span class="c"># Evaluate exact discrete solution on the mesh</span>
        <span class="n">u_de</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">exact_discrete_solution</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
                         <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">u_de</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>  <span class="c"># largest deviation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">1E-14</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_potential_integer_division</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">1E-14</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_read_command_line_positional</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="k">for</span> <span class="n">expected_arg</span><span class="p">,</span> <span class="n">computed_arg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">computed</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected_arg</span><span class="p">,</span> <span class="n">computed_arg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_read_command_line_argparse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="classes-for-problem-and-solution-method">
<span id="softeng1-prog-se-class"></span><h2>Classes for problem and solution method<a class="headerlink" href="#classes-for-problem-and-solution-method" title="Permalink to this headline">¶</a></h2>
<p>The <span class="math">\(\theta\)</span>-rule was compactly and conveniently implemented in
a function <tt class="docutils literal"><span class="pre">solver</span></tt> in the section <a class="reference internal" href="#softeng1-basic-math"><em>Mathematical problem and solution technique</em></a>.
In more complicated problems it might
be beneficial to use classes and introduce a class <tt class="docutils literal"><span class="pre">Problem</span></tt> to
hold the definition of the physical problem, and a class <tt class="docutils literal"><span class="pre">Solver</span></tt>
to hold the data and methods needed to numerically solve the problem.
This idea will now be illustrated, resulting in code that represents
an alternative to the <tt class="docutils literal"><span class="pre">solver</span></tt> and <tt class="docutils literal"><span class="pre">experiment_*</span></tt> functions found
in the <tt class="docutils literal"><span class="pre">decay</span></tt> module.</p>
<p>Explaining the details of class programming in Python is considered
beyond the scope of this text.  Readers who are unfamiliar with Python
class programming should first consult one of the many electronic
Python tutorials or textbooks to come up to speed with concepts and
syntax of Python classes before reading on. The author has a gentle
introduction to class programming for scientific applications
in <a class="reference internal" href="._main_softeng1001.html#ref1" id="id1">[Ref1]</a>, see Chapter 7 and 9 and Appendix E.
Other useful resources are</p>
<blockquote>
<div><ul class="simple">
<li>The Python Tutorial: <a class="reference external" href="http://docs.python.org/2/tutorial/classes.html">http://docs.python.org/2/tutorial/classes.html</a></li>
<li>Wiki book on Python Programming: <a class="reference external" href="http://en.wikibooks.org/wiki/Python_Programming/Classes">http://en.wikibooks.org/wiki/Python_Programming/Classes</a></li>
<li>tutorialspoint.com: <a class="reference external" href="http://www.tutorialspoint.com/python/python_classes_objects.htm">http://www.tutorialspoint.com/python/python_classes_objects.htm</a></li>
</ul>
</div></blockquote>
<div class="section" id="the-problem-class-1">
<h3>The problem class  (1)<a class="headerlink" href="#the-problem-class-1" title="Permalink to this headline">¶</a></h3>
<p id="index-22">The purpose of the problem class is to store all information about
the mathematical model. This usually means the physical parameters
and formulas
in the problem. Looking at our model problem
<a href="#equation-softeng1:ode">(1)</a>-<a href="#equation-softeng1:u0">(2)</a>, the physical data cover
<span class="math">\(I\)</span>, <span class="math">\(a\)</span>, and <span class="math">\(T\)</span>. Since we have an analytical solution of
the ODE problem, we may add this solution in terms of a Python
function (or method) to the problem class as well.
A possible problem class is therefore</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">exp</span>

<span class="k">class</span> <span class="nc">Problem</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">I</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">T</span>

    <span class="k">def</span> <span class="nf">u_exact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">I</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
        <span class="k">return</span> <span class="n">I</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
<p>We could in the <tt class="docutils literal"><span class="pre">u_exact</span></tt> method have written
<tt class="docutils literal"><span class="pre">self.I*exp(-self.a*t)</span></tt>, but using local variables <tt class="docutils literal"><span class="pre">I</span></tt> and <tt class="docutils literal"><span class="pre">a</span></tt> allows
the formula <tt class="docutils literal"><span class="pre">I*exp(-a*t)</span></tt> which looks closer to the mathematical
expression <span class="math">\(Ie^{-at}\)</span>.  This is not an important issue with the
current compact formula, but is beneficial in more complicated
problems with longer formulas to obtain the closest possible
relationship between code and mathematics. My coding style is to strip
off the <tt class="docutils literal"><span class="pre">self</span></tt> prefix when the code expresses mathematical formulas.</p>
<p>The class data can be set either as arguments in the constructor or
at any time later, e.g.,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">problem</span> <span class="o">=</span> <span class="n">Problem</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">problem</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="mf">1.5</span>
</pre></div>
</div>
<p>(Some programmers prefer <tt class="docutils literal"><span class="pre">set</span></tt> and <tt class="docutils literal"><span class="pre">get</span></tt> functions for setting and getting
data in classes, often implemented via <em>properties</em> in Python, but
I consider that overkill when we just have a few data items in a class.)</p>
<p>It would be convenient if class <tt class="docutils literal"><span class="pre">Problem</span></tt> could also initialize
the data from the command line. To this end, we add a method for
defining a set of command-line options and a method that sets the
local attributes equal to what was found on the command line.
The default values associated with the command-line options are taken
as the values provided to the constructor. Class <tt class="docutils literal"><span class="pre">Problem</span></tt> now becomes</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Problem</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">I</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">T</span>

    <span class="k">def</span> <span class="nf">define_command_line_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return updated (parser) or new ArgumentParser object.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">parser</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">argparse</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>

        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s">&#39;--I&#39;</span><span class="p">,</span> <span class="s">&#39;--initial_condition&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;initial condition, u(0)&#39;</span><span class="p">,</span>
            <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;I&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s">&#39;--a&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;coefficient in ODE&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s">&#39;--T&#39;</span><span class="p">,</span> <span class="s">&#39;--stop_time&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;end time of simulation&#39;</span><span class="p">,</span>
            <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;T&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">parser</span>

    <span class="k">def</span> <span class="nf">init_from_command_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load attributes from ArgumentParser into instance.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">T</span>

    <span class="k">def</span> <span class="nf">u_exact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the exact solution u(t)=I*exp(-a*t).&quot;&quot;&quot;</span>
        <span class="n">I</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
        <span class="k">return</span> <span class="n">I</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
<p>Observe that if the user already has an <tt class="docutils literal"><span class="pre">ArgumentParser</span></tt> object it can be
supplied, but if she does not have any, class <tt class="docutils literal"><span class="pre">Problem</span></tt> makes one.
Python&#8217;s <tt class="docutils literal"><span class="pre">None</span></tt> object is used to indicate that a variable is not
initialized with a proper value.</p>
</div>
<div class="section" id="the-solver-class-1">
<h3>The solver class  (1)<a class="headerlink" href="#the-solver-class-1" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-23"></span><p id="index-24">The solver class stores data related to the numerical solution method
and provides a function <tt class="docutils literal"><span class="pre">solve</span></tt> for solving the problem.
A problem object must be given to the constructor so that the solver
can easily look up physical data. In the present example, the
data related to the numerical solution method consists of <span class="math">\(\Delta t\)</span>
and <span class="math">\(\theta\)</span>. We add, as in the problem class, functionality for
reading <span class="math">\(\Delta t\)</span> and <span class="math">\(\theta\)</span> from the command line:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Solver</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">problem</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problem</span> <span class="o">=</span> <span class="n">problem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">),</span> <span class="n">theta</span>

    <span class="k">def</span> <span class="nf">define_command_line_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return updated (parser) or new ArgumentParser object.&quot;&quot;&quot;</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s">&#39;--scheme&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;CN&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;FE, BE, or CN&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s">&#39;--dt&#39;</span><span class="p">,</span> <span class="s">&#39;--time_step_values&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;time step values&#39;</span><span class="p">,</span>
            <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;dt&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s">&#39;+&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;dt_values&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">parser</span>

    <span class="k">def</span> <span class="nf">init_from_command_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load attributes from ArgumentParser into instance.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">theta</span>

    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return norm of error at the mesh points.&quot;&quot;&quot;</span>
        <span class="n">u_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">u_exact</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">u_e</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">E</span>
</pre></div>
</div>
<p>Note that the <tt class="docutils literal"><span class="pre">solve</span></tt> method is just a <em>wrapper</em>
of the previously developed stand-alone <tt class="docutils literal"><span class="pre">solver</span></tt> function.</p>
<div class="section" id="combining-the-objects">
<h4>Combining the objects<a class="headerlink" href="#combining-the-objects" title="Permalink to this headline">¶</a></h4>
<p>Eventually we need to show how the classes <tt class="docutils literal"><span class="pre">Problem</span></tt> and <tt class="docutils literal"><span class="pre">Solver</span></tt>
play together:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">experiment_classes</span><span class="p">():</span>
    <span class="n">problem</span> <span class="o">=</span> <span class="n">Problem</span><span class="p">()</span>
    <span class="n">solver</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>

    <span class="c"># Read input from the command line</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">define_command_line_options</span><span class="p">()</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span> <span class="n">define_command_line_options</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">init_from_command_line</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="n">solver</span><span class="o">.</span> <span class="n">init_from_command_line</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

    <span class="c"># Solve and plot</span>
    <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
    <span class="n">t_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>    <span class="c"># very fine mesh for u_e</span>
    <span class="n">u_e</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">u_exact</span><span class="p">(</span><span class="n">t_e</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span>   <span class="n">u</span><span class="p">,</span>   <span class="s">&#39;r--o&#39;</span><span class="p">)</span>       <span class="c"># dashed red line with circles</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">u_e</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>         <span class="c"># blue line for u_e</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&#39;numerical, theta=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">theta</span><span class="p">,</span> <span class="s">&#39;exact&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">)</span>
    <span class="n">plotfile</span> <span class="o">=</span> <span class="s">&#39;tmp&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.png&#39;</span><span class="p">);</span>  <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.pdf&#39;</span><span class="p">)</span>

    <span class="n">error</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">u_exact</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">u</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">print</span> <span class="s">&#39;Error norm:&#39;</span><span class="p">,</span> <span class="n">E</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">experiment_compare_dt</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="improving-the-problem-and-solver-classes">
<span id="softeng1-prog-se-class2"></span><h3>Improving the problem and solver classes<a class="headerlink" href="#improving-the-problem-and-solver-classes" title="Permalink to this headline">¶</a></h3>
<p>The previous <tt class="docutils literal"><span class="pre">Problem</span></tt> and <tt class="docutils literal"><span class="pre">Solver</span></tt> classes containing parameters
soon get much repetitive code when the number of parameters increases.
Much of this code can be parameterized and be made more compact.
For this purpose, we decide to collect all parameters in a dictionary,
<tt class="docutils literal"><span class="pre">self.prm</span></tt>, with two associated dictionaries <tt class="docutils literal"><span class="pre">self.type</span></tt> and
<tt class="docutils literal"><span class="pre">self.help</span></tt> for holding associated object types and help strings.
For the specific ODE example we deal with, such dictionaries are</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Problem data</span>
<span class="bp">self</span><span class="o">.</span><span class="n">prm</span>  <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="s">&#39;initial condition, u(0)&#39;</span><span class="p">,</span>
                 <span class="n">a</span><span class="o">=</span><span class="s">&#39;coefficient in ODE&#39;</span><span class="p">,</span>
                 <span class="n">T</span><span class="o">=</span><span class="s">&#39;end time of simulation&#39;</span><span class="p">)</span>
<span class="c"># Solver data</span>
<span class="bp">self</span><span class="o">.</span><span class="n">prm</span>  <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="s">&#39;time step value&#39;</span><span class="p">,</span>
                 <span class="n">theta</span><span class="o">=</span><span class="s">&#39;time discretization parameter&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Provided a problem or solver class defines these three
dictionaries in the constructor, using default or user-supplied values
of the parameters, we can create a super class <tt class="docutils literal"><span class="pre">Parameters</span></tt> with general code
for defining command-line options and reading them as well as
methods for setting and getting a parameter. A <tt class="docutils literal"><span class="pre">Problem</span></tt> or <tt class="docutils literal"><span class="pre">Solver</span></tt> for
a particular mathematical problem can then
inherit most of the needed functionality and code
from the <tt class="docutils literal"><span class="pre">Parameters</span></tt> class.</p>
<div class="section" id="a-generic-class-for-parameters">
<h4>A generic class for parameters<a class="headerlink" href="#a-generic-class-for-parameters" title="Permalink to this headline">¶</a></h4>
<p>A simplified version of the parameter class looks as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Parameters</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">parameters</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prm</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;Illegal parameter name </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return value of parameter with given name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">define_command_line_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Automatic registering of options.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">parser</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">argparse</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prm</span><span class="p">:</span>
            <span class="n">tp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="k">else</span> <span class="nb">str</span>
            <span class="n">help</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">help</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="k">else</span> <span class="bp">None</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
                <span class="s">&#39;--&#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">metavar</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="n">tp</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="n">help</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">parser</span>

    <span class="k">def</span> <span class="nf">init_from_command_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>The file <a class="reference external" href="http://tinyurl.com/nm5587k/softeng1/decay_oo.py">decay_oo.py</a> contains
a slightly more advanced version of class <tt class="docutils literal"><span class="pre">Parameters</span></tt> where we
in the <tt class="docutils literal"><span class="pre">set</span></tt> and <tt class="docutils literal"><span class="pre">get</span></tt> functions test for valid parameter names and
raise exceptions with informative messages if any name is not registered.</p>
</div>
<div class="section" id="the-problem-class-2">
<h4>The problem class  (2)<a class="headerlink" href="#the-problem-class-2" title="Permalink to this headline">¶</a></h4>
<p id="index-25">A class <tt class="docutils literal"><span class="pre">Problem</span></tt> for the problem <span class="math">\(u'=-au\)</span>, <span class="math">\(u(0)=I\)</span>, <span class="math">\(t\in (0,T]\)</span>, with
parameters input <span class="math">\(a\)</span>, <span class="math">\(I\)</span>, and <span class="math">\(T\)</span> can now be coded as</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Problem</span><span class="p">(</span><span class="n">Parameters</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Physical parameters for the problem u&#39;=-a*u, u(0)=I,</span>
<span class="sd">    with t in [0,T].</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prm</span>  <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="s">&#39;initial condition, u(0)&#39;</span><span class="p">,</span>
                         <span class="n">a</span><span class="o">=</span><span class="s">&#39;coefficient in ODE&#39;</span><span class="p">,</span>
                         <span class="n">T</span><span class="o">=</span><span class="s">&#39;end time of simulation&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">u_exact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">I</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;I&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">I</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="the-solver-class-2">
<h4>The solver class  (2)<a class="headerlink" href="#the-solver-class-2" title="Permalink to this headline">¶</a></h4>
<p id="index-26">Also the solver class is derived from class <tt class="docutils literal"><span class="pre">Parameters</span></tt> and works with
the <tt class="docutils literal"><span class="pre">prms</span></tt>, <tt class="docutils literal"><span class="pre">types</span></tt>, and <tt class="docutils literal"><span class="pre">help</span></tt> dictionaries in the same way as class
<tt class="docutils literal"><span class="pre">Problem</span></tt>. Otherwise, the code is very similar to the previous class <tt class="docutils literal"><span class="pre">Solver</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Solver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">problem</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problem</span> <span class="o">=</span> <span class="n">problem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prm</span>  <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="s">&#39;time step value&#39;</span><span class="p">,</span>
                         <span class="n">theta</span><span class="o">=</span><span class="s">&#39;time discretization parameter&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">decay_mod</span> <span class="kn">import</span> <span class="n">solver</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;I&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;T&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;dt&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;theta&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">u_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">u_exact</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">u_e</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span>
            <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;dt&#39;</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">E</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">E</span>
</pre></div>
</div>
<p>The advantage with the <tt class="docutils literal"><span class="pre">Parameters</span></tt> class is that it scales to problems
with a large number of physical and numerical parameters:
as long as the parameters are defined once via a dictionary,
the compact code in class <tt class="docutils literal"><span class="pre">Parameters</span></tt> can handle any collection of
parameters of any size.</p>
</div>
</div>
</div>
<div class="section" id="automating-scientific-experiments">
<span id="softeng1-experiments"></span><h2>Automating scientific experiments<a class="headerlink" href="#automating-scientific-experiments" title="Permalink to this headline">¶</a></h2>
<p>Empirical scientific investigations based on running computer programs
require careful design of the experiments and accurate reporting of results.
Although there is a strong tradition to do such investigations manually,
the extreme requirements to scientific accuracy make a program much
better suited to conduct the experiments. We shall in this section outline
how we can write such programs, often called <em>scripts</em>, for running other
programs and archiving the results.</p>
<div class="admonition-scientific-investigation admonition">
<p class="first admonition-title">Scientific investigation</p>
<p class="last">The purpose of the investigations is to explore the quality of numerical
solutions to an ordinary differential equation. More specifically, we
solve the initial-value problem</p>
</div>
<div class="math" id="equation-softeng1:experiments:model">
<span id="eq-softeng1-experiments-model"></span><span class="eqno">(4)</span>\[        u^\prime(t) = -au(t),\quad u(0)=I,\quad t\in (0,T],\]\[by the  \( \theta \) -rule:\]\[.. _Eq:softeng1:experiments:theta:\]</div>
<div class="math" id="equation-softeng1:experiments:theta">
<span class="eqno">(5)</span>\[        u^{n+1} = \frac{1 - (1-\theta) a\Delta t}{1 + \theta a\Delta t}u^n,
        \quad u^0=I{\thinspace .}\]\[This scheme corresponds to well-known methods:  \( \theta=0 \)  gives the
Forward Euler (FE) scheme,  \( \theta=1 \)  gives the Backward Euler (BE) scheme,
and  \( \theta=\frac{1}{2} \)  gives the Crank-Nicolson
(CN) or midpoint/centered scheme.\]\[For fixed  \( I \) ,  \( a \) , and  \( T \) , we run the three schemes for various
values of  \( \Delta t \) , and present in a report the following results:\]\[1. visual comparison of the numerical and exact solution in a plot for
   each  \( \Delta t \)  and  \( \theta=0,1,\frac{1}{2} \) ,\]\[2. a table and a plot of the norm of the numerical error versus  \( \Delta t \) 
   for  \( \theta=0,1,\frac{1}{2} \) .\]\[The report will also document the mathematical details of the problem under
investigation.\]</div>
<div class="section" id="available-software">
<h3>Available software<a class="headerlink" href="#available-software" title="Permalink to this headline">¶</a></h3>
<p>Appropriate software for implementing <a href="#equation-softeng1:experiments:theta">(5)</a>
is available in a program <a class="reference external" href="http://hplgit.github.io/teamods/writing_reports/doconce_src/model.py">model.py</a>, which is run as</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python model.py --I 1.5 --a 0.25 --T 6 --dt 1.25 0.75 0.5
</pre></div>
</div>
<p>The command-line input corresponds to setting <span class="math">\(I=1.5\)</span>, <span class="math">\(a=0.25\)</span>, <span class="math">\(T=6\)</span>,
and run three values of <span class="math">\(\Delta t\)</span>: 1.25, 0.75, ad 0.5.</p>
<p>The results of running this <tt class="docutils literal"><span class="pre">model.py</span></tt> command are text in the
terminal window and a set of plot files.
The plot files have names <tt class="docutils literal"><span class="pre">M_D.E</span></tt>, where <tt class="docutils literal"><span class="pre">M</span></tt> denotes the method
(<tt class="docutils literal"><span class="pre">FE</span></tt>, <tt class="docutils literal"><span class="pre">BE</span></tt>, <tt class="docutils literal"><span class="pre">CN</span></tt> for <span class="math">\(\theta=0,1,\frac{1}{2}\)</span>), <tt class="docutils literal"><span class="pre">D</span></tt>
the time step length (here <tt class="docutils literal"><span class="pre">1.25</span></tt>, <tt class="docutils literal"><span class="pre">0.75</span></tt>, or <tt class="docutils literal"><span class="pre">0.5</span></tt>), and <tt class="docutils literal"><span class="pre">E</span></tt>
is the plot file extension <tt class="docutils literal"><span class="pre">png</span></tt> or <tt class="docutils literal"><span class="pre">pdf</span></tt>.
The text output looks like</p>
<div class="highlight-text"><div class="highlight"><pre>0.0   1.25:    5.998E-01
0.0   0.75:    1.926E-01
0.0   0.50:    1.123E-01
0.0   0.10:    1.558E-02
0.5   1.25:    6.231E-02
0.5   0.75:    1.543E-02
0.5   0.50:    7.237E-03
0.5   0.10:    2.469E-04
1.0   1.25:    1.766E-01
1.0   0.75:    8.579E-02
1.0   0.50:    6.884E-02
1.0   0.10:    1.411E-02
</pre></div>
</div>
<p>The first column is the <span class="math">\(\theta\)</span> value, the next the <span class="math">\(\Delta t\)</span> value,
and the final column represents the numerical error <span class="math">\(E\)</span> (the
norm of discrete error function on the mesh).</p>
</div>
<div class="section" id="required-new-results">
<h3>Required new results<a class="headerlink" href="#required-new-results" title="Permalink to this headline">¶</a></h3>
<p>The results we need for our investigations are slightly different than
what is directly produced by <tt class="docutils literal"><span class="pre">model.py</span></tt>:</p>
<ol class="arabic simple">
<li>We need to collect all the plots for one
numerical method (FE, BE, CN) in a single plot.
For example, if 4 <span class="math">\(\Delta t\)</span> values are run, the summarizing plot
for the BE method has <span class="math">\(2\times 2\)</span> subplots, with the subplot corresponding
to the largest <span class="math">\(\Delta t\)</span> is in the upper left corner and the smallest
is in the bottom right corner.</li>
<li>We need to have a table containing
<span class="math">\(\Delta t\)</span> values in the first column and the numerical error
<span class="math">\(E\)</span> for <span class="math">\(\theta0,0.5,1\)</span>
in the next three columns. This table should be available as a
standard CSV file.</li>
<li>We need to plot the numerical error <span class="math">\(E\)</span> versus <span class="math">\(\Delta t\)</span>
in a log-log plot.</li>
</ol>
<p>Consequently, we need to write a program (script)
that can run <tt class="docutils literal"><span class="pre">model.py</span></tt> as described and
produce the results 1-3 above. This requires combining multiple plot files into
a file and interpreting the output from <tt class="docutils literal"><span class="pre">model.py</span></tt> as data for plotting and
file storage.</p>
<p>If the script&#8217;s name is <tt class="docutils literal"><span class="pre">exper1.py</span></tt>, we run it with the desired <span class="math">\(\Delta t\)</span>
values as positional command-line arguments:</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python exper1.py 0.5 0.25 0.1 0.05
</pre></div>
</div>
<p>This run will then generate eight plot files: <tt class="docutils literal"><span class="pre">FE.png</span></tt> and <tt class="docutils literal"><span class="pre">FE.pdf</span></tt> summarizing
the plots with the FE method, <tt class="docutils literal"><span class="pre">BE.png</span></tt> and <tt class="docutils literal"><span class="pre">BE.pdf</span></tt> with
the BE method, <tt class="docutils literal"><span class="pre">CN.png</span></tt> and <tt class="docutils literal"><span class="pre">CN.pdf</span></tt> with the CN method, and <tt class="docutils literal"><span class="pre">error.png</span></tt>
and <tt class="docutils literal"><span class="pre">error.pdf</span></tt> with the log-log plot of the numerical error versus <span class="math">\(\Delta t\)</span>.
In addition, the table with numerical errors is written to a
file <tt class="docutils literal"><span class="pre">error.csv</span></tt>.</p>
<div class="admonition-reproducible-science admonition">
<p class="first admonition-title">Reproducible science</p>
<p class="last">A script that automates running our computer experiments
will ensure
that the experiments can easily be rerun by ourselves or others in
the future, either to check the results or redo the experiments with
other input data. Also, whatever we did to produce the results is
documented in every detail in the script.
Automating scripts are therefore essential to making our
research <em>reproducible</em>, which is a fundamental principle in science.</p>
</div>
</div>
<div class="section" id="combining-plot-files">
<h3>Combining plot files<a class="headerlink" href="#combining-plot-files" title="Permalink to this headline">¶</a></h3>
<p>Image files can be combined to new files using the
<a class="reference external" href="http://www.imagemagick.org/script/montage.php">montage</a>
and
<a class="reference external" href="http://www.imagemagick.org/script/convert.php">convert</a> programs in
the ImageMagick software suite. However, these programs are best suited for
PNG files. For vector plots in PDF format one needs other tools
to preserve the quality: <tt class="docutils literal"><span class="pre">pdftk</span></tt>, <tt class="docutils literal"><span class="pre">pdfnup</span></tt>, and <tt class="docutils literal"><span class="pre">pdfcrop</span></tt>.
Suppose you have four files <tt class="docutils literal"><span class="pre">f1.png</span></tt>, <tt class="docutils literal"><span class="pre">f2.png</span></tt>, <tt class="docutils literal"><span class="pre">f3.png</span></tt>, and <tt class="docutils literal"><span class="pre">f4.png</span></tt>
and want to combine them into a <span class="math">\(2\times 2\)</span> table of subplots in a new
file <tt class="docutils literal"><span class="pre">f.png</span></tt>, see
Figure <a class="reference internal" href="#softeng1-experiments-fig-be4a"><em>Illustration of the Backward Euler method for four time step values</em></a> for an example.</p>
<div class="figure" id="softeng1-experiments-fig-be4a">
<a class="reference internal image-reference" href="_images/BE4a.png"><img alt="_images/BE4a.png" src="_images/BE4a.png" style="width: 600px;" /></a>
<p class="caption"><em>Illustration of the Backward Euler method for four time step values</em></p>
</div>
<p>The appropriate ImageMagick commands are</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; montage -background white -geometry 100% -tile 2x \
          f1.png f2.png f3.png f4.png f.png
Terminal&gt; convert -trim f.png f.png
Terminal&gt; convert f.png -transparent white f.png
</pre></div>
</div>
<p>The first command mounts the four files in one, the next <tt class="docutils literal"><span class="pre">convert</span></tt> command
removes unnecessary surrounding white space, and the final <tt class="docutils literal"><span class="pre">convert</span></tt> command
makes the white background transparent.</p>
<p>High-quality montage of PDF files <tt class="docutils literal"><span class="pre">f1.pdf</span></tt>,
<tt class="docutils literal"><span class="pre">f2.pdf</span></tt>, <tt class="docutils literal"><span class="pre">f3.pdf</span></tt>, and <tt class="docutils literal"><span class="pre">f4.pdf</span></tt> into <tt class="docutils literal"><span class="pre">f.pdf</span></tt> goes like</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; pdftk f1.pdf f2.pdf f3.pdf f4.pdf output tmp.pdf
Terminal&gt; pdfnup --nup 2x2 --outfile tmp.pdf tmp.pdf
Terminal&gt; pdfcrop tmp.pdf f.pdf
Terminal&gt; rm -f tmp.pdf
</pre></div>
</div>
</div>
<div class="section" id="running-a-program-from-python">
<h3>Running a program from Python<a class="headerlink" href="#running-a-program-from-python" title="Permalink to this headline">¶</a></h3>
<p>Suppose you want to run some operating system command stored in a string
<tt class="docutils literal"><span class="pre">cmd</span></tt>. For example, <tt class="docutils literal"><span class="pre">cmd</span></tt> could be <tt class="docutils literal"><span class="pre">python</span> <span class="pre">model.py</span> <span class="pre">--I</span> <span class="pre">1</span> <span class="pre">--dt</span> <span class="pre">0.5</span> <span class="pre">0.2</span></tt>.
The following Python code
executes <tt class="docutils literal"><span class="pre">cmd</span></tt> and loads the text output into a string <tt class="docutils literal"><span class="pre">output</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span><span class="p">,</span> <span class="n">STDOUT</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">STDOUT</span><span class="p">)</span>
<span class="n">output</span><span class="p">,</span> <span class="n">dummy</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>

<span class="c"># Check if run was successful</span>
<span class="n">failure</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span>
<span class="k">if</span> <span class="n">failure</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;Command failed:&#39;</span><span class="p">,</span> <span class="n">cmd</span><span class="p">;</span> <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>In our case, we need to interpret the contents of <tt class="docutils literal"><span class="pre">output</span></tt> and store
the data in an appropriate data structure.
Since the content is basically a table and will be transformed to
a spread sheet format, we let the columns in the table be lists,
and we collect the columns in a dictionary whose keys are natural
column names: <tt class="docutils literal"><span class="pre">dt</span></tt> and the three values of <span class="math">\(\theta\)</span>.
The following code translates <tt class="docutils literal"><span class="pre">output</span></tt> to such a dictionary of lists:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">errors</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;dt&#39;</span><span class="p">:</span> <span class="n">dt_values</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="p">[],</span> <span class="mi">0</span><span class="p">:</span> <span class="p">[],</span> <span class="mf">0.5</span><span class="p">:</span> <span class="p">[]}</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;0.0&#39;</span><span class="p">,</span> <span class="s">&#39;0.5&#39;</span><span class="p">,</span> <span class="s">&#39;1.0&#39;</span><span class="p">):</span>  <span class="c"># line with E?</span>
        <span class="c"># typical line: 0.0   1.25:    7.463E+00</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">E</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">errors</span><span class="p">[</span><span class="n">theta</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="the-automating-script">
<h3>The automating script<a class="headerlink" href="#the-automating-script" title="Permalink to this headline">¶</a></h3>
<p>Running <tt class="docutils literal"><span class="pre">model.py</span></tt> for a set of <span class="math">\(\Delta t\)</span> values and producing files as
described above, can be done by the following code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">run_experiments</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="c"># The command line must contain dt values</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">dt_values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Usage: </span><span class="si">%s</span><span class="s"> dt1 dt2 dt3 ...&#39;</span> <span class="o">%</span>  <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># abort</span>

    <span class="c"># Run module file and grab output</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;python model.py --I </span><span class="si">%g</span><span class="s"> --a </span><span class="si">%g</span><span class="s"> --T </span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
    <span class="n">dt_values_str</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dt_values</span><span class="p">])</span>
    <span class="n">cmd</span> <span class="o">+=</span> <span class="s">&#39; --dt </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">dt_values_str</span>
    <span class="k">print</span> <span class="n">cmd</span>
    <span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span><span class="p">,</span> <span class="n">STDOUT</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">STDOUT</span><span class="p">)</span>
    <span class="n">output</span><span class="p">,</span> <span class="n">dummy</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="n">failure</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span>
    <span class="k">if</span> <span class="n">failure</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Command failed:&#39;</span><span class="p">,</span> <span class="n">cmd</span><span class="p">;</span> <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">errors</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;dt&#39;</span><span class="p">:</span> <span class="n">dt_values</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="p">[],</span> <span class="mi">0</span><span class="p">:</span> <span class="p">[],</span> <span class="mf">0.5</span><span class="p">:</span> <span class="p">[]}</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;0.0&#39;</span><span class="p">,</span> <span class="s">&#39;0.5&#39;</span><span class="p">,</span> <span class="s">&#39;1.0&#39;</span><span class="p">):</span>  <span class="c"># line with E?</span>
            <span class="c"># typical line: 0.0   1.25:    7.463E+00</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">E</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">errors</span><span class="p">[</span><span class="n">theta</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>

    <span class="c"># Find min/max for the axis</span>
    <span class="n">E_min</span> <span class="o">=</span> <span class="mf">1E+20</span><span class="p">;</span> <span class="n">E_max</span> <span class="o">=</span> <span class="o">-</span><span class="n">E_min</span>
    <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">E_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">E_min</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="n">theta</span><span class="p">]))</span>
        <span class="n">E_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">E_max</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="n">theta</span><span class="p">]))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;dt&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;ro-&#39;</span><span class="p">)</span>
    <span class="c">#plt.hold(&#39;on&#39;)  # Matlab style...</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;dt&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="p">[</span><span class="mf">0.5</span><span class="p">],</span> <span class="s">&#39;b+-&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;dt&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;gx-&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&#39;FE&#39;</span><span class="p">,</span> <span class="s">&#39;CN&#39;</span><span class="p">,</span> <span class="s">&#39;BE&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s">&#39;upper left&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;log(time step)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;log(error)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">dt_values</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">dt_values</span><span class="p">),</span> <span class="n">E_min</span><span class="p">,</span> <span class="n">E_max</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Error vs time step&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;error.png&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;error.pdf&#39;</span><span class="p">)</span>
    <span class="c"># Write out a table in CSV format</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;error.csv&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">r&#39;$\Delta t$,$\theta=0$,$\theta=0.5$,$\theta=1$&#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_dt</span><span class="p">,</span> <span class="n">_fe</span><span class="p">,</span> <span class="n">_cn</span><span class="p">,</span> <span class="n">_be</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="n">errors</span><span class="p">[</span><span class="s">&#39;dt&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">errors</span><span class="p">[</span><span class="mf">0.5</span><span class="p">],</span> <span class="n">errors</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%.2f</span><span class="s">,</span><span class="si">%.4f</span><span class="s">,</span><span class="si">%.4f</span><span class="s">,</span><span class="si">%.4f</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_dt</span><span class="p">,</span> <span class="n">_fe</span><span class="p">,</span> <span class="n">_cn</span><span class="p">,</span> <span class="n">_be</span><span class="p">))</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c"># Combine images into rows with 2 plots in each row</span>
    <span class="n">image_commands</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="s">&#39;BE&#39;</span><span class="p">,</span> <span class="s">&#39;CN&#39;</span><span class="p">,</span> <span class="s">&#39;FE&#39;</span><span class="p">:</span>
        <span class="n">pdf_files</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%g</span><span class="s">.pdf&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
                              <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">dt_values</span><span class="p">])</span>
        <span class="n">png_files</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%g</span><span class="s">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
                              <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">dt_values</span><span class="p">])</span>
        <span class="n">image_commands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s">&#39;montage -background white -geometry 100%&#39;</span> <span class="o">+</span>
            <span class="s">&#39; -tile 2x </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">png_files</span><span class="p">,</span> <span class="n">method</span><span class="p">))</span>
        <span class="n">image_commands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s">&#39;convert -trim </span><span class="si">%s</span><span class="s">.png </span><span class="si">%s</span><span class="s">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">method</span><span class="p">))</span>
        <span class="n">image_commands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s">&#39;convert </span><span class="si">%s</span><span class="s">.png -transparent white </span><span class="si">%s</span><span class="s">.png&#39;</span> <span class="o">%</span>
            <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">method</span><span class="p">))</span>
        <span class="n">image_commands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s">&#39;pdftk </span><span class="si">%s</span><span class="s"> output tmp.pdf&#39;</span> <span class="o">%</span> <span class="n">pdf_files</span><span class="p">)</span>
        <span class="n">num_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dt_values</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">))</span>
        <span class="n">image_commands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s">&#39;pdfnup --nup 2x</span><span class="si">%d</span><span class="s"> --outfile tmp.pdf tmp.pdf&#39;</span> <span class="o">%</span> <span class="n">num_rows</span><span class="p">)</span>
        <span class="n">image_commands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s">&#39;pdfcrop tmp.pdf </span><span class="si">%s</span><span class="s">.pdf&#39;</span> <span class="o">%</span> <span class="n">method</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">image_commands</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">cmd</span>
        <span class="n">failure</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">failure</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Command failed:&#39;</span><span class="p">,</span> <span class="n">cmd</span><span class="p">;</span> <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c"># Remove the files generated above and by model.py</span>
    <span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
    <span class="n">filenames</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="s">&#39;*_*.png&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">glob</span><span class="p">(</span><span class="s">&#39;*_*.pdf&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">glob</span><span class="p">(</span><span class="s">&#39;tmp*.pdf&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">run_experiments</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>  <span class="c"># at the end of the program</span>
</pre></div>
</div>
<span class="target" id="index-27"></span><span class="target" id="index-28"></span><p id="index-29">We may comment upon many useful constructs in this script:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">[float(arg)</span> <span class="pre">for</span> <span class="pre">arg</span> <span class="pre">in</span> <span class="pre">sys.argv[1:]]</span></tt> builds a list of real numbers
from all the command-line arguments.</li>
<li><tt class="docutils literal"><span class="pre">failure</span> <span class="pre">=</span> <span class="pre">os.system(cmd)</span></tt> runs an operating system command, e.g.,
another program. The execution is successful only if <tt class="docutils literal"><span class="pre">failure</span></tt> is zero.</li>
<li>Unsuccessful execution usually makes it meaningless to continue
the program, and therefore we abort the program with <tt class="docutils literal"><span class="pre">sys.exit(1)</span></tt>.
Any argument different from 0 signifies to the computer&#8217;s operating system
that our program stopped with a failure.</li>
<li><tt class="docutils literal"><span class="pre">['%s_%s.png'</span> <span class="pre">%</span> <span class="pre">(method,</span> <span class="pre">dt)</span> <span class="pre">for</span> <span class="pre">dt</span> <span class="pre">in</span> <span class="pre">dt_values]</span></tt> builds a list of
filenames from a list of numbers (<tt class="docutils literal"><span class="pre">dt_values</span></tt>).</li>
<li>All <tt class="docutils literal"><span class="pre">montage</span></tt>, <tt class="docutils literal"><span class="pre">convert</span></tt>, <tt class="docutils literal"><span class="pre">pdftk</span></tt>, <tt class="docutils literal"><span class="pre">pdfnup</span></tt>, and <tt class="docutils literal"><span class="pre">pdfcrop</span></tt>
commands for creating
composite figures are stored in a
list and later executed in a loop.</li>
<li><tt class="docutils literal"><span class="pre">glob('*_*.png')</span></tt> returns a list of the names of all files in the
current directory where the filename matches the <a class="reference external" href="http://en.wikipedia.org/wiki/Glob_(programming)">Unix wildcard notation</a>
<tt class="docutils literal"><span class="pre">*_*.png</span></tt> (meaning any text, underscore, any text, and then <tt class="docutils literal"><span class="pre">.png</span></tt>).</li>
<li><tt class="docutils literal"><span class="pre">os.remove(filename)</span></tt> removes the file with name <tt class="docutils literal"><span class="pre">filename</span></tt>.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="making-a-report">
<span id="softeng1-exper-report"></span><h3>Making a report<a class="headerlink" href="#making-a-report" title="Permalink to this headline">¶</a></h3>
<p>The results of running computer experiments are best documented in a
little report containing the problem to be solved, key code segments,
and the plots from a series of experiments. At least the part of the
report containing the plots should be automatically generated by the
script that performs the set of experiments, because in that script we
know exactly which input data that were used to generate a specific
plot, thereby ensuring that each figure is connected to the
right data. Take a look at an
example at <a class="reference external" href="http://hplgit.github.io/teamods/writing_reports/sphinx-cloud/">http://hplgit.github.io/teamods/writing_reports/sphinx-cloud/</a>  to see what we have in
mind.</p>
<div class="section" id="plain-html">
<h4>Plain HTML<a class="headerlink" href="#plain-html" title="Permalink to this headline">¶</a></h4>
<p>Scientific reports can be written in a variety of formats. Here we
begin with the <a class="reference external" href="http://en.wikipedia.org/wiki/HTML">HTML</a> format
which allows efficient viewing of all the experiments in any web
browser. The program
<a class="reference external" href="http://hplgit.github.io/teamods/writing_reports/report_generation/exper1_html.py">exper1_html.py</a> calls
<tt class="docutils literal"><span class="pre">exper1.py</span></tt> to perform the experiments and then runs
statements for creating an HTML file with a summary, a
section on the mathematical problem, a section on the numerical
method, a section on the <tt class="docutils literal"><span class="pre">solver</span></tt> function implementing the
method, and a section with subsections containing figures that show
the results of experiments where <span class="math">\(\Delta t\)</span> is varied for
<span class="math">\(\theta=0,0.5,1\)</span>. The mentioned
Python file contains all the details for writing
this <a class="reference external" href="http://hplgit.github.io/teamods/writing_reports/_static/report_html.html.html">HTML report</a>.
You can view the report on <a class="reference external" href="http://hplgit.github.io/teamods/writing_reports/_static/report_html.html">http://hplgit.github.io/teamods/writing_reports/_static/report_html.html</a>.</p>
</div>
<div class="section" id="html-with-mathjax">
<h4>HTML with MathJax<a class="headerlink" href="#html-with-mathjax" title="Permalink to this headline">¶</a></h4>
<p>Scientific reports usually need mathematical formulas and hence
mathematical typesetting. In plain HTML, as used in the
<tt class="docutils literal"><span class="pre">exper1_html.py</span></tt> file, we have to use just the keyboard
characters to write mathematics. However, there is an extension to
HTML, called <a class="reference external" href="http://www.mathjax.org/">MathJax</a>, which allows
formulas and equations to be typeset with LaTeX syntax and nicely
rendered in web browsers, see Figure
<a class="reference internal" href="#softeng1-exper-report-fig-mathjax"><em>Report in HTML format with MathJax</em></a>.  A relatively small subset of
LaTeX environments is supported, but the syntax for formulas is quite
rich. Inline formulas are look like <tt class="docutils literal"><span class="pre">\(</span> <span class="pre">u'=-au</span> <span class="pre">\)</span></tt> while equations are
surrounded by <tt class="docutils literal"><span class="pre">$$</span></tt> signs.  Inside such signs, one can use <tt class="docutils literal"><span class="pre">\[</span> <span class="pre">u'=-au</span>
<span class="pre">\]</span></tt> for unnumbered equations, or <tt class="docutils literal"><span class="pre">\begin{equation}</span></tt> and
<tt class="docutils literal"><span class="pre">\end{equation}</span></tt> surrounding <tt class="docutils literal"><span class="pre">u'=-au</span></tt> for numbered equations, or
<tt class="docutils literal"><span class="pre">\begin{equation}</span></tt> and <tt class="docutils literal"><span class="pre">\end{equation}</span></tt> for multiple aligned equations.  You
need to be familiar with <a class="reference external" href="http://en.wikibooks.org/wiki/LaTeX/Mathematics">mathematical typesetting in LaTeX</a>.</p>
<p>The file <a class="reference external" href="http://hplgit.github.io/teamods/writing_reports/report_generation/exper1_html.py">exper1_mathjax.py</a> contains all the
details for turning the previous plain HTML report into <a class="reference external" href="http://hplgit.github.io/teamods/writing_reports/_static/report_mathjax.html">web pages
with nicely typeset mathematics</a>.  The
<a class="reference external" href="http://hplgit.github.io/teamods/writing_reports/_static/report_mathjax.html.html">corresponding HTML code</a> be studied
to see all details of the mathematical typesetting.</p>
<div class="figure" id="softeng1-exper-report-fig-mathjax">
<a class="reference internal image-reference" href="_images/report_mathjax.png"><img alt="_images/report_mathjax.png" src="_images/report_mathjax.png" style="width: 600px;" /></a>
<p class="caption"><em>Report in HTML format with MathJax</em></p>
</div>
</div>
<div class="section" id="latex">
<h4>LaTeX<a class="headerlink" href="#latex" title="Permalink to this headline">¶</a></h4>
<p>The <em>de facto</em> language for mathematical typesetting and scientific
report writing is <a class="reference external" href="http://en.wikipedia.org/wiki/LaTeX">LaTeX</a>. A
number of very sophisticated packages have been added to the language
over a period of three decades, allowing very fine-tuned layout and
typesetting. For output in the <a class="reference external" href="http://hplgit.github.io/teamods/writing_reports/_static/report.pdf">PDF format</a>, see Figure
<a class="reference internal" href="#softeng1-exper-report-fig-latex"><em>Report in PDF format generated from LaTeX source</em></a> for an example, LaTeX is the
definite choice when it comes to quality. The LaTeX language used to
write the reports has typically a lot of commands involving
<a class="reference external" href="http://hplgit.github.io/teamods/writing_reports/_static/report.tex.html">backslashes and braces</a>.  For output on the web,
using HTML (and not the PDF directly in the browser window), LaTeX
struggles with delivering high quality typesetting. Other tools,
especially Sphinx, give better results and can also produce
nice-looking PDFs.  The file <a class="reference external" href="http://hplgit.github.io/teamods/writing_reports/report_generation/exper1_latex.py">exper1_latex.py</a> shows how to
generate the LaTeX source from a program.</p>
<div class="figure" id="softeng1-exper-report-fig-latex">
<a class="reference internal image-reference" href="_images/report_latexpdf.png"><img alt="_images/report_latexpdf.png" src="_images/report_latexpdf.png" style="width: 600px;" /></a>
<p class="caption"><em>Report in PDF format generated from LaTeX source</em></p>
</div>
</div>
<div class="section" id="sphinx">
<h4>Sphinx<a class="headerlink" href="#sphinx" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="http://sphinx.pocoo.org/">Sphinx</a> is a typesetting language with
similarities to HTML and LaTeX, but with much less tagging. It has
recently become very popular for software documentation and
mathematical reports. Sphinx can utilize LaTeX for mathematical
formulas and equations (via MathJax or PNG images). Unfortunately, the
subset of LaTeX mathematics supported is less than in full MathJax (in
particular, numbering of multiple equations in an <tt class="docutils literal"><span class="pre">align</span></tt> type
environment is not supported).  The <a class="reference external" href="http://hplgit.github.io/teamods/writing_reports/_static/report_sphinx.rst.html">Sphinx syntax</a> is an extension of
the reStructuredText language. An attractive feature of Sphinx is its
rich support for <a class="reference external" href="http://hplgit.github.io/teamods/writing_reports/_static/sphinx-cloud/index.html">fancy layout of web pages</a>. In particular,
Sphinx can easily be combined with various layout <em>themes</em> that give a
certain look and feel to the web site and that offers table of
contents, navigation, and search facilities, see Figure
<a class="reference internal" href="#softeng1-exper-report-fig-sphinx"><em>Report in HTML format generated from Sphinx source</em></a>.</p>
<div class="figure" id="softeng1-exper-report-fig-sphinx">
<a class="reference internal image-reference" href="_images/report_sphinx.png"><img alt="_images/report_sphinx.png" src="_images/report_sphinx.png" style="width: 600px;" /></a>
<p class="caption"><em>Report in HTML format generated from Sphinx source</em></p>
</div>
</div>
<div class="section" id="markdown">
<h4>Markdown<a class="headerlink" href="#markdown" title="Permalink to this headline">¶</a></h4>
<p>A recently popular format for easy writing of web pages is
<a class="reference external" href="http://daringfireball.net/projects/markdown/">Markdown</a>.
Text is written very much like one would do in email, using
spacing and special characters to naturally format the code
instead of heavily tagging the text as in LaTeX and HTML.
With the tool <a class="reference external" href="http://johnmacfarlane.net/pandoc/">Pandoc</a> one
can go from Markdown to a variety of formats.
HTML is a common output format, but LaTeX, epub, XML,
OpenOffice, MediaWiki, and MS Word are some other possibilities.</p>
</div>
<div class="section" id="wiki-formats">
<h4>Wiki formats<a class="headerlink" href="#wiki-formats" title="Permalink to this headline">¶</a></h4>
<p>A range of wiki formats are popular for creating notes on the web,
especially documents which allow groups of people to edit and add
content. Apart from <a class="reference external" href="http://www.mediawiki.org/wiki/MediaWiki">MediaWiki</a> (the wiki format used for
Wikipedia), wiki formats have no support for mathematical typesetting
and also limited tools for displaying computer code in nice ways.
Wiki formats are therefore less suitable for scientific reports compared
to the other formats mentioned here.</p>
</div>
<div class="section" id="doconce">
<h4>DocOnce<a class="headerlink" href="#doconce" title="Permalink to this headline">¶</a></h4>
<p>Since it is difficult to choose the right tool or format for writing a
scientific report, it is advantageous to write the content in a format
that easily translates to LaTeX, HTML, Sphinx, Markdown, and various
wikis. <a class="reference external" href="https://github.com/hplgit/doconce">DocOnce</a> is such a
tool. It is similar to Pandoc, but offers some special convenient
features for writing about mathematics and programming.  The <a class="reference external" href="http://hplgit.github.io/teamods/writing_reports/_static/report.do.txt.html">tagging
is modest</a>, somewhere
between LaTeX and Markdown.  The program <a class="reference external" href="http://hplgit.github.io/teamods/writing_reports/report_generation/exper1_do.py">exper1_do.py</a> demonstrates how
to generate (and write) DocOnce code for a report.</p>
</div>
<div class="section" id="worked-example">
<h4>Worked example<a class="headerlink" href="#worked-example" title="Permalink to this headline">¶</a></h4>
<p>The HTML, LaTeX (PDF), Sphinx, and DocOnce formats for the scientific
report whose content is outlined above, are exemplified
with source codes and results at the
web pages associated with this teaching material:
<a class="reference external" href="http://hplgit.github.io/teamods/writing_reports">http://hplgit.github.io/teamods/writing_reports</a>.</p>
</div>
</div>
<div class="section" id="publishing-a-complete-project">
<span id="softeng1-exper-github"></span><h3>Publishing a complete project<a class="headerlink" href="#publishing-a-complete-project" title="Permalink to this headline">¶</a></h3>
<p>A report documenting scientific investigations should be accompanied by
all the software and data used for the investigations so that others
have a possibility to redo the work and assess the qualify of the results.
This possibility is important for <em>reproducible research</em> and
hence reaching reliable scientific conclusions.</p>
<p>One way of documenting a complete project is to make a directory tree
with all relevant files. Preferably, the tree is published at
some project hosting site like <a class="reference external" href="http://hplgit.github.com/teamods/bitgit/html/">Bitbucket or GitHub</a> so that others can download it
as a tarfile, zipfile, or clone the files directly using the Git version control
system.
For the investigations outlined in the section <a class="reference internal" href="#softeng1-exper-report"><em>Making a report</em></a>,
we can create a directory tree with files</p>
<div class="highlight-text"><div class="highlight"><pre>setup.py
./src:
   model.py
./doc:
   ./src:
      exper1_mathjax.py
      make_report.sh
      run.sh
   ./pub:
      report.html
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">src</span></tt> directory holds source code (modules) to be reused in other projects,
the <tt class="docutils literal"><span class="pre">setup.py</span></tt> builds and installs such software,
the <tt class="docutils literal"><span class="pre">doc</span></tt> directory contains the documentation, with <tt class="docutils literal"><span class="pre">src</span></tt> for the
source of the documentation and <tt class="docutils literal"><span class="pre">pub</span></tt> for ready-made, published documentation.
The <tt class="docutils literal"><span class="pre">run.sh</span></tt> file is a simple Bash script listing the <tt class="docutils literal"><span class="pre">python</span></tt> command
we used to run <tt class="docutils literal"><span class="pre">exper1_mathjax.py</span></tt> to generate the experiments and
the <tt class="docutils literal"><span class="pre">report.html</span></tt> file.</p>
</div>
</div>
<div class="section" id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<div class="section" id="problem-1-make-a-tool-for-differentiating-curves">
<span id="softeng1-exer-derivative"></span><h3>Problem 1: Make a tool for differentiating curves<a class="headerlink" href="#problem-1-make-a-tool-for-differentiating-curves" title="Permalink to this headline">¶</a></h3>
<p>Suppose we have a curve specified through a set
of discrete coordinates <span class="math">\((x_i,y_i)\)</span>, <span class="math">\(i=0,\ldots,n\)</span>, where the <span class="math">\(x_i\)</span>
values are uniformly distributed with spacing <span class="math">\(\Delta x\)</span>: <span class="math">\(x_i=\Delta x\)</span>.
The derivative of this curve, defined as a new curve with points
<span class="math">\((x_i, d_i)\)</span>, can be computed via finite differences:</p>
<div class="math">
\[d_0 = \frac{y_1-y_0}{\Delta x},\]</div>
<div class="math">
\[d_i = \frac{y_{i+1}-y_{i-1}}{2\Delta x},\quad i=1,\ldots,n-1,\]</div>
<div class="math">
\[d_n = \frac{y_n-y_{n-1}}{\Delta x}{\thinspace .}\]</div>
<p><strong>a)</strong>
Write a function
<tt class="docutils literal"><span class="pre">differentiate(x,</span> <span class="pre">y)</span></tt> for differentiating a curve</p>
<blockquote>
<div>with coordinates in the arrays <tt class="docutils literal"><span class="pre">x</span></tt> and <tt class="docutils literal"><span class="pre">y</span></tt>, using the
formulas above. The function should return the coordinate arrays</div></blockquote>
<p>of the resulting differentiated curve.</p>
<p><strong>b)</strong>
Write a test function for the function in a).</p>
<p><strong>c)</strong>
Start with a curve corresponding to <span class="math">\(y=\sin(\pi x)\)</span> and <span class="math">\(n+1\)</span>
points in <span class="math">\([0,1]\)</span>. Apply <tt class="docutils literal"><span class="pre">differentiate</span></tt> four times and plot the
resulting curve and the exact <span class="math">\(y=\sin\pi x\)</span> for <span class="math">\(n=6, 11, 21, 41\)</span>.</p>
<p>Filename: <tt class="docutils literal"><span class="pre">curvediff.py</span></tt>.</p>
</div>
<div class="section" id="problem-2-make-solid-software-for-the-trapezoidal-rule">
<span id="softeng1-exer-integral-flat"></span><h3>Problem 2: Make solid software for the Trapezoidal rule<a class="headerlink" href="#problem-2-make-solid-software-for-the-trapezoidal-rule" title="Permalink to this headline">¶</a></h3>
<p>An integral</p>
<div class="math">
\[\int_a^b f(x)dx\]</div>
<p>can be numerically approximated by the Trapezoidal rule,</p>
<div class="math">
\[\int_a^b f(x)dx \approx \frac{h}{2}(f(a) + f(b)) + h\sum_{i=1}^{n-1} f(x_i),\]</div>
<p>where <span class="math">\(x_i\)</span> is a set of uniformly spaced points in <span class="math">\([a,b]\)</span>:</p>
<div class="math">
\[h = \frac{b-a}{n},\quad x_i=a + ih,\ i=1,\ldots,n-1{\thinspace .}\]</div>
<p>Somebody has used this rule to compute the integral <span class="math">\(\int_0^\pi sin^2x dx\)</span>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">pi</span><span class="p">,</span> <span class="n">sin</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">pi</span><span class="o">/</span><span class="n">n</span>
<span class="n">I</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="n">I</span> <span class="o">+=</span> <span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">h</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<span class="k">print</span> <span class="n">I</span>
</pre></div>
</div>
<p><strong>a)</strong>
The &#8220;flat&#8221; implementation above suffers from three serious flaws:</p>
<ol class="arabic simple">
<li>A general numerical algorithm (the Trapezoidal rule) is implemented
in a specialized form where the formula for <span class="math">\(f\)</span> is inserted directly
into the code for the general integration formula.</li>
<li>A general numerical algorithm is not encapsulated as a general
function, with appropriate parameters, which can be reused
across a wide range of applications.</li>
<li>The lazy programmer dropped the first terms in the general formula
since <span class="math">\(\sin(0)=\sin(\pi)=0\)</span>.</li>
</ol>
<p>Write a function <tt class="docutils literal"><span class="pre">trapezoidal</span></tt> that fixes these flaws.
Place the function in a module <tt class="docutils literal"><span class="pre">trapezoidal</span></tt>.</p>
<p><strong>b)</strong>
Write a test function <tt class="docutils literal"><span class="pre">test_trapezoidal</span></tt>. Call the test function
explicitly to check that it works. Remove the call and run pytest
on the module:</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; py.test -s -v trapezoidal
</pre></div>
</div>
<p><strong>Hint.</strong>
Note that even if you know the value of the integral, you do not know
the error in the approximation produced by the Trapezoidal rule.
However, the Trapezoidal rule will integrate linear functions,
and piecewise linear functions, with discontinuities at the <span class="math">\(x_i\)</span>
points, exactly (i.e., to machine precision). Base a test function
on such linear functions <span class="math">\(f(x)\)</span>.</p>
<p><strong>c)</strong>
Add functionality for computing <span class="math">\(\int_a^b f(x)dx\)</span> by providing
<span class="math">\(f\)</span>, <span class="math">\(a\)</span>, <span class="math">\(b\)</span>, and <span class="math">\(n\)</span> as positional command-line arguments:</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python trapezoidal.py &#39;sin(x)**2&#39; 0 pi 20
</pre></div>
</div>
<p>Note that the <tt class="docutils literal"><span class="pre">trapezoidal.py</span></tt> must still be a valid module file, so the
interpretation of command-line data and computation of the integral
must be performed from calls in a test block.</p>
<p><strong>Hint.</strong>
To translate a string formula on the command line, like <tt class="docutils literal"><span class="pre">sin(x)**2</span></tt>,
into a Python function, you can wrap a function declaration around
the formula and run <tt class="docutils literal"><span class="pre">exec</span></tt> on the string to turn it into live Python code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">math</span><span class="o">,</span> <span class="nn">sys</span>
<span class="n">formula</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">f_code</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">def f(x):</span>
<span class="s">    return </span><span class="si">%s</span><span class="s"></span>
<span class="s">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">formula</span>
<span class="k">exec</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
</pre></div>
</div>
<p>The result is the same as if we had hardcoded</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
<p>in the program. Note that <tt class="docutils literal"><span class="pre">exec</span></tt> needs the namespace
<tt class="docutils literal"><span class="pre">math.__dict__</span></tt>, i.e., all names in the <tt class="docutils literal"><span class="pre">math</span></tt> module, such that
it understands <tt class="docutils literal"><span class="pre">sin</span></tt> and other mathematical functions.
Similarly, to allow <span class="math">\(a\)</span> and <span class="math">\(b\)</span> to be <tt class="docutils literal"><span class="pre">math</span></tt> values like <tt class="docutils literal"><span class="pre">pi</span></tt>,
do</p>
<div class="highlight-text"><div class="highlight"><pre>a = eval(sys.argv[2], math.__dict__)
b = eval(sys.argv[2], math.__dict__)
</pre></div>
</div>
<p><strong>d)</strong>
Write a test function for verifying the implementation of the
reading data from the command line.</p>
<p>Filename: <tt class="docutils literal"><span class="pre">trapezoidal.py</span></tt>.</p>
</div>
<div class="section" id="problem-3-implement-classes-for-the-trapezoidal-rule">
<span id="softeng1-exer-integral-flat2"></span><h3>Problem 3: Implement classes for the Trapezoidal rule<a class="headerlink" href="#problem-3-implement-classes-for-the-trapezoidal-rule" title="Permalink to this headline">¶</a></h3>
<p>We consider the same problem setting as in <a class="reference internal" href="#softeng1-exer-integral-flat"><em>Problem 2: Make solid software for the Trapezoidal rule</em></a>. Make a module with a class <tt class="docutils literal"><span class="pre">Problem</span></tt>
representing the mathematical problem to be solved and a class
<tt class="docutils literal"><span class="pre">Solver</span></tt> representing the solution method.  The rest of the
functionality of the module, including test functions and reading data
from the command line, should be as in <a class="reference internal" href="#softeng1-exer-integral-flat"><em>Problem 2: Make solid software for the Trapezoidal rule</em></a>.
Filename: <tt class="docutils literal"><span class="pre">trapezoidal_class.py</span></tt>.</p>
</div>
<div class="section" id="problem-4-write-a-doctest">
<span id="softeng1-exer-doctest1"></span><h3>Problem 4: Write a doctest<a class="headerlink" href="#problem-4-write-a-doctest" title="Permalink to this headline">¶</a></h3>
<p>Type in the following program and equip the <tt class="docutils literal"><span class="pre">roots</span></tt> function with a doctest:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span>
<span class="c"># This sqrt(x) returns real if x&gt;0 and complex if x&lt;0</span>
<span class="kn">from</span> <span class="nn">numpy.lib.scimath</span> <span class="kn">import</span> <span class="n">sqrt</span>

<span class="k">def</span> <span class="nf">roots</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the roots of the quadratic polynomial</span>
<span class="sd">    p(x) = a*x**2 + b*x + c.</span>

<span class="sd">    The roots are real or complex objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">c</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">-</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span>

<span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
<span class="k">print</span> <span class="n">roots</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
<p>Make sure to test both real and complex roots.
Write out numbers with 14 digits or less.
Filename: <tt class="docutils literal"><span class="pre">doctest_roots.py</span></tt>.</p>
</div>
<div class="section" id="problem-5-write-a-nose-test">
<span id="softeng1-exer-nosetest1"></span><h3>Problem 5: Write a nose test<a class="headerlink" href="#problem-5-write-a-nose-test" title="Permalink to this headline">¶</a></h3>
<p>Make a test function for the <tt class="docutils literal"><span class="pre">roots</span></tt> function in
<a class="reference internal" href="#softeng1-exer-doctest1"><em>Problem 4: Write a doctest</em></a>.
Filename: <tt class="docutils literal"><span class="pre">test_roots.py</span></tt>.</p>
</div>
<div class="section" id="exercise-6-make-use-of-a-class-implementation">
<span id="softeng1-exer-class-dts"></span><h3>Exercise 6: Make use of a class implementation<a class="headerlink" href="#exercise-6-make-use-of-a-class-implementation" title="Permalink to this headline">¶</a></h3>
<p>Implement the <tt class="docutils literal"><span class="pre">experiment_compare_dt</span></tt> function from <tt class="docutils literal"><span class="pre">decay.py</span></tt>
using class <tt class="docutils literal"><span class="pre">Problem</span></tt> and class <tt class="docutils literal"><span class="pre">Solver</span></tt> from
the section <a class="reference internal" href="#softeng1-prog-se-class"><em>Classes for problem and solution method</em></a>.
The parameters <tt class="docutils literal"><span class="pre">I</span></tt>, <tt class="docutils literal"><span class="pre">a</span></tt>, <tt class="docutils literal"><span class="pre">T</span></tt>, the scheme name, and a series of
<tt class="docutils literal"><span class="pre">dt</span></tt> values should be read from the command line.
Filename: <tt class="docutils literal"><span class="pre">experiment_compare_dt_class.py</span></tt>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <center>
            <p class="logo"><a href="http://cbc.simula.no/" title="Go to Center for Biomedical Computing">
              <img class="logo" src="_static/cbc_logo.png" alt="Logo"/>
            </a></p>
            </center>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Scientific software engineering with a simple ODE model as example</a><ul>
<li><a class="reference internal" href="#basic-implementations">Basic implementations</a><ul>
<li><a class="reference internal" href="#mathematical-problem-and-solution-technique">Mathematical problem and solution technique</a></li>
<li><a class="reference internal" href="#a-first-quick-implementation">A first, quick implementation</a></li>
<li><a class="reference internal" href="#isolating-the-numerical-algorithm-in-a-function">Isolating the numerical algorithm in a function</a></li>
<li><a class="reference internal" href="#making-a-module">Making a module</a></li>
<li><a class="reference internal" href="#prefixing-imported-functions-by-the-module-name">Prefixing imported functions by the module name</a></li>
<li><a class="reference internal" href="#comparing-numerical-schemes-in-one-plot">Comparing numerical schemes in one plot</a></li>
</ul>
</li>
<li><a class="reference internal" href="#user-interfaces">User interfaces</a><ul>
<li><a class="reference internal" href="#command-line-arguments">Command-line arguments</a></li>
<li><a class="reference internal" href="#positional-command-line-arguments">Positional command-line arguments</a></li>
<li><a class="reference internal" href="#option-value-pairs-on-the-command-line">Option-value pairs on the command line</a></li>
<li><a class="reference internal" href="#creating-a-graphical-web-user-interface">Creating a graphical web user interface</a><ul>
<li><a class="reference internal" href="#making-a-compute-function">Making a compute function</a></li>
<li><a class="reference internal" href="#generating-the-user-interface">Generating the user interface</a></li>
<li><a class="reference internal" href="#running-the-web-application">Running the web application</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#tests-for-verifying-implementations">Tests for verifying implementations</a><ul>
<li><a class="reference internal" href="#doctests">Doctests</a></li>
<li><a class="reference internal" href="#unit-tests-and-test-functions">Unit tests and test functions</a><ul>
<li><a class="reference internal" href="#test-frameworks-nose-and-pytest">Test frameworks: nose and pytest</a></li>
<li><a class="reference internal" href="#test-function-requirements">Test function requirements</a></li>
<li><a class="reference internal" href="#comparison-of-real-numbers">Comparison of real numbers</a></li>
<li><a class="reference internal" href="#special-assert-functions-from-nose">Special assert functions from nose</a></li>
<li><a class="reference internal" href="#locating-test-functions">Locating test functions</a></li>
<li><a class="reference internal" href="#running-tests">Running tests</a></li>
<li><a class="reference internal" href="#installing-nose-and-pytest">Installing nose and pytest</a></li>
</ul>
</li>
<li><a class="reference internal" href="#test-function-for-the-solver">Test function for the solver</a></li>
<li><a class="reference internal" href="#test-function-for-reading-positional-command-line-arguments">Test function for reading positional command-line arguments</a></li>
<li><a class="reference internal" href="#test-function-for-reading-option-value-pairs">Test function for reading option-value pairs</a></li>
<li><a class="reference internal" href="#classical-class-based-unit-testing">Classical class-based unit testing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#classes-for-problem-and-solution-method">Classes for problem and solution method</a><ul>
<li><a class="reference internal" href="#the-problem-class-1">The problem class  (1)</a></li>
<li><a class="reference internal" href="#the-solver-class-1">The solver class  (1)</a><ul>
<li><a class="reference internal" href="#combining-the-objects">Combining the objects</a></li>
</ul>
</li>
<li><a class="reference internal" href="#improving-the-problem-and-solver-classes">Improving the problem and solver classes</a><ul>
<li><a class="reference internal" href="#a-generic-class-for-parameters">A generic class for parameters</a></li>
<li><a class="reference internal" href="#the-problem-class-2">The problem class  (2)</a></li>
<li><a class="reference internal" href="#the-solver-class-2">The solver class  (2)</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#automating-scientific-experiments">Automating scientific experiments</a><ul>
<li><a class="reference internal" href="#available-software">Available software</a></li>
<li><a class="reference internal" href="#required-new-results">Required new results</a></li>
<li><a class="reference internal" href="#combining-plot-files">Combining plot files</a></li>
<li><a class="reference internal" href="#running-a-program-from-python">Running a program from Python</a></li>
<li><a class="reference internal" href="#the-automating-script">The automating script</a></li>
<li><a class="reference internal" href="#making-a-report">Making a report</a><ul>
<li><a class="reference internal" href="#plain-html">Plain HTML</a></li>
<li><a class="reference internal" href="#html-with-mathjax">HTML with MathJax</a></li>
<li><a class="reference internal" href="#latex">LaTeX</a></li>
<li><a class="reference internal" href="#sphinx">Sphinx</a></li>
<li><a class="reference internal" href="#markdown">Markdown</a></li>
<li><a class="reference internal" href="#wiki-formats">Wiki formats</a></li>
<li><a class="reference internal" href="#doconce">DocOnce</a></li>
<li><a class="reference internal" href="#worked-example">Worked example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#publishing-a-complete-project">Publishing a complete project</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exercises">Exercises</a><ul>
<li><a class="reference internal" href="#problem-1-make-a-tool-for-differentiating-curves">Problem 1: Make a tool for differentiating curves</a></li>
<li><a class="reference internal" href="#problem-2-make-solid-software-for-the-trapezoidal-rule">Problem 2: Make solid software for the Trapezoidal rule</a></li>
<li><a class="reference internal" href="#problem-3-implement-classes-for-the-trapezoidal-rule">Problem 3: Implement classes for the Trapezoidal rule</a></li>
<li><a class="reference internal" href="#problem-4-write-a-doctest">Problem 4: Write a doctest</a></li>
<li><a class="reference internal" href="#problem-5-write-a-nose-test">Problem 5: Write a nose test</a></li>
<li><a class="reference internal" href="#exercise-6-make-use-of-a-class-implementation">Exercise 6: Make use of a class implementation</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Scientific software engineering with a simple ODE model as example</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="._main_softeng1001.html"
                        title="next chapter">Bibliography</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/._main_softeng1000.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="._main_softeng1001.html" title="Bibliography"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Scientific software engineering with a simple ODE model as example"
             >previous</a> |</li>
        <li><a href="index.html">Scientific software engineering with a simple ODE model as example</a> &raquo;</li> 
      </ul>
    </div>
<div class="wrapper">
  <div class="footer">
  <a href="http://cbc.simula.no"><img src="_static/cbc_banner.png" width="100%"><a>
  </div>
</div>

  </body>
</html>