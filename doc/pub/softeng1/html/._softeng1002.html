<!--
Automatically generated HTML file from DocOnce source
(https://github.com/hplgit/doconce/)
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/" />
<meta name="description" content="Scientific software engineering; ODE model">
<meta name="keywords" content="importing modules,list comprehension,option-value pairs (command line),command-line options and values,reading the command line,doctests,software testing doctests,unit testing,software testing nose,software testing pytest,test function,software testing test function,doctest in test function,unit testing,software testing unit testing (class-based),problem class,solver class,wrapper (code),reproducibility,replicability,Unix wildcard notation,wildcard notation (Unix),Word (Microsoft),LibreOffice,OpenOffice,HTML,MathJax,LaTeX,Sphinx (typesetting tool),Markdown,IPython notebooks,Jupyter notebooks,DocOnce,replicability">

<title>Scientific software engineering; ODE model</title>

<!-- Bootstrap style: bootswatch_journal -->
<link href="http://netdna.bootstrapcdn.com/bootswatch/3.1.1/journal/bootstrap.min.css" rel="stylesheet">
<!-- not necessary
<link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
-->

<style type="text/css">
/* Let inline verbatim have the same color as the surroundings */
code { color: inherit; background-color: transparent; }
</style>


</head>

<!-- tocinfo
{'highest level': 1,
 'sections': [(' Basic implementations ',
               1,
               'softeng1:basic',
               'softeng1:basic'),
              (' Mathematical problem and solution technique ',
               2,
               'softeng1:basic:math',
               'softeng1:basic:math'),
              (' A first, quick implementation ',
               2,
               'softeng1:basic:impl1',
               'softeng1:basic:impl1'),
              (' A more decent, flat program ',
               2,
               'softeng1:basic:impl2',
               'softeng1:basic:impl2'),
              (' Implementing the numerical algorithm in a function ',
               2,
               'softeng1:basic:func',
               'softeng1:basic:func'),
              (' Making a module ',
               2,
               'softeng1:basic:module',
               'softeng1:basic:module'),
              (' Prefixing imported functions by the module name ',
               2,
               'softeng1:basic:modprefix',
               'softeng1:basic:modprefix'),
              (' Comparing numerical schemes in one plot ',
               2,
               'softeng1:basic:experiment2',
               'softeng1:basic:experiment2'),
              (' Documenting functions and modules ',
               2,
               'softeng1:basic:docstring',
               'softeng1:basic:docstring'),
              (' User interfaces ',
               1,
               'softeng1:basic:UI',
               'softeng1:basic:UI'),
              (' Command-line arguments ', 2, None, '___sec10'),
              (' Positional command-line arguments ', 2, None, '___sec11'),
              (' Option-value pairs on the command line ',
               2,
               None,
               '___sec12'),
              (' Creating a graphical web user interface ',
               2,
               None,
               '___sec13'),
              (' Making a compute function ', 3, None, '___sec14'),
              (' Generating the user interface ', 3, None, '___sec15'),
              (' Running the web application ', 3, None, '___sec16'),
              (' Tests for verifying implementations ', 1, None, '___sec17'),
              (' Doctests ', 2, None, '___sec18'),
              (' Unit tests and test functions ', 2, None, '___sec19'),
              (' Two Python test frameworks: nose and pytest ',
               3,
               None,
               '___sec20'),
              (' Test function requirements ', 3, None, '___sec21'),
              (' Comparison of real numbers ', 3, None, '___sec22'),
              (' Special assert functions from nose ', 3, None, '___sec23'),
              (' Locating test functions ', 3, None, '___sec24'),
              (' Running tests ', 3, None, '___sec25'),
              (' Embedding doctests in a test function ',
               3,
               None,
               '___sec26'),
              (' Installing nose and pytest ', 3, None, '___sec27'),
              (' Test function for the solver ', 2, None, '___sec28'),
              (' Test function for reading positional command-line arguments ',
               2,
               None,
               '___sec29'),
              (' Test function for reading option-value pairs ',
               2,
               None,
               '___sec30'),
              (' Classical class-based unit testing ',
               2,
               'softeng1:basic:unittest',
               'softeng1:basic:unittest'),
              (' Packaging the software for other users ',
               1,
               'softeng1:prog:se:git',
               'softeng1:prog:se:git'),
              (' Software directory tree ', 2, None, '___sec33'),
              (' Distributing just a module file ', 3, None, '___sec34'),
              (' Distributing a package ', 3, None, '___sec35'),
              (' Publishing the software at GitHub ', 2, None, '___sec36'),
              (' Classes for problem and solution method ',
               1,
               'softeng1:prog:se:class',
               'softeng1:prog:se:class'),
              (' The problem class ', 2, None, '___sec38'),
              (' The solver class ', 2, None, '___sec39'),
              (' Combining the objects ', 3, None, '___sec40'),
              (' Improving the problem and solver classes ',
               2,
               'softeng1:prog:se:class2',
               'softeng1:prog:se:class2'),
              (' A generic class for parameters ', 3, None, '___sec42'),
              (' Automating scientific experiments ',
               1,
               'softeng1:experiments',
               'softeng1:experiments'),
              (' Available software ', 2, None, '___sec44'),
              (' Required new results ', 2, None, '___sec45'),
              (' Combining plot files ', 2, None, '___sec46'),
              (' Running a program from Python ', 2, None, '___sec47'),
              (' The automating script ', 2, None, '___sec48'),
              (' Making a report ',
               2,
               'softeng1:exper:report',
               'softeng1:exper:report'),
              (' Word, OpenOffice, GoogleDocs ', 3, None, '___sec50'),
              (' HTML with MathJax ', 3, None, '___sec51'),
              (' LaTeX ', 3, None, '___sec52'),
              (' Sphinx ', 3, None, '___sec53'),
              (' Markdown ', 3, None, '___sec54'),
              (' IPython/Jupyter notebooks ', 3, None, '___sec55'),
              (' Wiki formats ', 3, None, '___sec56'),
              (' DocOnce ', 3, None, '___sec57'),
              (' Publishing a complete project ',
               2,
               'softeng1:exper:github',
               'softeng1:exper:github'),
              (' Exercises ', 1, None, '___sec59'),
              (' Problem 1: Make a tool for differentiating curves ',
               2,
               'softeng1:exer:derivative',
               'softeng1:exer:derivative'),
              (' Problem 2: Make solid software for the Trapezoidal rule ',
               2,
               'softeng1:exer:integral:flat',
               'softeng1:exer:integral:flat'),
              (' Problem 3: Implement classes for the Trapezoidal rule ',
               2,
               'softeng1:exer:integral:flat2',
               'softeng1:exer:integral:flat2'),
              (' Problem 4: Write a doctest and a test function ',
               2,
               'softeng1:exer:doctest1',
               'softeng1:exer:doctest1'),
              (' Exercise 5: Make use of a class implementation ',
               2,
               'softeng1:exer:class:dts',
               'softeng1:exer:class:dts'),
              (' Bibliography ', 1, None, '___sec65')]}
end of tocinfo -->

<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<!-- newcommands_keep.tex -->
$$
\newcommand{\tp}{\thinspace .}
$$




    
<!-- Bootstrap navigation bar -->
<div class="navbar navbar-default navbar-fixed-top">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="softeng1.html">Scientific software engineering; ODE model</a>
  </div>
  <div class="navbar-collapse collapse navbar-responsive-collapse">
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contents <b class="caret"></b></a>
        <ul class="dropdown-menu">
     <!-- navigation toc: --> <li><a href="#softeng1:basic" style="font-size: 80%;">Basic implementations</a></li>
     <!-- navigation toc: --> <li><a href="._softeng1003.html#softeng1:basic:UI" style="font-size: 80%;">User interfaces</a></li>
     <!-- navigation toc: --> <li><a href="._softeng1004.html#___sec17" style="font-size: 80%;">Tests for verifying implementations</a></li>
     <!-- navigation toc: --> <li><a href="._softeng1005.html#softeng1:prog:se:git" style="font-size: 80%;">Packaging the software for other users</a></li>
     <!-- navigation toc: --> <li><a href="._softeng1006.html#softeng1:prog:se:class" style="font-size: 80%;">Classes for problem and solution method</a></li>
     <!-- navigation toc: --> <li><a href="._softeng1007.html#softeng1:experiments" style="font-size: 80%;">Automating scientific experiments</a></li>
     <!-- navigation toc: --> <li><a href="._softeng1008.html#___sec59" style="font-size: 80%;">Exercises</a></li>
     <!-- navigation toc: --> <li><a href="._softeng1009.html#___sec65" style="font-size: 80%;">Bibliography</a></li>

        </ul>
      </li>
    </ul>
  </div>
</div>
</div> <!-- end of navigation bar -->

<div class="container">

<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p> <!-- add vertical space -->

<a name="part0002"></a>
<!-- !split -->

<h1 id="softeng1:basic">Basic implementations</h1>

<h2 id="softeng1:basic:math">Mathematical problem and solution technique</h2>

<p>
We address the perhaps simplest possible differential equation problem

$$
\begin{align}
u'(t) &= -au(t), \quad t \in (0,T], \tag{1}\\ 
u(0)  &= I,                         \tag{2}
\end{align}
$$

where \( a \), \( I \), and \( T \) are prescribed parameters, and \( u(t) \) is
the unknown function to be estimated. This mathematical model
is relevant for physical phenomena featuring exponential decay
in time, e.g., vertical pressure variation in the atmosphere,
cooling of an object, and radioactive decay.

<p>
The time domain is discretized with points \( 0 = t_0 < t_1 \cdots < t_{N_t}=T \),
here with a constant spacing \( \Delta t \) between the
mesh points: \( \Delta t = t_{n}-t_{n-1} \), \( n=1,\ldots,N_t \). Let
\( u^n \) be the numerical approximation to the exact solution at \( t_n \).
A family of popular numerical methods can be written in the form

$$
\begin{equation}
u^{n+1} = \frac{1 - (1-\theta) a\Delta t}{1 + \theta a\Delta t}u^n,
\tag{3}
\end{equation}
$$

for \( n=0,1,\ldots,N_t-1 \). This numerical scheme corresponds to
the <a href="http://en.wikipedia.org/wiki/Forward_Euler_method" target="_self">Forward Euler</a>
scheme when \( \theta=0 \),
the <a href="http://en.wikipedia.org/wiki/Backward_Euler_method" target="_self">Backward Euler</a>
scheme when \( \theta=1 \),
and the <a href="http://en.wikipedia.org/wiki/Crank-Nicolson" target="_self">Crank-Nicolson</a>
scheme when \( \theta=1/2 \).
The initial condition <a href="#mjx-eqn-2">(2)</a> is key to start
the recursion with a value for \( u^0 \).

<h2 id="softeng1:basic:impl1">A first, quick implementation</h2>

<p>
Solving <a href="#mjx-eqn-3">(3)</a> in a program is very straightforward:
just make a loop over \( n \) and evaluate the formula. The \( u(t_n \))
values for discrete \( n \) can be stored in an array. This makes it easy
to also plot the solution. It would be natural to also add
the exact
solution curve \( u(t)=Ie^{-at} \) to the plot.

<p>
Traditionally, a language like Fortran or C would be adopted for
implementation, but the enormous popularity of MATLAB in the
computational science community over the last two decades, makes
a high-level MATLAB-style implementation natural. Below is such
a code, written in Python with a syntax close to MATLAB and with
a programming style heavenly influenced by &quot;MATLAB scripting&quot;.
A student or engineer would quickly put together statements like
this:

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">A</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">dt</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">theta</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">theta</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

<span class="n">y_e</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">y_e</span> <span class="o">-</span> <span class="n">y</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="k">print</span> <span class="s">&#39;Norm of the error: </span><span class="si">%.3E</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">E</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&#39;r--o&#39;</span><span class="p">)</span>
<span class="n">t_e</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>
<span class="n">y_e</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t_e</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">y_e</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">([</span><span class="s">&#39;numerical, theta=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">theta</span><span class="p">,</span> <span class="s">&#39;exact&#39;</span><span class="p">])</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
<p>
This program is easy to read, and as long it is correct, many will
claim that it has sufficient quality. Nevertheless, the program suffers
from serious flaws that quickly become crucial for writing correct
programs for more complicated mathematical problems. First we list
two serious bad habits:

<ol>
<li> The notation in the program does not correspond <em>exactly</em> to
   the notation in the mathematical problem: the solution is called
   <code>y</code> and corresponds to \( u \) in the mathematical description,
   the variable <code>A</code> corresponds to the mathematical parameter \( I \),
   <code>N</code> in the program is called \( N_t \) in the mathematics.</li>
<li> There are no comments in the program.</li>
</ol>

<h2 id="softeng1:basic:impl2">A more decent, flat program</h2>

<p>
A code with more satisfactory quality arises from
fixing the notation and adding comments:

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">I</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">Nt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">dt</span><span class="p">))</span>     <span class="c"># no of time intervals</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>           <span class="c"># array of u[n] values</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># time mesh</span>
<span class="n">theta</span> <span class="o">=</span> <span class="mi">1</span>                 <span class="c"># Backward Euler method</span>

<span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span>                  <span class="c"># assign initial condition</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nt</span><span class="p">):</span>    <span class="c"># n=0,1,...,Nt-1</span>
    <span class="n">u</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">theta</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

<span class="c"># Compute norm of the error</span>
<span class="n">u_e</span> <span class="o">=</span> <span class="n">I</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">u</span>     <span class="c"># exact u at the mesh points</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">u_e</span> <span class="o">-</span> <span class="n">u</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="k">print</span> <span class="s">&#39;Norm of the error: </span><span class="si">%.3E</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">E</span>

<span class="c"># Compare numerical (u) and exact solution (u_e) in a plot</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="s">&#39;r--o&#39;</span><span class="p">)</span>               <span class="c"># red dashes w/circles</span>
<span class="n">t_e</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>       <span class="c"># very fine mesh for u_e</span>
<span class="n">u_e</span> <span class="o">=</span> <span class="n">I</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t_e</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">u_e</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>             <span class="c"># blue line for u_e</span>
<span class="n">legend</span><span class="p">([</span><span class="s">&#39;numerical, theta=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">theta</span><span class="p">,</span> <span class="s">&#39;exact&#39;</span><span class="p">])</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
<p>
At first sight, this is a good starting point for playing around
with the mathematical problem: we can just change parameters and rerun.
Let us embed the program in an IPython notebook such that we
can get the plot up in the notebook, see Figure <a href="#softeng1:ipynb">1</a>.

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 1:  Flat experimental code in a notebook. <div id="softeng1:ipynb"></div> </p></center>
<p><img src="fig-softeng1/ipynb_flat.png" align="bottom" width=700></p>
</center>

<p>
Although such an interactive session is good for initial exploration,
one will soon extend the experiments and start developing the code
further. Say we want to compare \( \theta =0,1,0.5 \) in the same
plot. This extension requires changes all over the code and quickly
lead to errors. To do something serious with this program we have to
break it into smaller pieces and make sure each piece is well tested,
is general, and can be reused in new contexts without changes.  The
next natural step is therefore to isolate the numerical computations
and the visualization in separate functions.

<h2 id="softeng1:basic:func">Implementing the numerical algorithm in a function</h2>

<p>
The solution formula <a href="#mjx-eqn-3">(3)</a> is completely general and
should be available as a Python function <code>solver</code> with all input data as
function arguments and all output data returned to the calling code.
With this <code>solver</code> function we can then solve all types of problems
<a href="#mjx-eqn-1">(1)</a>-<a href="#mjx-eqn-2">(2)</a>
by an easy-to-read one-line statement:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight"><pre><span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
<p>
The implementation of the <code>solver</code> function in Python goes like this:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight"><pre><span class="k">def</span> <span class="nf">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Solve u&#39;=-a*u, u(0)=I, for t in (0,T] with steps of dt.&quot;&quot;&quot;</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>               <span class="c"># avoid integer division</span>
    <span class="n">Nt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">dt</span><span class="p">))</span>        <span class="c"># no of time intervals</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">Nt</span><span class="o">*</span><span class="n">dt</span>                    <span class="c"># adjust T to fit time step dt</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>           <span class="c"># array of u[n] values</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># time mesh</span>

    <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span>                  <span class="c"># assign initial condition</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nt</span><span class="p">):</span>    <span class="c"># n=0,1,...,Nt-1</span>
        <span class="n">u</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">theta</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">u</span><span class="p">,</span> <span class="n">t</span>
</pre></div>
<p>
<div class="alert alert-block alert-success alert-text-normal"><b>Tip: Always use a doc string to document a function!</b>
Python has a convention for documenting the purpose and usage of
a function in a <em>doc string</em>: simply place the documentation
in a one- or multi-line triple-quoted string right after the
function header.
</div>


<p>
<div class="alert alert-block alert-success alert-text-normal"><b>Be careful with unintended integer division!</b>
Note that we in the <code>solver</code> function explicitly covert <code>dt</code> to a
<code>float</code> object. If not, the updating formula for <code>u[n+1]</code> may evaluate
to zero because of integer division when <code>theta</code>, <code>a</code>, and <code>dt</code> are integers!
</div>


<p>
One of the most serious flaws in computational work is to have several
slightly different implementations of the same computational algorithms
lying around in various program files. This is very likely to happen,
because busy scientists often want to test a slight variation of a code to see
what happens. A quick copy and edit do the task, but such quick hacks have
a tendency to survive. When a real correction is needed in the implementation,
it is difficult to ensure that the correction is done in all relevant files.
In fact, this is a general problem in programming, which has led to
an important principle.

<p>
<div class="alert alert-block alert-success alert-text-normal"><b>The DRY principle: Don't repeat yourself!</b>
When implementing a particular functionality in a computer program, make sure
this functionality and its variations are implemented in just one piece
of code. That is, if you need to revise the implementation, there should be
<em>one and only one</em> place to edit. It follows that you should never
duplicate code (don't repeat yourself!), and code snippets that are
similar should be factored into one piece (function) and parameterized (by
function arguments).
</div>


<h2 id="softeng1:basic:module">Making a module</h2>

<p>
As soon as you start making Python functions in a program, you should
make sure the program file fulfills the requirement of a module.
This means that you can import and reuse your functions in other
programs too. For example, if our <code>solver</code> function resides in a
module <code>decay</code> in a module file <code>decay.py</code>, we can in any program
do

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">decay</span> <span class="kn">import</span> <span class="n">solver</span>
<span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
<p>
or prefix function names by the module name:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">decay</span>
<span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">decay</span><span class="o">.</span><span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
<p>
The requirements for a program to qualify for a module are simple:

<ol>
<li> The filename without <code>.py</code> must be a valid Python variable name.</li>
<li> The main program must be executed (through statements or
   a function call) in the <em>test block</em>.</li>
</ol>

The <em>test block</em> is normally placed at the end of a module file:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight"><pre><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c"># Statements</span>
</pre></div>
<p>
When the module file is executed as a stand-alone program, the if test
is true and the indented statements are run, but when the module file
is imported, <code>__name__</code> equals the module name and the test block
is not executed.

<p>
To explain the importance of the test block, consider the trivial module
file <code>hello.py</code> with one function and a call to this function as main program:

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight"><pre><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">arg</span><span class="o">=</span><span class="s">&#39;World!&#39;</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&#39;Hello, &#39;</span> <span class="o">+</span> <span class="n">arg</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">hello</span><span class="p">()</span>
</pre></div>
<p>
Without the test block,

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight"><pre><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">arg</span><span class="o">=</span><span class="s">&#39;World!&#39;</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&#39;Hello, &#39;</span> <span class="o">+</span> <span class="n">arg</span>

<span class="n">hello</span><span class="p">()</span>
</pre></div>
<p>
any attempt to import <code>hello</code> will also execute the call <code>hello()</code> and
hence write `Hello, World!' to the screen.
Such output is not desired when importing a module! However,
with the test block, <code>hello()</code> is not called during import, but
running the file as <code>python hello.py</code> will make the block active
and lead to the desired printing.

<p>
<div class="alert alert-block alert-success alert-text-normal"><b>All coming functions are placed in a module.</b>
The many functions to be explained in the following text are
put in one module file <a href="http://tinyurl.com/nm5587k/softeng1/decay.py" target="_self"><tt>decay.py</tt></a>.
</div>


<p>
What more than the <code>solver</code> function is needed in our <code>decay</code> module
to do everything we did in the previous, flat program?
We need import statements for <code>numpy</code> and <code>matplotlib</code> as well as
another function for producing the plot. It can also be convenient
to put the exact solution in a Python function.
Our module <code>decay.py</code> then looks like this:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">exact_solution</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">I</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">experiment_compare_numerical_and_exact</span><span class="p">():</span>
    <span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>  <span class="n">T</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>  <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">;</span>  <span class="n">theta</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>

    <span class="n">t_e</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>       <span class="c"># very fine mesh for u_e</span>
    <span class="n">u_e</span> <span class="o">=</span> <span class="n">exact_solution</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

    <span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span>   <span class="n">u</span><span class="p">,</span>   <span class="s">&#39;r--o&#39;</span><span class="p">)</span>           <span class="c"># dashed red line with circles</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">u_e</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>             <span class="c"># blue line for u_e</span>
    <span class="n">legend</span><span class="p">([</span><span class="s">&#39;numerical, theta=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">theta</span><span class="p">,</span> <span class="s">&#39;exact&#39;</span><span class="p">])</span>
    <span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">)</span>
    <span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">)</span>
    <span class="n">plotfile</span> <span class="o">=</span> <span class="s">&#39;tmp&#39;</span>
    <span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.png&#39;</span><span class="p">);</span>  <span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.pdf&#39;</span><span class="p">)</span>

    <span class="n">error</span> <span class="o">=</span> <span class="n">exact_solution</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">u</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">print</span> <span class="s">&#39;Error norm:&#39;</span><span class="p">,</span> <span class="n">E</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">experiment_compare_numerical_and_exact</span><span class="p">()</span>
</pre></div>
<p>
This module file does exactly the same as the previous, flat program,
but it becomes much easier to extend the code with other plots or
experiments in new functions.  And even more important, the numerical
algorithm is coded and tested once and for all in the <code>solver</code>
function, and any need to solve the mathematical problem is a matter
of one function call.
<!-- (not copying initialization statements and a loop -->
<!-- to a new program for ad hoc editing!). -->

<h2 id="softeng1:basic:modprefix">Prefixing imported functions by the module name</h2>

<p>
Import statements of the form <code>from module import *</code> import
functions and variables in <code>module.py</code> into the current file.
For example, when doing

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
<p>
we get mathematical functions like <code>sin</code> and <code>exp</code>
as well as MATLAB-style functions like <code>linspace</code> and <code>plot</code>,
which can be called by these well-known names.
Unfortunately, it sometimes becomes confusing to
know where a particular function comes from. Is it from <code>numpy</code>? Or
<code>matplotlib.pyplot</code>?
Or is it our own function?

<p>
An alternative import is

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span>
</pre></div>
<p>
and such imports require functions to be prefixed by the module name, e.g.,

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight"><pre><span class="n">t</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">u_e</span> <span class="o">=</span> <span class="n">I</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u_e</span><span class="p">)</span>
</pre></div>
<p>
This is normally regarded as a better habit because it is explicitly stated
from which module a function comes from.

<p>
The modules <code>numpy</code> and <code>matplotlib.pyplot</code> are so frequently used,
and their full names quite tedious to write, so two standard abbreviations
have evolved in the Python scientific computing community:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">u_e</span> <span class="o">=</span> <span class="n">I</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u_e</span><span class="p">)</span>
</pre></div>
<p>
The downside of prefixing functions by the module name is that
mathematical expressions like \( e^{-at}\sin(2\pi t) \) get
cluttered with module names,
<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight"><pre><span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
<span class="c"># or</span>
<span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
</pre></div>
<p>
Such an expression looks like <code>exp(-a*t)*sin(2*pi*t)</code> in most
other programming languages. Similarly,
<code>np.linspace</code> and <code>plt.plot</code> look less familiar to people who are
used to MATLAB and who have not adopted Python's prefix style.
Whether to do <code>from module import *</code> or <code>import module</code> depends
on personal taste and the problem at hand. In these writings we use
<code>from module import</code> in more basic, shorter programs where similarity with
MATLAB could be an advantage. Prefix of mathematical
functions in formulas is something we often avoid to obtain
a one-to-one correspondence between
mathematical formulas and the Python code.

<p>
Our <code>decay</code> module can be edited to use the module prefix for
<code>matplotlib.pyplot</code> and <code>numpy</code>:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">exact_solution</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">I</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">experiment_compare_numerical_and_exact</span><span class="p">():</span>
    <span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>  <span class="n">T</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>  <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">;</span>  <span class="n">theta</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>

    <span class="n">t_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>       <span class="c"># very fine mesh for u_e</span>
    <span class="n">u_e</span> <span class="o">=</span> <span class="n">exact_solution</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span>   <span class="n">u</span><span class="p">,</span>   <span class="s">&#39;r--o&#39;</span><span class="p">)</span>       <span class="c"># dashed red line with circles</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">u_e</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>         <span class="c"># blue line for u_e</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&#39;numerical, theta=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">theta</span><span class="p">,</span> <span class="s">&#39;exact&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">)</span>
    <span class="n">plotfile</span> <span class="o">=</span> <span class="s">&#39;tmp&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.png&#39;</span><span class="p">);</span>  <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.pdf&#39;</span><span class="p">)</span>

    <span class="n">error</span> <span class="o">=</span> <span class="n">exact_solution</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">u</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">print</span> <span class="s">&#39;Error norm:&#39;</span><span class="p">,</span> <span class="n">E</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">experiment_compare_numerical_and_exact</span><span class="p">()</span>
</pre></div>
<p>
We remark that some would prefer to get rid of the prefix in
mathematical formulas:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">exp</span><span class="p">,</span> <span class="nb">sum</span><span class="p">,</span> <span class="n">sqrt</span>

<span class="k">def</span> <span class="nf">exact_solution</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">I</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

<span class="n">error</span> <span class="o">=</span> <span class="n">exact_solution</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">u</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

<h2 id="softeng1:basic:experiment2">Comparing numerical schemes in one plot</h2>

<p>
Let us specifically demonstrate one extension of the
flat program in the section <a href="#softeng1:basic:impl1">A first, quick implementation</a>
that would require substantial editing of the flat code
(the section <a href="#softeng1:basic:impl2">A more decent, flat program</a>), while
in a structured module
(the section <a href="#softeng1:basic:module">Making a module</a>), we can simply add a new function without
affecting the existing code and with reusing the implementation
of the numerics.

<p>
Our aim is to make a comparison between the numerical solutions
for various schemes (\( \theta \) values) and the exact solution:

<p>
<center><p><img src="fig-softeng1/compare.png" align="bottom" width=600></p></center>

<p>
<div class="alert alert-block alert-info alert-text-normal"><b>Stop a minute!</b>
Look at the flat program in
the section <a href="#softeng1:basic:impl1">A first, quick implementation</a>,
and try to imagine which edits that are required to solve this new problem.
</div>


<p>
With the <code>solver</code> function at hand, we can simply create a function
with a loop over <code>theta</code> values and add the necessary plot statements:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight"><pre><span class="k">def</span> <span class="nf">experiment_compare_schemes</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Compare theta=0,1,0.5 in the same plot.&quot;&quot;&quot;</span>
    <span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>  <span class="n">T</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>  <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.4</span>
    <span class="n">legends</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]:</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="s">&#39;--o&#39;</span><span class="p">)</span>            <span class="c"># dashed lines with circles</span>
        <span class="n">legends</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;theta=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">theta</span><span class="p">)</span>
    <span class="n">t_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>        <span class="c"># very fine mesh for u_e</span>
    <span class="n">u_e</span> <span class="o">=</span> <span class="n">exact_solution</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">u_e</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>             <span class="c"># blue line for u_e</span>
    <span class="n">legends</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;exact&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legends</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s">&#39;upper right&#39;</span><span class="p">)</span>
    <span class="n">plotfile</span> <span class="o">=</span> <span class="s">&#39;tmp&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.png&#39;</span><span class="p">);</span>  <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.pdf&#39;</span><span class="p">)</span>
</pre></div>
<p>
A call to this <code>experiment_compare_schemes</code> function must be placed
in the test block, or you can run the program from IPython instead:

<p>

<!-- code=ipy (!bc ipy) typeset with pygments style "default" -->
<div class="highlight"><pre><span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">decay</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">experiment_compare_schemes</span><span class="p">()</span>
</pre></div>

<h2 id="softeng1:basic:docstring">Documenting functions and modules</h2>

<p>
We have already emphasized the importance of documenting functions with
a doc string (see the section <a href="#softeng1:basic:func">Implementing the numerical algorithm in a function</a>). Now it is time
to show how doc strings should be structured in order to take advantage
of the documentation utilities in the <code>numpy</code> module. The idea is
to follow a convention that in itself makes a good pure text doc string
in the terminal window
and at the same time can be translated to beautiful HTML manuals for
the web.

<p>
The conventions for <code>numpy</code> style doc strings are well
<a href="https://github.com/numpy/numpy/blob/master/doc/HOWTO_DOCUMENT.rst.txt" target="_self">documented</a>, so we here just present a basic example that the reader can adopt.
Input arguments to a function is listed under a heading <code>Parameters</code>,
while returned values are listed under <code>Returns</code>. It is a good idea to
also add an <code>Examples</code> section on the usage of the function.
More complicated software may have additional sections, see <code>pydoc numpy.load</code>
for an example. The markup language available for doc strings is
Sphinx-extended reStructuredText. The example below shows typical
constructs: 1) how inline
mathematics is written with the <code>:math:</code> directive, 2) how arguments
to the functions are referred to using single backticks
inline monospace font for code applies double backticks), and 3) how
arguments and return values are listed with types and explanation.

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight"><pre><span class="k">def</span> <span class="nf">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solve :math:`u&#39;=-au` with :math:`u(0)=I` for :math:`t \in (0,T]`</span>
<span class="sd">    with steps of `dt` and the method implied by `theta`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    I: float</span>
<span class="sd">        Initial condition.</span>
<span class="sd">    a: float</span>
<span class="sd">        Parameter in the differential equation.</span>
<span class="sd">    T: float</span>
<span class="sd">        Total simulation time.</span>
<span class="sd">    theta: float, int</span>
<span class="sd">        Parameter in the numerical scheme. 0 gives</span>
<span class="sd">        Forward Euler, 1 Backward Euler, and 0.5</span>
<span class="sd">        the centered Crank-Nicolson scheme.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    `u`: array</span>
<span class="sd">        Solution array.</span>
<span class="sd">    `t`: array</span>
<span class="sd">        Array with time points corresponding to `u`.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Solve :math:`u&#39; = -\\frac{1}{2}u, u(0)=1.5`</span>
<span class="sd">    with the Crank-Nicolson method:</span>

<span class="sd">    &gt;&gt;&gt; u, t = solver(I=1.5, a=0.5, T=9, theta=0.5)</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; plt.plot(t, u)</span>
<span class="sd">    &gt;&gt;&gt; plt.show()</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
<p>
If you follow such doc string conventions in your software, you can
easily produce nice manuals and you adopt to a standard in the
Python scientific computing community.

<p>
There are quite some manual steps to use the tool <a href="http://sphinx-doc.org/" target="_self">Sphinx</a> to
prepare a manual, so it is
recommended to use the a <a href="http://tinyurl.com/nm5587k/softeng1/make_sphinx_api.py" target="_self">premade script</a> to automate all the steps.
(You need to do a <code>pip install</code> of <code>sphinx</code> and <code>numpydoc</code> to make the
script work.)
Figure <a href="#softeng1:basic:docstring:fig">2</a> provides an example how
the above doc strings looks like when Sphinx has transformed it to HTML.

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 2:  Example on Sphinx API manual in HTML. <div id="softeng1:basic:docstring:fig"></div> </p></center>
<p><img src="fig-softeng1/selfdoc_numpy.png" align="bottom" width=700></p>
</center>

<p>
<p>
<!-- navigation buttons at the bottom of the page -->
<ul class="pager">
  <li class="previous">
    <a href="._softeng1001.html">&larr; Prev</a>
  </li>
  <li class="next">
    <a href="._softeng1003.html">Next &rarr;</a>
  </li>
</ul>
<!-- ------------------- end of main content --------------- -->

</div>  <!-- end container -->
<!-- include javascript, jQuery *first* -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

<!-- Bootstrap footer
<footer>
<a href="http://..."><img width="250" align=right src="http://..."></a>
</footer>
-->


</body>
</html>
    

