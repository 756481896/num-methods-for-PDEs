<!DOCTYPE html>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/" />
<meta name="description" content="Study guide: Finite difference methods for vibration problems">
<meta name="keywords" content="period (of oscillations),frequency (of oscillations),Hz (unit),stability criterion">

<title>Study guide: Finite difference methods for vibration problems</title>







<!-- reveal.js: http://lab.hakim.se/reveal-js/ -->

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

<link rel="stylesheet" href="reveal.js/css/reveal.css">
<link rel="stylesheet" href="reveal.js/css/theme/darkgray.css" id="theme">
<!--
<link rel="stylesheet" href="reveal.js/css/reveal.css">
<link rel="stylesheet" href="reveal.js/css/theme/beige.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/beigesmall.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/solarized.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/serif.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/night.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/moon.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/simple.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/sky.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/darkgray.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/default.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/cbc.css" id="theme">
<link rel="stylesheet" href="reveal.js/css/theme/simula.css" id="theme">
-->

<!-- For syntax highlighting -->
<link rel="stylesheet" href="reveal.js/lib/css/zenburn.css">

<!-- If the query includes 'print-pdf', use the PDF print sheet -->
<script>
document.write( '<link rel="stylesheet" href="reveal.js/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
</script>

<style type="text/css">
    hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    p.caption { width: 80%; font-size: 60%; font-style: italic; text-align: left; }
    hr.figure { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    .reveal .alert-text-small   { font-size: 80%;  }
    .reveal .alert-text-large   { font-size: 130%; }
    .reveal .alert-text-normal  { font-size: 90%;  }
    .reveal .alert {
             padding:8px 35px 8px 14px; margin-bottom:18px;
             text-shadow:0 1px 0 rgba(255,255,255,0.5);
             border:5px solid #bababa;
             -webkit-border-radius: 14px; -moz-border-radius: 14px;
             border-radius:14px
             background-position: 10px 10px;
             background-repeat: no-repeat;
             background-size: 38px;
             padding-left: 30px; /* 55px; if icon */
     }
     .reveal .alert-block {padding-top:14px; padding-bottom:14px}
     .reveal .alert-block > p, .alert-block > ul {margin-bottom:1em}
     /*.reveal .alert li {margin-top: 1em}*/
     .reveal .alert-block p+p {margin-top:5px}
     /*.reveal .alert-notice { background-image: url(http://hplgit.github.io/doconce/bundled/html_images/small_gray_notice.png); }
     .reveal .alert-summary  { background-image:url(http://hplgit.github.io/doconce/bundled/html_images/small_gray_summary.png); }
     .reveal .alert-warning { background-image: url(http://hplgit.github.io/doconce/bundled/html_images/small_gray_warning.png); }
     .reveal .alert-question {background-image:url(http://hplgit.github.io/doconce/bundled/html_images/small_gray_question.png); } */

</style>



<!-- Styles for table layout of slides -->
<style type="text/css">
td.padding {
  padding-top:20px;
  padding-bottom:20px;
  padding-right:50px;
  padding-left:50px;
}
</style>

</head>

<body>
<div class="reveal">

<!-- Any section element inside the <div class="slides"> container
     is displayed as a slide -->

<div class="slides">





<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<!-- newcommands_keep.tex -->
$$
\newcommand{\half}{\frac{1}{2}}
\newcommand{\tp}{\thinspace .}
\newcommand{\uex}{{u_{\small\mbox{e}}}}
\newcommand{\Oof}[1]{\mathcal{O}(#1)}
$$




    



<section>
<!-- ------------------- main content ---------------------- -->



<center><h1 style="text-align: center;">Study guide: Finite difference methods for vibration problems</h1></center>  <!-- document title -->

<p>
<!-- author(s): Hans Petter Langtangen -->

<center>
<b>Hans Petter Langtangen</b> [1, 2]
</center>

<p>&nbsp;<br>
<!-- institution(s) -->

<center>[1] <b>Center for Biomedical Computing, Simula Research Laboratory</b></center>
<center>[2] <b>Department of Informatics, University of Oslo</b></center>
<p>&nbsp;<br>
<center><h4>Aug 8, 2015</h4></center> <!-- date -->
</section>


<section>
<h1 id="___sec0">A simple vibration problem </h1>

<p>&nbsp;<br>
$$
u^{\prime\prime}(t) + \omega^2u = 0,\quad u(0)=I,\ u^{\prime}(0)=0,\ t\in (0,T]
$$
<p>&nbsp;<br>

<p>
Exact solution:

<p>&nbsp;<br>
$$
u(t) = I\cos (\omega t)
$$
<p>&nbsp;<br>

\( u(t) \) oscillates with constant amplitude \( I \) and
(angular) frequency \( \omega \).
Period: \( P=2\pi/\omega \).
</section>


<section>
<h2 id="vib:model1:fdm">A centered finite difference scheme; step 1 and 2</h2>

<ul>
 <p><li> Strategy: follow the <a href="http://tinyurl.com/opdfafk/pub/sphinx-decay/main_decay.html#the-forward-euler-scheme" target="_self">four steps</a> of the finite difference method.</li>
 <p><li> Step 1: Introduce a time mesh, here uniform on \( [0,T] \): \( t_n=n\Delta t \)</li>
 <p><li> Step 2: Let the ODE be satisfied at each mesh point:</li>
</ul>
<p>&nbsp;<br>
$$
u^{\prime\prime}(t_n) + \omega^2u(t_n) = 0,\quad n=1,\ldots,N_t
$$
<p>&nbsp;<br>
</section>


<section>
<h2 id="___sec2">A centered finite difference scheme; step 3 </h2>

<p>
Step 3: Approximate derivative(s) by finite
difference approximation(s).
Very common (standard!) formula for \( u^{\prime\prime} \):

<p>&nbsp;<br>
$$
u^{\prime\prime}(t_n) \approx \frac{u^{n+1}-2u^n + u^{n-1}}{\Delta t^2}
$$
<p>&nbsp;<br>

<p>
Use this discrete initial condition together with the ODE at \( t=0 \) to
eliminate \( u^{-1} \):

<p>&nbsp;<br>
$$
\frac{u^{n+1}-2u^n + u^{n-1}}{\Delta t^2} = -\omega^2 u^n
$$
<p>&nbsp;<br>
</section>


<section>
<h2 id="___sec3">A centered finite difference scheme; step 4 </h2>

<p>
Step 4: Formulate the computational algorithm.
Assume \( u^{n-1} \) and \( u^n \) are known, solve for unknown \( u^{n+1} \):

<p>&nbsp;<br>
$$
u^{n+1} = 2u^n - u^{n-1} - \Delta t^2\omega^2 u^n
$$
<p>&nbsp;<br>

<p>
Nick names for this scheme:
Stormer's
method or <a href="http://en.wikipedia.org/wiki/Velocity_Verlet" target="_self">Verlet integration</a>.
</section>


<section>
<h2 id="___sec4">Computing the first step </h2>

<ul>

<p><li> The formula breaks down for \( u^1 \) because \( u^{-1} \) is unknown and
    outside the mesh!</li>

<p><li> And: we have not used the initial condition \( u^{\prime}(0)=0 \).</li>
</ul>
<p>

Discretize \( u^{\prime}(0)=0 \) by a centered difference
<p>&nbsp;<br>
$$
\frac{u^1-u^{-1}}{2\Delta t} = 0\quad\Rightarrow\quad u^{-1} = u^1
$$
<p>&nbsp;<br>

<p>
Inserted in the scheme for \( n=0 \) gives

<p>&nbsp;<br>
$$
u^1 = u^0 - \half \Delta t^2 \omega^2 u^0
$$
<p>&nbsp;<br>
</section>


<section>
<h2 id="___sec5">The computational algorithm </h2>

<ol>
 <p><li> \( u^0=I \)</li>
 <p><li> compute \( u^1 \)</li>
 <p><li> for \( n=1,2,\ldots,N_t-1 \):</li>

<ol>

<p><li> compute \( u^{n+1} \)</li>
</ol>
<p>
</ol>
<p>

More precisly expressed in Python:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 80%; line-height: 125%"><span style="color: #d0d0d0">t</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">linspace(</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">T,</span> <span style="color: #d0d0d0">Nt+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span>  <span style="color: #999999; font-style: italic"># mesh points in time</span>
<span style="color: #d0d0d0">dt</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">t[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">t[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span>          <span style="color: #999999; font-style: italic"># constant time step.</span>
<span style="color: #d0d0d0">u</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">zeros(Nt+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span>           <span style="color: #999999; font-style: italic"># solution</span>

<span style="color: #d0d0d0">u[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">I</span>
<span style="color: #d0d0d0">u[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">u[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">-</span> <span style="color: #3677a9">0.5</span><span style="color: #d0d0d0">*dt**</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*w**</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*u[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span>
<span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">n</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">Nt):</span>
    <span style="color: #d0d0d0">u[n+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">*u[n]</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">u[n-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">dt**</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*w**</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*u[n]</span>
</pre></div>
<p>
Note: <code>w</code> is consistently used for \( \omega \) in my code.
</section>


<section>
<h2 id="___sec6">Operator notation; ODE </h2>

<p>
With \( [D_tD_t u]^n \) as the finite difference approximation to
\( u^{\prime\prime}(t_n) \) we can write

<p>&nbsp;<br>
$$
[D_tD_t u  + \omega^2 u = 0]^n
$$
<p>&nbsp;<br>

<p>
\( [D_tD_t u]^n \) means applying a central difference with step \( \Delta t/2 \) twice:

<p>&nbsp;<br>
$$ [D_t(D_t u)]^n = \frac{[D_t u]^{n+\half} - [D_t u]^{n-\half}}{\Delta t}$$
<p>&nbsp;<br>

which is written out as
<p>&nbsp;<br>
$$
\frac{1}{\Delta t}\left(\frac{u^{n+1}-u^n}{\Delta t} - \frac{u^{n}-u^{n-1}}{\Delta t}\right) = \frac{u^{n+1}-2u^n + u^{n-1}}{\Delta t^2}
\tp
$$
<p>&nbsp;<br>
</section>


<section>
<h2 id="___sec7">Operator notation; initial condition </h2>

<p>&nbsp;<br>
$$
[u = I]^0,\quad [D_{2t} u = 0]^0
$$
<p>&nbsp;<br>

where \( [D_{2t} u]^n \) is defined as
<p>&nbsp;<br>
$$
[D_{2t} u]^n = \frac{u^{n+1} - u^{n-1}}{2\Delta t}
\tp
$$
<p>&nbsp;<br>
</section>


<section>
<h2 id="___sec8">Computing \( u^{\prime} \) </h2>

<p>
\( u \) is often displacement/position, \( u^{\prime} \) is velocity and can be computed by

<p>&nbsp;<br>
$$
u^{\prime}(t_n) \approx \frac{u^{n+1}-u^{n-1}}{2\Delta t} = [D_{2t}u]^n
$$
<p>&nbsp;<br>
</section>


<section>
<h1 id="___sec9">Implementation </h1>
</section>


<section>
<h2 id="___sec10">Core algorithm </h2>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">numpy</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">matplotlib.pyplot</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>

<span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">solver</span><span style="color: #d0d0d0">(I,</span> <span style="color: #d0d0d0">w,</span> <span style="color: #d0d0d0">dt,</span> <span style="color: #d0d0d0">T):</span>
    <span style="color: #ed9d13">&quot;&quot;&quot;</span>
<span style="color: #ed9d13">    Solve u&#39;&#39; + w**2*u = 0 for t in (0,T], u(0)=I and u&#39;(0)=0,</span>
<span style="color: #ed9d13">    by a central finite difference method with time step dt.</span>
<span style="color: #ed9d13">    &quot;&quot;&quot;</span>
    <span style="color: #d0d0d0">dt</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">float</span><span style="color: #d0d0d0">(dt)</span>
    <span style="color: #d0d0d0">Nt</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">round</span><span style="color: #d0d0d0">(T/dt))</span>
    <span style="color: #d0d0d0">u</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">zeros(Nt+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">t</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">linspace(</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">Nt*dt,</span> <span style="color: #d0d0d0">Nt+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span>

    <span style="color: #d0d0d0">u[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">I</span>
    <span style="color: #d0d0d0">u[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">u[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">-</span> <span style="color: #3677a9">0.5</span><span style="color: #d0d0d0">*dt**</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*w**</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*u[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span>
    <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">n</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">Nt):</span>
        <span style="color: #d0d0d0">u[n+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">*u[n]</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">u[n-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">dt**</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*w**</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*u[n]</span>
    <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">u,</span> <span style="color: #d0d0d0">t</span>
</pre></div>
</section>


<section>
<h2 id="___sec11">Plotting </h2>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">u_exact</span><span style="color: #d0d0d0">(t,</span> <span style="color: #d0d0d0">I,</span> <span style="color: #d0d0d0">w):</span>
    <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">I*cos(w*t)</span>

<span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">visualize</span><span style="color: #d0d0d0">(u,</span> <span style="color: #d0d0d0">t,</span> <span style="color: #d0d0d0">I,</span> <span style="color: #d0d0d0">w):</span>
    <span style="color: #d0d0d0">plot(t,</span> <span style="color: #d0d0d0">u,</span> <span style="color: #ed9d13">&#39;r--o&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">t_fine</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">linspace(</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">t[-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">],</span> <span style="color: #3677a9">1001</span><span style="color: #d0d0d0">)</span>  <span style="color: #999999; font-style: italic"># very fine mesh for u_e</span>
    <span style="color: #d0d0d0">u_e</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">u_exact(t_fine,</span> <span style="color: #d0d0d0">I,</span> <span style="color: #d0d0d0">w)</span>
    <span style="color: #d0d0d0">hold(</span><span style="color: #ed9d13">&#39;on&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">plot(t_fine,</span> <span style="color: #d0d0d0">u_e,</span> <span style="color: #ed9d13">&#39;b-&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">legend([</span><span style="color: #ed9d13">&#39;numerical&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #ed9d13">&#39;exact&#39;</span><span style="color: #d0d0d0">],</span> <span style="color: #d0d0d0">loc=</span><span style="color: #ed9d13">&#39;upper left&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">xlabel(</span><span style="color: #ed9d13">&#39;t&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">ylabel(</span><span style="color: #ed9d13">&#39;u&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">dt</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">t[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">t[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span>
    <span style="color: #d0d0d0">title(</span><span style="color: #ed9d13">&#39;dt=%g&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">dt)</span>
    <span style="color: #d0d0d0">umin</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1.2</span><span style="color: #d0d0d0">*u.min();</span>  <span style="color: #d0d0d0">umax</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">-umin</span>
    <span style="color: #d0d0d0">axis([t[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">],</span> <span style="color: #d0d0d0">t[-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">],</span> <span style="color: #d0d0d0">umin,</span> <span style="color: #d0d0d0">umax])</span>
    <span style="color: #d0d0d0">savefig(</span><span style="color: #ed9d13">&#39;tmp1.png&#39;</span><span style="color: #d0d0d0">);</span>  <span style="color: #d0d0d0">savefig(</span><span style="color: #ed9d13">&#39;tmp1.pdf&#39;</span><span style="color: #d0d0d0">)</span>

<span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">test_three_steps</span><span style="color: #d0d0d0">():</span>
    <span style="color: #d0d0d0">I</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">;</span>  <span style="color: #d0d0d0">w</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">*pi;</span>  <span style="color: #d0d0d0">dt</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.1</span><span style="color: #d0d0d0">;</span>  <span style="color: #d0d0d0">T</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>
    <span style="color: #d0d0d0">u_by_hand</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">array([</span><span style="color: #3677a9">1.000000000000000</span><span style="color: #d0d0d0">,</span>
                       <span style="color: #3677a9">0.802607911978213</span><span style="color: #d0d0d0">,</span>
                       <span style="color: #3677a9">0.288358920740053</span><span style="color: #d0d0d0">])</span>
    <span style="color: #d0d0d0">u,</span> <span style="color: #d0d0d0">t</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">solver(I,</span> <span style="color: #d0d0d0">w,</span> <span style="color: #d0d0d0">dt,</span> <span style="color: #d0d0d0">T)</span>
    <span style="color: #d0d0d0">diff</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">abs</span><span style="color: #d0d0d0">(u_by_hand</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">u[:</span><span style="color: #3677a9">3</span><span style="color: #d0d0d0">]).max()</span>
    <span style="color: #d0d0d0">tol</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1E-14</span>
    <span style="color: #6ab825; font-weight: bold">assert</span> <span style="color: #d0d0d0">diff</span> <span style="color: #d0d0d0">&lt;</span> <span style="color: #d0d0d0">tol</span>

<span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">convergence_rates</span><span style="color: #d0d0d0">(m,</span> <span style="color: #d0d0d0">solver_function,</span> <span style="color: #d0d0d0">num_periods=</span><span style="color: #3677a9">8</span><span style="color: #d0d0d0">):</span>
    <span style="color: #ed9d13">&quot;&quot;&quot;</span>
<span style="color: #ed9d13">    Return m-1 empirical estimates of the convergence rate</span>
<span style="color: #ed9d13">    based on m simulations, where the time step is halved</span>
<span style="color: #ed9d13">    for each simulation.</span>
<span style="color: #ed9d13">    solver_function(I, w, dt, T) solves each problem, where T</span>
<span style="color: #ed9d13">    is based on simulation for num_periods periods.</span>
<span style="color: #ed9d13">    &quot;&quot;&quot;</span>
    <span style="color: #d0d0d0">w</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.35</span><span style="color: #d0d0d0">;</span> <span style="color: #d0d0d0">I</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.3</span>       <span style="color: #999999; font-style: italic"># just chosen values</span>
    <span style="color: #d0d0d0">P</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">*pi/w</span>              <span style="color: #999999; font-style: italic"># period</span>
    <span style="color: #d0d0d0">dt</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">P/</span><span style="color: #3677a9">30</span>               <span style="color: #999999; font-style: italic"># 30 time step per period 2*pi/w</span>
    <span style="color: #d0d0d0">T</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">P*num_periods</span>

    <span style="color: #d0d0d0">dt_values</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[]</span>
    <span style="color: #d0d0d0">E_values</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[]</span>
    <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">i</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(m):</span>
        <span style="color: #d0d0d0">u,</span> <span style="color: #d0d0d0">t</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">solver_function(I,</span> <span style="color: #d0d0d0">w,</span> <span style="color: #d0d0d0">dt,</span> <span style="color: #d0d0d0">T)</span>
        <span style="color: #d0d0d0">u_e</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">u_exact(t,</span> <span style="color: #d0d0d0">I,</span> <span style="color: #d0d0d0">w)</span>
        <span style="color: #d0d0d0">E</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sqrt(dt*</span><span style="color: #24909d">sum</span><span style="color: #d0d0d0">((u_e-u)**</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">))</span>
        <span style="color: #d0d0d0">dt_values.append(dt)</span>
        <span style="color: #d0d0d0">E_values.append(E)</span>
        <span style="color: #d0d0d0">dt</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">dt/</span><span style="color: #3677a9">2</span>

    <span style="color: #d0d0d0">r</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[log(E_values[i-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]/E_values[i])/</span>
         <span style="color: #d0d0d0">log(dt_values[i-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]/dt_values[i])</span>
         <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">i</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">m,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">)]</span>
    <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">r</span>

<span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">test_convergence_rates</span><span style="color: #d0d0d0">():</span>
    <span style="color: #d0d0d0">r</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">convergence_rates(m=</span><span style="color: #3677a9">5</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">solver_function=solver,</span> <span style="color: #d0d0d0">num_periods=</span><span style="color: #3677a9">8</span><span style="color: #d0d0d0">)</span>
    <span style="color: #999999; font-style: italic"># Accept rate to 1 decimal place</span>
    <span style="color: #d0d0d0">tol</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.1</span>
    <span style="color: #6ab825; font-weight: bold">assert</span> <span style="color: #24909d">abs</span><span style="color: #d0d0d0">(r[-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">-</span> <span style="color: #3677a9">2.0</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">&lt;</span> <span style="color: #d0d0d0">tol</span>

<span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">main</span><span style="color: #d0d0d0">(solver_function=solver):</span>
    <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">argparse</span>
    <span style="color: #d0d0d0">parser</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">argparse.ArgumentParser()</span>
    <span style="color: #d0d0d0">parser.add_argument(</span><span style="color: #ed9d13">&#39;--I&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">type</span><span style="color: #d0d0d0">=</span><span style="color: #24909d">float</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">default=</span><span style="color: #3677a9">1.0</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">parser.add_argument(</span><span style="color: #ed9d13">&#39;--w&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">type</span><span style="color: #d0d0d0">=</span><span style="color: #24909d">float</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">default=</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*pi)</span>
    <span style="color: #d0d0d0">parser.add_argument(</span><span style="color: #ed9d13">&#39;--dt&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">type</span><span style="color: #d0d0d0">=</span><span style="color: #24909d">float</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">default=</span><span style="color: #3677a9">0.05</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">parser.add_argument(</span><span style="color: #ed9d13">&#39;--num_periods&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">type</span><span style="color: #d0d0d0">=</span><span style="color: #24909d">int</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">default=</span><span style="color: #3677a9">5</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">parser.add_argument(</span><span style="color: #ed9d13">&#39;--savefig&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">action=</span><span style="color: #ed9d13">&#39;store_true&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #999999; font-style: italic"># Hack to allow --SCITOOLS options (read when importing scitools.std)</span>
    <span style="color: #d0d0d0">parser.add_argument(</span><span style="color: #ed9d13">&#39;--SCITOOLS_easyviz_backend&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">default=</span><span style="color: #ed9d13">&#39;matplotlib&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">a</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">parser.parse_args()</span>
    <span style="color: #d0d0d0">I,</span> <span style="color: #d0d0d0">w,</span> <span style="color: #d0d0d0">dt,</span> <span style="color: #d0d0d0">num_periods,</span> <span style="color: #d0d0d0">savefig</span> <span style="color: #d0d0d0">=</span> \ 
       <span style="color: #d0d0d0">a.I,</span> <span style="color: #d0d0d0">a.w,</span> <span style="color: #d0d0d0">a.dt,</span> <span style="color: #d0d0d0">a.num_periods,</span> <span style="color: #d0d0d0">a.savefig</span>
    <span style="color: #d0d0d0">P</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">*pi/w</span>  <span style="color: #999999; font-style: italic"># one period</span>
    <span style="color: #d0d0d0">T</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">P*num_periods</span>
    <span style="color: #d0d0d0">u,</span> <span style="color: #d0d0d0">t</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">solver_function(I,</span> <span style="color: #d0d0d0">w,</span> <span style="color: #d0d0d0">dt,</span> <span style="color: #d0d0d0">T)</span>
    <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">num_periods</span> <span style="color: #d0d0d0">&lt;=</span> <span style="color: #3677a9">10</span><span style="color: #d0d0d0">:</span>
        <span style="color: #d0d0d0">visualize(u,</span> <span style="color: #d0d0d0">t,</span> <span style="color: #d0d0d0">I,</span> <span style="color: #d0d0d0">w)</span>
    <span style="color: #6ab825; font-weight: bold">else</span><span style="color: #d0d0d0">:</span>
        <span style="color: #d0d0d0">visualize_front(u,</span> <span style="color: #d0d0d0">t,</span> <span style="color: #d0d0d0">I,</span> <span style="color: #d0d0d0">w,</span> <span style="color: #d0d0d0">savefig)</span>
        <span style="color: #999999; font-style: italic">#visualize_front_ascii(u, t, I, w)</span>
    <span style="color: #999999; font-style: italic">#plot_empirical_freq_and_amplitude(u, t, I, w)</span>
    <span style="color: #d0d0d0">show()</span>

<span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">plot_empirical_freq_and_amplitude</span><span style="color: #d0d0d0">(u,</span> <span style="color: #d0d0d0">t,</span> <span style="color: #d0d0d0">I,</span> <span style="color: #d0d0d0">w):</span>
    <span style="color: #ed9d13">&quot;&quot;&quot;</span>
<span style="color: #ed9d13">    Find the empirical angular frequency and amplitude of</span>
<span style="color: #ed9d13">    simulations in u and t. u and t can be arrays or (in</span>
<span style="color: #ed9d13">    the case of multiple simulations) multiple arrays.</span>
<span style="color: #ed9d13">    One plot is made for the amplitude and one for the angular</span>
<span style="color: #ed9d13">    frequency (just called frequency in the legends).</span>
<span style="color: #ed9d13">    &quot;&quot;&quot;</span>
    <span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">vib_empirical_analysis</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">minmax,</span> <span style="color: #d0d0d0">periods,</span> <span style="color: #d0d0d0">amplitudes</span>
    <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #6ab825; font-weight: bold">not</span> <span style="color: #24909d">isinstance</span><span style="color: #d0d0d0">(u,</span> <span style="color: #d0d0d0">(</span><span style="color: #24909d">list</span><span style="color: #d0d0d0">,</span><span style="color: #24909d">tuple</span><span style="color: #d0d0d0">)):</span>
        <span style="color: #d0d0d0">u</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[u]</span>
        <span style="color: #d0d0d0">t</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[t]</span>
    <span style="color: #d0d0d0">legends1</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[]</span>
    <span style="color: #d0d0d0">legends2</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[]</span>
    <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">i</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">len</span><span style="color: #d0d0d0">(u)):</span>
        <span style="color: #d0d0d0">minima,</span> <span style="color: #d0d0d0">maxima</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">minmax(t[i],</span> <span style="color: #d0d0d0">u[i])</span>
        <span style="color: #d0d0d0">p</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">periods(maxima)</span>
        <span style="color: #d0d0d0">a</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">amplitudes(minima,</span> <span style="color: #d0d0d0">maxima)</span>
        <span style="color: #d0d0d0">figure(</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">plot(</span><span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">len</span><span style="color: #d0d0d0">(p)),</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">*pi/p)</span>
        <span style="color: #d0d0d0">legends1.append(</span><span style="color: #ed9d13">&#39;frequency, case%d&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">(i+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">))</span>
        <span style="color: #d0d0d0">hold(</span><span style="color: #ed9d13">&#39;on&#39;</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">figure(</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">plot(</span><span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">len</span><span style="color: #d0d0d0">(a)),</span> <span style="color: #d0d0d0">a)</span>
        <span style="color: #d0d0d0">hold(</span><span style="color: #ed9d13">&#39;on&#39;</span><span style="color: #d0d0d0">)</span>
        <span style="color: #d0d0d0">legends2.append(</span><span style="color: #ed9d13">&#39;amplitude, case%d&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">(i+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">))</span>
    <span style="color: #d0d0d0">figure(</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">plot(</span><span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">len</span><span style="color: #d0d0d0">(p)),</span> <span style="color: #d0d0d0">[w]*</span><span style="color: #24909d">len</span><span style="color: #d0d0d0">(p),</span> <span style="color: #ed9d13">&#39;k--&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">legends1.append(</span><span style="color: #ed9d13">&#39;exact frequency&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">legend(legends1,</span> <span style="color: #d0d0d0">loc=</span><span style="color: #ed9d13">&#39;lower left&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">axis([</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">len</span><span style="color: #d0d0d0">(a)-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0.8</span><span style="color: #d0d0d0">*w,</span> <span style="color: #3677a9">1.2</span><span style="color: #d0d0d0">*w])</span>
    <span style="color: #d0d0d0">savefig(</span><span style="color: #ed9d13">&#39;tmp1.png&#39;</span><span style="color: #d0d0d0">);</span>  <span style="color: #d0d0d0">savefig(</span><span style="color: #ed9d13">&#39;tmp1.pdf&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">figure(</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">plot(</span><span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">len</span><span style="color: #d0d0d0">(a)),</span> <span style="color: #d0d0d0">[I]*</span><span style="color: #24909d">len</span><span style="color: #d0d0d0">(a),</span> <span style="color: #ed9d13">&#39;k--&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">legends2.append(</span><span style="color: #ed9d13">&#39;exact amplitude&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">legend(legends2,</span> <span style="color: #d0d0d0">loc=</span><span style="color: #ed9d13">&#39;lower left&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">axis([</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">len</span><span style="color: #d0d0d0">(a)-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0.8</span><span style="color: #d0d0d0">*I,</span> <span style="color: #3677a9">1.2</span><span style="color: #d0d0d0">*I])</span>
    <span style="color: #d0d0d0">savefig(</span><span style="color: #ed9d13">&#39;tmp2.png&#39;</span><span style="color: #d0d0d0">);</span>  <span style="color: #d0d0d0">savefig(</span><span style="color: #ed9d13">&#39;tmp2.pdf&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">show()</span>


<span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">visualize_front</span><span style="color: #d0d0d0">(u,</span> <span style="color: #d0d0d0">t,</span> <span style="color: #d0d0d0">I,</span> <span style="color: #d0d0d0">w,</span> <span style="color: #d0d0d0">savefig=</span><span style="color: #24909d">False</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">skip_frames=</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">):</span>
    <span style="color: #ed9d13">&quot;&quot;&quot;</span>
<span style="color: #ed9d13">    Visualize u and the exact solution vs t, using a</span>
<span style="color: #ed9d13">    moving plot window and continuous drawing of the</span>
<span style="color: #ed9d13">    curves as they evolve in time.</span>
<span style="color: #ed9d13">    Makes it easy to plot very long time series.</span>
<span style="color: #ed9d13">    Plots are saved to files if savefig is True.</span>
<span style="color: #ed9d13">    Only each skip_frames-th plot is saved (e.g., if</span>
<span style="color: #ed9d13">    skip_frame=10, only each 10th plot is saved to file;</span>
<span style="color: #ed9d13">    this is convenient if plot files corresponding to</span>
<span style="color: #ed9d13">    different time steps are to be compared).</span>
<span style="color: #ed9d13">    &quot;&quot;&quot;</span>
    <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">scitools.std</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">st</span>
    <span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">scitools.MovingPlotWindow</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">MovingPlotWindow</span>

    <span style="color: #999999; font-style: italic"># Remove all old plot files tmp_*.png</span>
    <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">glob</span><span style="color: #d0d0d0">,</span> <span style="color: #447fcf; text-decoration: underline">os</span>
    <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">filename</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">glob.glob(</span><span style="color: #ed9d13">&#39;tmp_*.png&#39;</span><span style="color: #d0d0d0">):</span>
        <span style="color: #d0d0d0">os.remove(filename)</span>

    <span style="color: #d0d0d0">P</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">*pi/w</span>  <span style="color: #999999; font-style: italic"># one period</span>
    <span style="color: #d0d0d0">umin</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1.2</span><span style="color: #d0d0d0">*u.min();</span>  <span style="color: #d0d0d0">umax</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">-umin</span>
    <span style="color: #d0d0d0">dt</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">t[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">t[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span>
    <span style="color: #d0d0d0">plot_manager</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">MovingPlotWindow(</span>
        <span style="color: #d0d0d0">window_width=</span><span style="color: #3677a9">8</span><span style="color: #d0d0d0">*P,</span>
        <span style="color: #d0d0d0">dt=dt,</span>
        <span style="color: #d0d0d0">yaxis=[umin,</span> <span style="color: #d0d0d0">umax],</span>
        <span style="color: #d0d0d0">mode=</span><span style="color: #ed9d13">&#39;continuous drawing&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">frame_counter</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span>
    <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">n</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span><span style="color: #24909d">len</span><span style="color: #d0d0d0">(u)):</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">plot_manager.plot(n):</span>
            <span style="color: #d0d0d0">s</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">plot_manager.first_index_in_plot</span>
            <span style="color: #d0d0d0">st.plot(t[s:n+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">],</span> <span style="color: #d0d0d0">u[s:n+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">],</span> <span style="color: #ed9d13">&#39;r-1&#39;</span><span style="color: #d0d0d0">,</span>
                    <span style="color: #d0d0d0">t[s:n+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">],</span> <span style="color: #d0d0d0">I*cos(w*t)[s:n+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">],</span> <span style="color: #ed9d13">&#39;b-1&#39;</span><span style="color: #d0d0d0">,</span>
                    <span style="color: #d0d0d0">title=</span><span style="color: #ed9d13">&#39;t=%6.3f&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">t[n],</span>
                    <span style="color: #d0d0d0">axis=plot_manager.axis(),</span>
                    <span style="color: #d0d0d0">show=</span><span style="color: #6ab825; font-weight: bold">not</span> <span style="color: #d0d0d0">savefig)</span> <span style="color: #999999; font-style: italic"># drop window if savefig</span>
            <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">savefig</span> <span style="color: #6ab825; font-weight: bold">and</span> <span style="color: #d0d0d0">n</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">skip_frames</span> <span style="color: #d0d0d0">==</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">:</span>
                <span style="color: #d0d0d0">filename</span> <span style="color: #d0d0d0">=</span> <span style="color: #ed9d13">&#39;tmp_%04d.png&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">frame_counter</span>
                <span style="color: #d0d0d0">st.savefig(filename)</span>
                <span style="color: #6ab825; font-weight: bold">print</span> <span style="color: #ed9d13">&#39;making plot file&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">filename,</span> <span style="color: #ed9d13">&#39;at t=%g&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">t[n]</span>
                <span style="color: #d0d0d0">frame_counter</span> <span style="color: #d0d0d0">+=</span> <span style="color: #3677a9">1</span>
        <span style="color: #d0d0d0">plot_manager.update(n)</span>

<span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">visualize_front_ascii</span><span style="color: #d0d0d0">(u,</span> <span style="color: #d0d0d0">t,</span> <span style="color: #d0d0d0">I,</span> <span style="color: #d0d0d0">w,</span> <span style="color: #d0d0d0">fps=</span><span style="color: #3677a9">10</span><span style="color: #d0d0d0">):</span>
    <span style="color: #ed9d13">&quot;&quot;&quot;</span>
<span style="color: #ed9d13">    Plot u and the exact solution vs t line by line in a</span>
<span style="color: #ed9d13">    terminal window (only using ascii characters).</span>
<span style="color: #ed9d13">    Makes it easy to plot very long time series.</span>
<span style="color: #ed9d13">    &quot;&quot;&quot;</span>
    <span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">scitools.avplotter</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">Plotter</span>
    <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">time</span>
    <span style="color: #d0d0d0">P</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">*pi/w</span>
    <span style="color: #d0d0d0">umin</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1.2</span><span style="color: #d0d0d0">*u.min();</span>  <span style="color: #d0d0d0">umax</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">-umin</span>

    <span style="color: #d0d0d0">p</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">Plotter(ymin=umin,</span> <span style="color: #d0d0d0">ymax=umax,</span> <span style="color: #d0d0d0">width=</span><span style="color: #3677a9">60</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">symbols=</span><span style="color: #ed9d13">&#39;+o&#39;</span><span style="color: #d0d0d0">)</span>
    <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">n</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">len</span><span style="color: #d0d0d0">(u)):</span>
        <span style="color: #6ab825; font-weight: bold">print</span> <span style="color: #d0d0d0">p.plot(t[n],</span> <span style="color: #d0d0d0">u[n],</span> <span style="color: #d0d0d0">I*cos(w*t[n])),</span> \ 
              <span style="color: #ed9d13">&#39;%.1f&#39;</span> <span style="color: #d0d0d0">%</span> <span style="color: #d0d0d0">(t[n]/P)</span>
        <span style="color: #d0d0d0">time.sleep(</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">/</span><span style="color: #24909d">float</span><span style="color: #d0d0d0">(fps))</span>

<span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">__name__</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;__main__&#39;</span><span style="color: #d0d0d0">:</span>
    <span style="color: #d0d0d0">main()</span>
    <span style="color: #24909d">raw_input</span><span style="color: #d0d0d0">()</span>
</pre></div>
</section>


<section>
<h2 id="___sec12">Main program </h2>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 80%; line-height: 125%"><span style="color: #d0d0d0">I</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">1</span>
<span style="color: #d0d0d0">w</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">*pi</span>
<span style="color: #d0d0d0">dt</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.05</span>
<span style="color: #d0d0d0">num_periods</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">5</span>
<span style="color: #d0d0d0">P</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">*pi/w</span>    <span style="color: #999999; font-style: italic">#  one period</span>
<span style="color: #d0d0d0">T</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">P*num_periods</span>
<span style="color: #d0d0d0">u,</span> <span style="color: #d0d0d0">t</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">solver(I,</span> <span style="color: #d0d0d0">w,</span> <span style="color: #d0d0d0">dt,</span> <span style="color: #d0d0d0">T)</span>
<span style="color: #d0d0d0">visualize(u,</span> <span style="color: #d0d0d0">t,</span> <span style="color: #d0d0d0">I,</span> <span style="color: #d0d0d0">w,</span> <span style="color: #d0d0d0">dt)</span>
</pre></div>
</section>


<section>
<h2 id="___sec13">User interface: command line </h2>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">argparse</span>
<span style="color: #d0d0d0">parser</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">argparse.ArgumentParser()</span>
<span style="color: #d0d0d0">parser.add_argument(</span><span style="color: #ed9d13">&#39;--I&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">type</span><span style="color: #d0d0d0">=</span><span style="color: #24909d">float</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">default=</span><span style="color: #3677a9">1.0</span><span style="color: #d0d0d0">)</span>
<span style="color: #d0d0d0">parser.add_argument(</span><span style="color: #ed9d13">&#39;--w&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">type</span><span style="color: #d0d0d0">=</span><span style="color: #24909d">float</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">default=</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*pi)</span>
<span style="color: #d0d0d0">parser.add_argument(</span><span style="color: #ed9d13">&#39;--dt&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">type</span><span style="color: #d0d0d0">=</span><span style="color: #24909d">float</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">default=</span><span style="color: #3677a9">0.05</span><span style="color: #d0d0d0">)</span>
<span style="color: #d0d0d0">parser.add_argument(</span><span style="color: #ed9d13">&#39;--num_periods&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">type</span><span style="color: #d0d0d0">=</span><span style="color: #24909d">int</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">default=</span><span style="color: #3677a9">5</span><span style="color: #d0d0d0">)</span>
<span style="color: #d0d0d0">a</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">parser.parse_args()</span>
<span style="color: #d0d0d0">I,</span> <span style="color: #d0d0d0">w,</span> <span style="color: #d0d0d0">dt,</span> <span style="color: #d0d0d0">num_periods</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">a.I,</span> <span style="color: #d0d0d0">a.w,</span> <span style="color: #d0d0d0">a.dt,</span> <span style="color: #d0d0d0">a.num_periods</span>
</pre></div>
</section>


<section>
<h2 id="___sec14">Running the program </h2>

<p>
<a href="http://tinyurl.com/nm5587k/vib/vib_undamped.py" target="_self"><tt>vib_undamped.py</tt></a>:

<p>

<!-- code=text (!bc sys) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 80%; line-height: 125%">Terminal&gt; python vib_undamped.py --dt 0.05 --num_periods 40
</pre></div>
<p>
Generates frames <code>tmp_vib%04d.png</code> in files. Can make movie:

<p>

<!-- code=text (!bc sys) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 80%; line-height: 125%">Terminal&gt; avconv -r 12 -i tmp_vib%04d.png -c:v flv movie.flv
</pre></div>
<p>
Can use <code>ffmpeg</code> instead of <code>avconv</code>.

<p>
<table border="1">
<thead>
<tr><th align="center">Format</th> <th align="center">          Codec and filename         </th> </tr>
</thead>
<tbody>
<tr><td align="left">   Flash     </td> <td align="left">   <code>-c:v flv movie.flv</code>          </td> </tr>
<tr><td align="left">   MP4       </td> <td align="left">   <code>-c:v libx264 movie.mp4</code>      </td> </tr>
<tr><td align="left">   Webm      </td> <td align="left">   <code>-c:v libvpx movie.webm</code>      </td> </tr>
<tr><td align="left">   Ogg       </td> <td align="left">   <code>-c:v libtheora movie.ogg</code>    </td> </tr>
</tbody>
</table>
</section>


<section>
<h1 id="___sec15">Verification </h1>
</section>


<section>
<h2 id="___sec16">First steps for testing and debugging </h2>

<ul>
 <p><li> <b>Testing very simple solutions</b>:
   \( u=\hbox{const} \) or \( u=ct + d \) do not apply here (without a force
   term in the equation: \( u^{\prime\prime} + \omega^2u = f \)).</li>
 <p><li> <b>Hand calculations</b>: calculate \( u^1 \) and \( u^2 \) and compare with program.</li>
</ul>
</section>


<section>
<h2 id="___sec17">Checking convergence rates </h2>

<p>
The next function estimates convergence rates, i.e., it

<ul>
 <p><li> performs \( m \) simulations with halved time steps: \( 2^{-k}\Delta t \), \( k=0,\ldots,m-1 \),</li>
 <p><li> computes the \( L_2 \) norm of the error,
   \( E = \sqrt{\Delta t_i\sum_{n=0}^{N_t-1}(u^n-\uex(t_n))^2} \) in each case,</li>
 <p><li> estimates the rates \( r_i \) from two consecutive
   experiments \( (\Delta t_{i-1}, E_{i-1}) \) and \( (\Delta t_{i}, E_{i}) \),
   assuming \( E_i=C\Delta t_i^{r_i} \) and \( E_{i-1}=C\Delta t_{i-1}^{r_i} \):</li>
</ul>
</section>


<section>
<h2 id="___sec18">Implementational details </h2>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">convergence_rates</span><span style="color: #d0d0d0">(m,</span> <span style="color: #d0d0d0">solver_function,</span> <span style="color: #d0d0d0">num_periods=</span><span style="color: #3677a9">8</span><span style="color: #d0d0d0">):</span>
    <span style="color: #ed9d13">&quot;&quot;&quot;</span>
<span style="color: #ed9d13">    Return m-1 empirical estimates of the convergence rate</span>
<span style="color: #ed9d13">    based on m simulations, where the time step is halved</span>
<span style="color: #ed9d13">    for each simulation.</span>
<span style="color: #ed9d13">    solver_function(I, w, dt, T) solves each problem, where T</span>
<span style="color: #ed9d13">    is based on simulation for num_periods periods.</span>
<span style="color: #ed9d13">    &quot;&quot;&quot;</span>
    <span style="color: #d0d0d0">w</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.35</span><span style="color: #d0d0d0">;</span> <span style="color: #d0d0d0">I</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.3</span>       <span style="color: #999999; font-style: italic"># just chosen values</span>
    <span style="color: #d0d0d0">P</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">*pi/w</span>              <span style="color: #999999; font-style: italic"># period</span>
    <span style="color: #d0d0d0">dt</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">P/</span><span style="color: #3677a9">30</span>               <span style="color: #999999; font-style: italic"># 30 time step per period 2*pi/w</span>
    <span style="color: #d0d0d0">T</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">P*num_periods</span>

    <span style="color: #d0d0d0">dt_values</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[]</span>
    <span style="color: #d0d0d0">E_values</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[]</span>
    <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">i</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(m):</span>
        <span style="color: #d0d0d0">u,</span> <span style="color: #d0d0d0">t</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">solver_function(I,</span> <span style="color: #d0d0d0">w,</span> <span style="color: #d0d0d0">dt,</span> <span style="color: #d0d0d0">T)</span>
        <span style="color: #d0d0d0">u_e</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">u_exact(t,</span> <span style="color: #d0d0d0">I,</span> <span style="color: #d0d0d0">w)</span>
        <span style="color: #d0d0d0">E</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sqrt(dt*</span><span style="color: #24909d">sum</span><span style="color: #d0d0d0">((u_e-u)**</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">))</span>
        <span style="color: #d0d0d0">dt_values.append(dt)</span>
        <span style="color: #d0d0d0">E_values.append(E)</span>
        <span style="color: #d0d0d0">dt</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">dt/</span><span style="color: #3677a9">2</span>

    <span style="color: #d0d0d0">r</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[log(E_values[i-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]/E_values[i])/</span>
         <span style="color: #d0d0d0">log(dt_values[i-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]/dt_values[i])</span>
         <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">i</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">m,</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">)]</span>
    <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">r</span>
</pre></div>
<p>
Result: <code>r</code> contains values equal to 2.00 - as expected!
</section>


<section>
<h2 id="___sec19">Nose test </h2>

<p>
Use final <code>r[-1]</code> in a unit test:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">test_convergence_rates</span><span style="color: #d0d0d0">():</span>
    <span style="color: #d0d0d0">r</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">convergence_rates(m=</span><span style="color: #3677a9">5</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">solver_function=solver,</span> <span style="color: #d0d0d0">num_periods=</span><span style="color: #3677a9">8</span><span style="color: #d0d0d0">)</span>
    <span style="color: #999999; font-style: italic"># Accept rate to 1 decimal place</span>
    <span style="color: #d0d0d0">tol</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0.1</span>
    <span style="color: #6ab825; font-weight: bold">assert</span> <span style="color: #24909d">abs</span><span style="color: #d0d0d0">(r[-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">-</span> <span style="color: #3677a9">2.0</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">&lt;</span> <span style="color: #d0d0d0">tol</span>
</pre></div>
<p>
Complete code in <a href="http://tinyurl.com/nm5587k/vib/vib_undamped.py" target="_self"><tt>vib_undamped.py</tt></a>.
</section>


<section>
<h1 id="vib:model1:longseries">Long time simulations</h1>
</section>


<section>
<h2 id="___sec21">Effect of the time step on long simulations </h2>

<p>
<center><p><img src="fig-vib/vib_freq_err1.png" align="bottom" width=800></p></center>

<ul>
 <p><li> The numerical solution seems to have right amplitude.</li>
 <p><li> There is an angular frequency error (reduced by reducing the time step).</li>
 <p><li> The total angular frequency error seems to grow with time.</li>
</ul>
</section>


<section>
<h2 id="___sec22">Using a moving plot window </h2>

<ul>
 <p><li> In long time simulations we need a plot window that follows
   the solution.</li>
 <p><li> Method 1: <code>scitools.MovingPlotWindow</code>.</li>
 <p><li> Method 2: <code>scitools.avplotter</code> (ASCII vertical plotter).</li>
</ul>
<p>

Example:
<p>

<!-- code=text (!bc sys) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 80%; line-height: 125%">Terminal&gt; python vib_undamped.py --dt 0.05 --num_periods 40
</pre></div>
<p>
<a href="http://tinyurl.com/opdfafk/pub/mov-vib/vib_undamped_dt0.05/index.html" target="_self">Movie of the moving plot window</a>.
</section>


<section>
<h1 id="vib:model1:analysis">Analysis of the numerical scheme</h1>

<p>

<!-- begin box -->
<div style="width: 95%; padding: 10px; border: 1px solid #000; border-radius: 4px;">
Can we understand the frequency error?
</div>
<!-- end box -->

<p>
<center><p><img src="fig-vib/vib_freq_err1.png" align="bottom" width=800></p></center>
</section>


<section>
<h2 id="___sec24">Movie of the angular frequency error </h2>

<p>
\( u^{\prime\prime} + \omega^2 u = 0 \), \( u(0)=1 \), \( u^{\prime}(0)=0 \),
\( \omega=2\pi \), \( \uex(t)=\cos (2\pi t) \), \( \Delta t = 0.05 \) (20 intervals
per period)
<br />

<p>

<div>
<video  loop controls width='640' height='365' preload='none'>
    <source src='mov-vib/vib_undamped_movie_dt0.05/movie.mp4'  type='video/mp4;  codecs="avc1.42E01E, mp4a.40.2"'>
    <source src='mov-vib/vib_undamped_movie_dt0.05/movie.webm' type='video/webm; codecs="vp8, vorbis"'>
    <source src='mov-vib/vib_undamped_movie_dt0.05/movie.ogg'  type='video/ogg;  codecs="theora, vorbis"'>
</video>
</div>
<p><em></em></p>
</section>


<section>
<h2 id="___sec25">We can derive an exact solution of the discrete equations </h2>

<ul>

<p><li> We have a linear, homogeneous, difference equation for \( u^n \).</li>

<p><li> Has solutions \( u^n \sim IA^n \), where \( A \) is unknown (number).</li>

<p><li> Here: \( \uex(t) =I\cos(\omega t) \sim I\exp{(i\omega t)} = I(e^{i\omega\Delta t})^n \)</li>

<p><li> Trick for simplifying the algebra: \( u^n = IA^n \), with \( A=\exp{(i\tilde\omega\Delta t)} \), then find \( \tilde\omega \)</li>

<p><li> \( \tilde\omega \): unknown <em>numerical frequency</em> (easier to calculate than \( A \))</li>

<p><li> \( \omega - \tilde\omega \) is the angular <em>frequency error</em></li>

<p><li> Use the real part as the physical relevant part of a complex expression</li>
</ul>
</section>


<section>
<h2 id="___sec26">Calculations of an exact solution of the discrete equations </h2>

<p>&nbsp;<br>
$$
u^n = IA^n = I\exp{(\tilde\omega \Delta t\, n)}=I\exp{(\tilde\omega t)} =
I\cos (\tilde\omega t) + iI\sin(\tilde \omega t)
\tp
$$
<p>&nbsp;<br>

<p>&nbsp;<br>
$$
\begin{align*}
[D_tD_t u]^n &= \frac{u^{n+1} - 2u^n + u^{n-1}}{\Delta t^2}\\ 
&= I\frac{A^{n+1} - 2A^n + A^{n-1}}{\Delta t^2}\\ 
&= I\frac{\exp{(i\tilde\omega(t+\Delta t))} - 2\exp{(i\tilde\omega t)} + \exp{(i\tilde\omega(t-\Delta t))}}{\Delta t^2}\\ 
&= I\exp{(i\tilde\omega t)}\frac{1}{\Delta t^2}\left(\exp{(i\tilde\omega(\Delta t))} + \exp{(i\tilde\omega(-\Delta t))} - 2\right)\\ 
&= I\exp{(i\tilde\omega t)}\frac{2}{\Delta t^2}\left(\cosh(i\tilde\omega\Delta t) -1 \right)\\ 
&= I\exp{(i\tilde\omega t)}\frac{2}{\Delta t^2}\left(\cos(\tilde\omega\Delta t) -1 \right)\\ 
&= -I\exp{(i\tilde\omega t)}\frac{4}{\Delta t^2}\sin^2(\frac{\tilde\omega\Delta t}{2})
\end{align*}
$$
<p>&nbsp;<br>
</section>


<section>
<h2 id="___sec27">Solving for the numerical frequency </h2>

<p>
The scheme
with \( u^n=I\exp{(i\omega\tilde\Delta t\, n)} \) inserted gives

<p>&nbsp;<br>
$$
-I\exp{(i\tilde\omega t)}\frac{4}{\Delta t^2}\sin^2(\frac{\tilde\omega\Delta t}{2})
+ \omega^2 I\exp{(i\tilde\omega t)} = 0
$$
<p>&nbsp;<br>

which after dividing by \( I\exp{(i\tilde\omega t)} \) results in
<p>&nbsp;<br>
$$
\frac{4}{\Delta t^2}\sin^2(\frac{\tilde\omega\Delta t}{2}) = \omega^2
$$
<p>&nbsp;<br>

Solve for \( \tilde\omega \):
<p>&nbsp;<br>
$$
\tilde\omega = \pm \frac{2}{\Delta t}\sin^{-1}\left(\frac{\omega\Delta t}{2}\right)
$$
<p>&nbsp;<br>


<ul>
 <p><li> Frequency error because \( \tilde\omega \neq \omega \).</li>
 <p><li> Note: dimensionless number \( p=\omega\Delta t \) is the key parameter <br />
   (i.e., no of time intervals per period is important, not \( \Delta t \) itself)</li>
 <p><li> But how good is the approximation \( \tilde\omega \) to \( \omega \)?</li>
</ul>
</section>


<section>
<h2 id="___sec28">Polynomial approximation of the frequency error </h2>

<p>
Taylor series expansion
for small \( \Delta t \) gives a formula that is easier to understand:

<p>

<!-- code=ipy (!bc ipy) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 80%; line-height: 125%"><span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">sympy</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">*</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #d0d0d0">dt,</span> <span style="color: #d0d0d0">w</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">symbols(</span><span style="color: #ed9d13">&#39;dt w&#39;</span><span style="color: #d0d0d0">)</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #d0d0d0">w_tilde</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">asin(w*dt/</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">).series(dt,</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">4</span><span style="color: #d0d0d0">)*</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">/dt</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #6ab825; font-weight: bold">print</span> <span style="color: #d0d0d0">w_tilde</span>
<span style="color: #d0d0d0">(dt*w</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">dt**</span><span style="color: #3677a9">3</span><span style="color: #d0d0d0">*w**</span><span style="color: #3677a9">3</span><span style="color: #d0d0d0">/</span><span style="color: #3677a9">24</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">O(dt**</span><span style="color: #3677a9">4</span><span style="color: #d0d0d0">))/dt</span>  <span style="color: #999999; font-style: italic"># note the final &quot;/dt&quot;</span>
</pre></div>
<p>&nbsp;<br>
$$
\tilde\omega = \omega\left( 1 + \frac{1}{24}\omega^2\Delta t^2\right) + {\cal O}(\Delta t^3)
$$
<p>&nbsp;<br>

The numerical frequency is too large (to fast oscillations).
</section>


<section>
<h2 id="___sec29">Plot of the frequency error </h2>

<p>
<center><p><img src="fig-vib/discrete_freq.png" align="bottom" width=600></p></center>

<p>
Recommendation: 25-30 points per period.
</section>


<section>
<h2 id="___sec30">Exact discrete solution </h2>

<p>&nbsp;<br>
$$
u^n = I\cos\left(\tilde\omega n\Delta t\right),\quad
\tilde\omega = \frac{2}{\Delta t}\sin^{-1}\left(\frac{\omega\Delta t}{2}\right)
$$
<p>&nbsp;<br>

<p>
The error mesh function,

<p>&nbsp;<br>
$$ e^n = \uex(t_n) - u^n =
I\cos\left(\omega n\Delta t\right)
- I\cos\left(\tilde\omega n\Delta t\right)
$$
<p>&nbsp;<br>

is ideal for verification and further analysis!

<p>&nbsp;<br>
$$
e^n = I\cos\left(\omega n\Delta t\right)
- I\cos\left(\tilde\omega n\Delta t\right)
= -2I\sin\left(t\half\left( \omega - \tilde\omega\right)\right)
\sin\left(t\half\left( \omega + \tilde\omega\right)\right)
$$
<p>&nbsp;<br>
</section>


<section>
<h2 id="___sec31">Convergence of the numerical scheme </h2>

<p>
Can easily show <em>convergence</em>:

<p>&nbsp;<br>
$$ e^n\rightarrow 0 \hbox{ as }\Delta t\rightarrow 0,$$
<p>&nbsp;<br>

because

<p>&nbsp;<br>
$$
\lim_{\Delta t\rightarrow 0}
\tilde\omega = \lim_{\Delta t\rightarrow 0}
\frac{2}{\Delta t}\sin^{-1}\left(\frac{\omega\Delta t}{2}\right)
= \omega,
$$
<p>&nbsp;<br>

by L'Hopital's rule or simply asking <code>sympy</code>:
or <a href="http://www.wolframalpha.com/input/?i=%282%2Fx%29*asin%28w*x%2F2%29+as+x-%3E0" target="_self">WolframAlpha</a>:

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 80%; line-height: 125%"><span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">sympy</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">sym</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #d0d0d0">dt,</span> <span style="color: #d0d0d0">w</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">sym.symbols(</span><span style="color: #ed9d13">&#39;x w&#39;</span><span style="color: #d0d0d0">)</span>
<span style="color: #d0d0d0">&gt;&gt;&gt;</span> <span style="color: #d0d0d0">sym.limit((</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">/dt)*sym.asin(w*dt/</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">),</span> <span style="color: #d0d0d0">dt,</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">dir</span><span style="color: #d0d0d0">=</span><span style="color: #ed9d13">&#39;+&#39;</span><span style="color: #d0d0d0">)</span>
<span style="color: #d0d0d0">w</span>
</pre></div>
</section>


<section>
<h2 id="___sec32">Stability </h2>

<p>
Observations:

<ul>
 <p><li> Numerical solution has constant amplitude (desired!), but an angular frequency error</li>
 <p><li> Constant amplitude requires \( \sin^{-1}(\omega\Delta t/2) \) to be
   real-valued \( \Rightarrow |\omega\Delta t/2| \leq 1 \)</li>
 <p><li> \( \sin^{-1}(x) \) is complex if \( |x| > 1 \), and then \( \tilde\omega \) becomes
   complex</li>
</ul>
<p>

What is the consequence of complex \( \tilde\omega \)?

<ul>
 <p><li> Set \( \tilde\omega = \tilde\omega_r + i\tilde\omega_i \)</li>
 <p><li> Since \( \sin^{-1}(x) \) has a <a href="http://www.wolframalpha.com/input/?i=arcsin%28x%29%2C+x+in+%280%2C3%29" target="_self">*negative* imaginary part</a> for
   \( x>1 \), \( \exp{(i\omega\tilde t)}=\exp{(-\tilde\omega_i t)}\exp{(i\tilde\omega_r t)} \)
   leads to exponential growth \( e^{-\tilde\omega_it} \)
   when \( -\tilde\omega_i t > 0 \)</li>
 <p><li> This is <em>instability</em> because the qualitative behavior is wrong</li>
</ul>
</section>


<section>
<h2 id="___sec33">The stability criterion </h2>

<p>
Cannot tolerate growth and must therefore demand a <em>stability criterion</em>
<p>&nbsp;<br>
$$
\frac{\omega\Delta t}{2} \leq 1\quad\Rightarrow\quad
\Delta t \leq \frac{2}{\omega}
$$
<p>&nbsp;<br>

<p>
Try \( \Delta t = \frac{2}{\omega} + 9.01\cdot 10^{-5} \) (<em>slightly</em> too big!):

<p>
<center><p><img src="fig-vib/vib_unstable.png" align="bottom" width=400></p></center>
</section>


<section>
<h2 id="___sec34">Summary of the analysis </h2>

<p>
We can draw three important conclusions:

<ol>
<p><li> The key parameter in the formulas is \( p=\omega\Delta t \) (dimensionless)</li>

<ol>

<p><li> Period of oscillations: \( P=2\pi/\omega \)</li>

<p><li> Number of time steps per period: \( N_P=P/\Delta t \)</li>

<p><li> \( \Rightarrow\ p=\omega\Delta t = 2\pi/ N_P \sim 1/N_P \)</li>

<p><li> The smallest possible \( N_P \) is 2 \( \Rightarrow \) $p\in (0,\pi]$</li>
</ol>
<p><li> For \( p\leq 2 \) the amplitude of \( u^n \) is constant (stable solution)</li>
<p><li> \( u^n \) has a relative frequency error
   \( \tilde\omega/\omega \approx 1 + \frac{1}{24}p^2 \), making numerical
   peaks occur too early</li>
</ol>
</section>


<section>
<h1 id="vib:model2x2">Alternative schemes based on 1st-order equations</h1>
</section>


<section>
<h2 id="___sec36">Rewriting 2nd-order ODE as system of two 1st-order ODEs </h2>

<p>
The vast collection of ODE solvers (e.g., in <a href="https://github.com/hplgit/odespy" target="_self">Odespy</a>) cannot be applied to
<p>&nbsp;<br>
$$ u^{\prime\prime} + \omega^2 u = 0$$
<p>&nbsp;<br>

unless we write this higher-order ODE as a system of 1st-order ODEs.

<p>
Introduce an auxiliary variable \( v=u^{\prime} \):

<p>&nbsp;<br>
$$
\begin{align}
u^{\prime} &= v,
\tag{1}\\ 
v^{\prime} &= -\omega^2 u
\tag{2}
\tp
\end{align}
$$
<p>&nbsp;<br>

<p>
Initial conditions: \( u(0)=I \) and \( v(0)=0 \).
</section>


<section>
<h2 id="___sec37">The Forward Euler scheme </h2>

<p>
We apply the Forward Euler scheme to each component equation:

<p>&nbsp;<br>
$$ [D_t^+ u = v]^n,$$
<p>&nbsp;<br>

<p>&nbsp;<br>
$$ [D_t^+ v = -\omega^2 u]^n,$$
<p>&nbsp;<br>

or written out,

<p>&nbsp;<br>
$$
\begin{align}
u^{n+1} &= u^n + \Delta t v^n,\\ 
v^{n+1} &= v^n -\Delta t \omega^2 u^n
\tp
\end{align}
$$
<p>&nbsp;<br>
</section>


<section>
<h2 id="___sec38">The Backward Euler scheme </h2>

<p>
We apply the Backward Euler scheme to each component equation:

<p>&nbsp;<br>
$$ [D_t^- u = v]^{n+1},$$
<p>&nbsp;<br>

<p>&nbsp;<br>
$$ [D_t^- v = -\omega u]^{n+1} \tp  $$
<p>&nbsp;<br>

Written out:
<p>&nbsp;<br>
$$
\begin{align}
u^{n+1} - \Delta t v^{n+1} = u^{n},\\ 
v^{n+1} + \Delta t \omega^2 u^{n+1} = v^{n}
\tp
\end{align}
$$
<p>&nbsp;<br>

This is a <em>coupled</em> \( 2\times 2 \) system for the new values at \( t=t_{n+1} \)!
</section>


<section>
<h2 id="___sec39">The Crank-Nicolson scheme </h2>

<p>&nbsp;<br>
$$
[D_t u = \overline{v}^t]^{n+\half},$$
<p>&nbsp;<br>

<p>&nbsp;<br>
$$
[D_t v = -\omega \overline{u}^t]^{n+\half}$$
<p>&nbsp;<br>

The result is also a coupled system:

<p>&nbsp;<br>
$$
\begin{align}
u^{n+1} - \half\Delta t v^{n+1} &= u^{n} + \half\Delta t v^{n},\\ 
v^{n+1} + \half\Delta t \omega^2 u^{n+1} &= v^{n}
- \half\Delta t \omega^2 u^{n}
\tp
\end{align}
$$
<p>&nbsp;<br>
</section>


<section>
<h2 id="___sec40">Comparison of schemes via Odespy </h2>

<p>
Can use
<a href="https://github.com/hplgit/odespy" target="_self">Odespy</a> to compare many methods
for first-order schemes:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">odespy</span>
<span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #447fcf; text-decoration: underline">numpy</span> <span style="color: #6ab825; font-weight: bold">as</span> <span style="color: #447fcf; text-decoration: underline">np</span>

<span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">f</span><span style="color: #d0d0d0">(u,</span> <span style="color: #d0d0d0">t,</span> <span style="color: #d0d0d0">w=</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">):</span>
    <span style="color: #d0d0d0">u,</span> <span style="color: #d0d0d0">v</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">u</span>  <span style="color: #999999; font-style: italic"># u is array of length 2 holding our [u, v]</span>
    <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">[v,</span> <span style="color: #d0d0d0">-w**</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*u]</span>

<span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">run_solvers_and_plot</span><span style="color: #d0d0d0">(solvers,</span> <span style="color: #d0d0d0">timesteps_per_period=</span><span style="color: #3677a9">20</span><span style="color: #d0d0d0">,</span>
                         <span style="color: #d0d0d0">num_periods=</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">I=</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">w=</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*np.pi):</span>
    <span style="color: #d0d0d0">P</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">2</span><span style="color: #d0d0d0">*np.pi/w</span>  <span style="color: #999999; font-style: italic"># duration of one period</span>
    <span style="color: #d0d0d0">dt</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">P/timesteps_per_period</span>
    <span style="color: #d0d0d0">Nt</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">num_periods*timesteps_per_period</span>
    <span style="color: #d0d0d0">T</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">Nt*dt</span>
    <span style="color: #d0d0d0">t_mesh</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">np.linspace(</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">T,</span> <span style="color: #d0d0d0">Nt+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span>

    <span style="color: #d0d0d0">legends</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[]</span>
    <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">solver</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #d0d0d0">solvers:</span>
        <span style="color: #d0d0d0">solver.set(f_kwargs={</span><span style="color: #ed9d13">&#39;w&#39;</span><span style="color: #d0d0d0">:</span> <span style="color: #d0d0d0">w})</span>
        <span style="color: #d0d0d0">solver.set_initial_condition([I,</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">])</span>
        <span style="color: #d0d0d0">u,</span> <span style="color: #d0d0d0">t</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">solver.solve(t_mesh)</span>
</pre></div>
</section>


<section>
<h2 id="___sec41">Forward and Backward Euler and Crank-Nicolson </h2>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 80%; line-height: 125%"><span style="color: #d0d0d0">solvers</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[</span>
    <span style="color: #d0d0d0">odespy.ForwardEuler(f),</span>
    <span style="color: #999999; font-style: italic"># Implicit methods must use Newton solver to converge</span>
    <span style="color: #d0d0d0">odespy.BackwardEuler(f,</span> <span style="color: #d0d0d0">nonlinear_solver=</span><span style="color: #ed9d13">&#39;Newton&#39;</span><span style="color: #d0d0d0">),</span>
    <span style="color: #d0d0d0">odespy.CrankNicolson(f,</span> <span style="color: #d0d0d0">nonlinear_solver=</span><span style="color: #ed9d13">&#39;Newton&#39;</span><span style="color: #d0d0d0">),</span>
    <span style="color: #d0d0d0">]</span>
</pre></div>
<p>
Two plot types:

<ul>

<p><li> \( u(t) \) vs \( t \)</li>

<p><li> Parameterized curve \( (u(t), v(t)) \) in <em>phase space</em></li>

<p><li> Exact curve is an ellipse: \( (I\cos\omega t, -\omega I\sin\omega t) \),
    closed and periodic</li>
</ul>
</section>


<section>
<h2 id="___sec42">Phase plane plot of the numerical solutions </h2>

<p>
<center><p><img src="fig-vib/vib_theta_1_pp.png" align="bottom" width=800></p></center>

<p>
Note: CrankNicolson in Odespy leads to the name MidpointImplicit in plots.
</section>


<section>
<h2 id="___sec43">Plain solution curves </h2>

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 1:  Comparison of classical schemes. <div id="vib:model1:1st:odespy:theta"></div> </p></center>
<p><img src="fig-vib/vib_theta_1_u.png" align="bottom" width=800></p>
</center>
</section>


<section>
<h2 id="___sec44">Observations from the figures </h2>

<ul>

<p><li> Forward Euler has growing amplitude and outward \( (u,v) \) spiral - pumps
    energy into the system.</li>

<p><li> Backward Euler is opposite: decreasing amplitude, inward sprial,
    extracts energy.</li>

<p><li> <b>Forward and Backward Euler are useless for vibrations.</b></li>

<p><li> Crank-Nicolson (MidpointImplicit) looks much better.</li>
</ul>
</section>


<section>
<h2 id="___sec45">Runge-Kutta methods of order 2 and 4; short time series </h2>

<p>
<center><p><img src="fig-vib/vib_RK_1_pp.png" align="bottom" width=800></p></center>

<p>
<center><p><img src="fig-vib/vib_RK_1_u.png" align="bottom" width=800></p></center>
</section>


<section>
<h2 id="___sec46">Runge-Kutta methods of order 2 and 4; longer time series </h2>

<p>
<center><p><img src="fig-vib/vib_RK_10_pp.png" align="bottom" width=800></p></center>

<p>
<center><p><img src="fig-vib/vib_RK_10_u.png" align="bottom" width=800></p></center>
</section>


<section>
<h2 id="___sec47">Crank-Nicolson; longer time series </h2>

<p>
<center><p><img src="fig-vib/vib_CN_10_pp.png" align="bottom" width=800></p></center>

<p>
<center><p><img src="fig-vib/vib_CN_10_u.png" align="bottom" width=800></p></center>

<p>
(MidpointImplicit means CrankNicolson in Odespy)
</section>


<section>
<h2 id="___sec48">Observations of RK and CN methods </h2>

<ul>

<p><li> 4th-order Runge-Kutta is very accurate, also for large \( \Delta t \).</li>

<p><li> 2th-order Runge-Kutta is almost as bad as Forward and Backward
    Euler.</li>

<p><li> Crank-Nicolson is accurate, but the amplitude is not as accurate
    as the difference scheme for \( u^{\prime\prime}+\omega^2u=0 \).</li>
</ul>
</section>


<section>
<h2 id="___sec49">Energy conservation property </h2>

<p>
The model

<p>&nbsp;<br>
$$ u^{\prime\prime} + \omega^2 u = 0,\quad u(0)=I,\ u^{\prime}(0)=V,$$
<p>&nbsp;<br>

has the nice <em>energy conservation property</em> that

<p>&nbsp;<br>
$$ E(t) = \half(u^{\prime})^2 + \half\omega^2u^2 = \hbox{const}\tp$$
<p>&nbsp;<br>

This can be used to check solutions.
</section>


<section>
<h2 id="___sec50">Derivation of the energy conservation property </h2>

<p>
Multiply \( u^{\prime\prime}+\omega^2u=0 \) by \( u^{\prime} \) and integrate:

<p>&nbsp;<br>
$$ \int_0^T u^{\prime\prime}u^{\prime} dt + \int_0^T\omega^2 u u^{\prime} dt = 0\tp$$
<p>&nbsp;<br>

Observing that

<p>&nbsp;<br>
$$ u^{\prime\prime}u^{\prime} = \frac{d}{dt}\half(u^{\prime})^2,\quad uu^{\prime} = \frac{d}{dt} {\half}u^2,$$
<p>&nbsp;<br>

we get

<p>&nbsp;<br>
$$
\int_0^T (\frac{d}{dt}\half(u^{\prime})^2 + \frac{d}{dt} \half\omega^2u^2)dt = E(T) - E(0),
$$
<p>&nbsp;<br>

where

<p>&nbsp;<br>
$$
E(t) = \half(u^{\prime})^2 + \half\omega^2u^2
$$
<p>&nbsp;<br>
</section>


<section>
<h2 id="___sec51">Remark about \( E(t) \) </h2>

<p>
\( E(t) \) does not measure energy, energy per mass unit.

<p>
Starting with an ODE coming directly from Newton's 2nd law \( F=ma \) with
a spring force \( F=-ku \) and \( ma=mu^{\prime\prime} \) (\( a \): acceleration, \( u \): displacement),
we have

<p>&nbsp;<br>
$$ mu^{\prime\prime} + ku = 0$$
<p>&nbsp;<br>

Integrating this equation gives a physical energy balance:

<p>&nbsp;<br>
$$
E(t) = \underbrace{{\half}mv^2}_{\hbox{kinetic energy} }
+ \underbrace{{\half}ku^2}_{\hbox{potential energy}} = E(0),\quad v=u^{\prime}
$$
<p>&nbsp;<br>

Note: the balance is not valid if we add other terms to the ODE.
</section>


<section>
<h2 id="vib:model2x2:EulerCromer">The Euler-Cromer method; idea</h2>

<p>
2x2 system for \( u^{\prime\prime}+\omega^2u=0 \):

<p>&nbsp;<br>
$$
\begin{align*}
v^{\prime} &= -\omega^2u\\ 
u^{\prime} &= v
\end{align*}
$$
<p>&nbsp;<br>

<p>
Forward-backward discretization:

<ul>

<p><li> Update \( v \) with Forward Euler</li>

<p><li> Update \( u \) with Backward Euler, using latest \( v \)</li>
</ul>
<p>&nbsp;<br>
$$
\begin{align}
[D_t^+v &= -\omega^2u]^n\\ 
[D_t^-u &= v]^{n+1}
\end{align}
$$
<p>&nbsp;<br>
</section>


<section>
<h2 id="___sec53">The Euler-Cromer method; complete formulas </h2>

<p>
Written out:

<p>&nbsp;<br>
$$
\begin{align}
u^0 &= I,\\ 
v^0 &= 0,\\ 
v^{n+1} &= v^n -\Delta t \omega^2u^{n}
\tag{3}\\ 
u^{n+1} &= u^n + \Delta t v^{n+1}
\tag{4}
\end{align}
$$
<p>&nbsp;<br>

<p>
Names: Forward-backward scheme, <a href="http://en.wikipedia.org/wiki/Semi-implicit_Euler_method" target="_self">Semi-implicit Euler method</a>, symplectic
Euler, semi-explicit Euler, Newton-Stormer-Verlet, and <em>Euler-Cromer</em>.
</section>


<section>
<h2 id="___sec54">Euler-Cromer is equivalent to the scheme for \( u^{\prime\prime}+\omega^2u=0 \) </h2>

<ul>
 <p><li> Forward Euler and Backward Euler have error \( \Oof{\Delta t} \)</li>
 <p><li> What about the overall scheme? Expect \( \Oof{\Delta t} \)...</li>
</ul>
<p>

We can eliminate \( v^n \) and \( v^{n+1} \), resulting in

<p>&nbsp;<br>
$$
u^{n+1} = 2u^n - u^{n-1} - \Delta t^2 \omega^2u^{n}
$$
<p>&nbsp;<br>

<p>
which is the centered finite differrence scheme for \( u^{\prime\prime}+\omega^2u=0 \)!
</section>


<section>
<h2 id="___sec55">The schemes are not equivalent wrt the initial conditions </h2>

<p>&nbsp;<br>
$$ u^{\prime}=v=0\quad\Rightarrow\quad v^0=0,$$
<p>&nbsp;<br>

so

<p>&nbsp;<br>
$$
\begin{align*}
v^1 &= v^0 - \Delta t\omega^2 u^0 = - \Delta t\omega^2 u^0\\ 
u^1 &= u^0 + \Delta t v^1 = u^0 - \Delta t\omega^2 u^0 !=
\underbrace{u^0 - \frac{1}{2}\Delta t\omega^2 u^0}_{\mbox{from }[D_tD_t u +\omega^2 u=0]^n\mbox{ and }[D_{2t}u=0]^0}
\end{align*}
$$
<p>&nbsp;<br>

<p>
The exact discrete solution derived earlier does not fit the Euler-Cromer
scheme because of mismatch for \( u^1 \).
</section>


<section>
<h1 id="vib:model2">Generalization: damping, nonlinear spring, and external excitation</h1>

<p>&nbsp;<br>
$$
mu'' + f(u') + s(u) = F(t),\quad u(0)=I,\ u'(0)=V,\ t\in (0,T]
$$
<p>&nbsp;<br>

Input data: \( m \), \( f(u') \), \( s(u) \), \( F(t) \), \( I \), \( V \), and \( T \).

<p>
Typical choices of \( f \) and \( s \):

<ul>
 <p><li> linear damping \( f(u')=bu \), or</li>
 <p><li> quadratic damping \( f(u')=bu'|u'| \)</li>
 <p><li> linear spring \( s(u)=cu \)</li>
 <p><li> nonlinear spring \( s(u)\sim \sin(u) \) (pendulum)</li>
</ul>
</section>


<section>
<h2 id="vib:ode2:fdm:flin">A centered scheme for linear damping</h2>

<p>&nbsp;<br>
$$
[mD_tD_t u + f(D_{2t}u) + s(u) = F]^n
$$
<p>&nbsp;<br>

Written out

<p>&nbsp;<br>
$$
m\frac{u^{n+1}-2u^n + u^{n-1}}{\Delta t^2}
+ f(\frac{u^{n+1}-u^{n-1}}{2\Delta t}) + s(u^n) = F^n
$$
<p>&nbsp;<br>

Assume \( f(u') \) is linear in \( u'=v \):

<p>&nbsp;<br>
$$
u^{n+1} = \left(2mu^n + (\frac{b}{2}\Delta t - m)u^{n-1} +
\Delta t^2(F^n - s(u^n))
\right)(m + \frac{b}{2}\Delta t)^{-1}
$$
<p>&nbsp;<br>
</section>


<section>
<h2 id="___sec58">Initial conditions </h2>

<p>
\( u(0)=I \), \( u'(0)=V \):

<p>&nbsp;<br>
$$
\begin{align*}
\lbrack u &=I\rbrack^0\quad\Rightarrow\quad u^0=I\\ 
\lbrack D_{2t}u &=V\rbrack^0\quad\Rightarrow\quad u^{-1} = u^{1} - 2\Delta t V
\end{align*}
$$
<p>&nbsp;<br>

End result:

<p>&nbsp;<br>
$$
u^1 = u^0 + \Delta t\, V
+ \frac{\Delta t^2}{2m}(-bV - s(u^0) + F^0)
$$
<p>&nbsp;<br>

Same formula for \( u^1 \) as when using a centered scheme for \( u''+\omega u=0 \).
</section>


<section>
<h2 id="vib:ode2:fdm:fquad">Linearization via a geometric mean approximation</h2>

<ul>
 <p><li> \( f(u')=bu'|u'| \) leads to a quadratic equation for \( u^{n+1} \)</li>
 <p><li> Instead of solving the quadratic equation, we use a geometric mean
   approximation</li>
</ul>
<p>

In general, the geometric mean approximation reads
<p>&nbsp;<br>
$$ (w^2)^n \approx w^{n-\half}w^{n+\half}\tp$$
<p>&nbsp;<br>

For \( |u'|u' \) at \( t_n \):

<p>&nbsp;<br>
$$ [u'|u'|]^n \approx u'(t_n+{\half})|u'(t_n-{\half})|\tp$$
<p>&nbsp;<br>

For \( u' \) at \( t_{n\pm 1/2} \) we use centered difference:

<p>&nbsp;<br>
$$
u'(t_{n+1/2})\approx [D_t u]^{n+\half},\quad u'(t_{n-1/2})\approx [D_t u]^{n-\half}
$$
<p>&nbsp;<br>
</section>


<section>
<h2 id="___sec60">A centered scheme for quadratic damping </h2>

<p>
After some algebra:

<p>&nbsp;<br>
$$
\begin{align*}
u^{n+1} &=  \left( m + b|u^n-u^{n-1}|\right)^{-1}\times \\ 
& \qquad \left(2m u^n - mu^{n-1} + bu^n|u^n-u^{n-1}| + \Delta t^2 (F^n - s(u^n))
\right)
\end{align*}
$$
<p>&nbsp;<br>
</section>


<section>
<h2 id="___sec61">Initial condition for quadratic damping </h2>

<p>
Simply use that \( u'=V \) in the scheme when \( t=0 \) (\( n=0 \)):

<p>&nbsp;<br>
$$
[mD_tD_t u + bV|V| + s(u) = F]^0
$$
<p>&nbsp;<br>

<p>
which gives

<p>&nbsp;<br>
$$
u^1 = u^0 + \Delta t V + \frac{\Delta t^2}{2m}\left(-bV|V| - s(u^0) + F^0\right)
$$
<p>&nbsp;<br>
</section>


<section>
<h2 id="___sec62">Algorithm </h2>

<ol>
 <p><li> \( u^0=I \)</li>
 <p><li> compute \( u^1 \) (formula depends on linear/quadratic damping)</li>
 <p><li> for \( n=1,2,\ldots,N_t-1 \):</li>

<ol>

<p><li> compute \( u^{n+1} \) from formula (depends on linear/quadratic damping)</li>
</ol>
<p>
</ol>
</section>


<section>
<h2 id="___sec63">Implementation </h2>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 80%; line-height: 125%"><span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">solver</span><span style="color: #d0d0d0">(I,</span> <span style="color: #d0d0d0">V,</span> <span style="color: #d0d0d0">m,</span> <span style="color: #d0d0d0">b,</span> <span style="color: #d0d0d0">s,</span> <span style="color: #d0d0d0">F,</span> <span style="color: #d0d0d0">dt,</span> <span style="color: #d0d0d0">T,</span> <span style="color: #d0d0d0">damping=</span><span style="color: #ed9d13">&#39;linear&#39;</span><span style="color: #d0d0d0">):</span>
    <span style="color: #d0d0d0">dt</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">float</span><span style="color: #d0d0d0">(dt);</span> <span style="color: #d0d0d0">b</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">float</span><span style="color: #d0d0d0">(b);</span> <span style="color: #d0d0d0">m</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">float</span><span style="color: #d0d0d0">(m)</span> <span style="color: #999999; font-style: italic"># avoid integer div.</span>
    <span style="color: #d0d0d0">Nt</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">int</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">round</span><span style="color: #d0d0d0">(T/dt))</span>
    <span style="color: #d0d0d0">u</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">zeros(Nt+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span>
    <span style="color: #d0d0d0">t</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">linspace(</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">Nt*dt,</span> <span style="color: #d0d0d0">Nt+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">)</span>

    <span style="color: #d0d0d0">u[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">I</span>
    <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">damping</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;linear&#39;</span><span style="color: #d0d0d0">:</span>
        <span style="color: #d0d0d0">u[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">u[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">dt*V</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">dt**</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">/(</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*m)*(-b*V</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">s(u[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">])</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">F(t[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]))</span>
    <span style="color: #6ab825; font-weight: bold">elif</span> <span style="color: #d0d0d0">damping</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;quadratic&#39;</span><span style="color: #d0d0d0">:</span>
        <span style="color: #d0d0d0">u[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">u[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">dt*V</span> <span style="color: #d0d0d0">+</span> \ 
               <span style="color: #d0d0d0">dt**</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">/(</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*m)*(-b*V*</span><span style="color: #24909d">abs</span><span style="color: #d0d0d0">(V)</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">s(u[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">])</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">F(t[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]))</span>

    <span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">n</span> <span style="color: #6ab825; font-weight: bold">in</span> <span style="color: #24909d">range</span><span style="color: #d0d0d0">(</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">Nt):</span>
        <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">damping</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;linear&#39;</span><span style="color: #d0d0d0">:</span>
            <span style="color: #d0d0d0">u[n+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*m*u[n]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">(b*dt/</span><span style="color: #3677a9">2</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">m)*u[n-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">+</span>
                      <span style="color: #d0d0d0">dt**</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*(F(t[n])</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">s(u[n])))/(m</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">b*dt/</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">)</span>
        <span style="color: #6ab825; font-weight: bold">elif</span> <span style="color: #d0d0d0">damping</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;quadratic&#39;</span><span style="color: #d0d0d0">:</span>
            <span style="color: #d0d0d0">u[n+</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*m*u[n]</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">m*u[n-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">b*u[n]*</span><span style="color: #24909d">abs</span><span style="color: #d0d0d0">(u[n]</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">u[n-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">])</span>
                      <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">dt**</span><span style="color: #3677a9">2</span><span style="color: #d0d0d0">*(F(t[n])</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">s(u[n])))/</span>\ 
                      <span style="color: #d0d0d0">(m</span> <span style="color: #d0d0d0">+</span> <span style="color: #d0d0d0">b*</span><span style="color: #24909d">abs</span><span style="color: #d0d0d0">(u[n]</span> <span style="color: #d0d0d0">-</span> <span style="color: #d0d0d0">u[n-</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]))</span>
    <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">u,</span> <span style="color: #d0d0d0">t</span>
</pre></div>
</section>


<section>
<h2 id="vib:ode2:verify">Verification</h2>

<ul>
 <p><li> Constant solution \( \uex = I \) (\( V=0 \)) fulfills the ODE problem
   and the discrete equations. Ideal for debugging!</li>
 <p><li> Linear solution \( \uex = Vt+I \) fulfills the ODE problem and
   the discrete equations.</li>
 <p><li> Quadratic solution \( \uex = bt^2 + Vt + I \) fulfills the ODE
   problem and the discrete equations with linear damping, but not
   for quadratic damping.
   A special discrete source term can allow \( \uex \) to also fulfill
   the discrete equations with quadratic damping.</li>
</ul>
</section>


<section>
<h2 id="___sec65">Demo program </h2>

<p>
<a href="http://tinyurl.com/nm5587k/vib/vib.py" target="_self"><tt>vib.py</tt></a> supports input via the command line:

<p>

<!-- code=text (!bc sys) typeset with pygments style "native" -->
<div class="highlight" style="background: #202020"><pre style="font-size: 80%; line-height: 125%">Terminal&gt; python vib.py --s &#39;sin(u)&#39; --F &#39;3*cos(4*t)&#39; --c 0.03
</pre></div>
<p>
This results in a <a href="http://tinyurl.com/opdfafk/pub/mov-vib/vib_generalized_dt0.05/index.html" target="_self">moving window following the function</a> on the screen.

<p>
<center><p><img src="fig-vib/vib_gen_demo.png" align="bottom" width=600></p></center>
</section>


<section>
<h2 id="___sec66">Euler-Cromer formulation </h2>

<p>
We rewrite

<p>&nbsp;<br>
$$
mu'' + f(u') + s(u) = F(t),\quad u(0)=I,\ u'(0)=V,\ t\in (0,T]
$$
<p>&nbsp;<br>

as a first-order ODE system

<p>&nbsp;<br>
$$
\begin{align*}
u' &= v
\\ 
v' &= m^{-1}\left(F(t) - f(v) - s(u)\right)
\end{align*}
$$
<p>&nbsp;<br>
</section>


<section>
<h2 id="___sec67">Staggered grid </h2>

<ul>
 <p><li> \( u \) is unknown at \( t_n \): \( u^n \)</li>
 <p><li> \( v \) is unknown at \( t_{n+1/2} \): \( v^{n+\half} \)</li>
 <p><li> All derivatives are approximated by centered differences</li>
</ul>
<p>&nbsp;<br>
$$
\begin{align*}
\lbrack D_t u &= v\rbrack^{n-\half}
\\ 
\lbrack D_tv &= m^{-1}\left(F(t) - f(v) - s(u)\right)\rbrack^n
\end{align*}
$$
<p>&nbsp;<br>

<p>
Written out,

<p>&nbsp;<br>
$$
\begin{align*}
\frac{u^n - u^{n-1}}{\Delta t} &= v^{n-\half}\\ 
\frac{v^{n+\half} - v^{n-\half}}{\Delta t}
&= m^{-1}\left(F^n - f(v^n) - s(u^n)\right)
\end{align*}
$$
<p>&nbsp;<br>

<p>
Problem: \( f(v^n) \)
</section>


<section>
<h2 id="___sec68">Linear damping </h2>

<p>
With \( f(v)=bv \), we can use an arithmetic mean for \( bv^n \) a la
Crank-Nicolson schemes.

<p>&nbsp;<br>
$$
\begin{align*}
u^n & = u^{n-1} + {\Delta t}v^{n-\half},\\ 
v^{n+\half} &= \left(1 + \frac{b}{2m}\Delta t\right)^{-1}\left(
v^{n-\half} + {\Delta t}
m^{-1}\left(F^n - {\half}f(v^{n-\half}) - s(u^n)\right)\right)\tp
\end{align*}
$$
<p>&nbsp;<br>
</section>


<section>
<h2 id="___sec69">Quadratic damping </h2>

<p>
With \( f(v)=b|v|v \), we can use a geometric mean

<p>&nbsp;<br>
$$
b|v^n|v^n\approx b|v^{n-\half}|v^{n+\half},
$$
<p>&nbsp;<br>

resulting in

<p>&nbsp;<br>
$$
\begin{align*}
u^n & = u^{n-1} + {\Delta t}v^{n-\half},\\ 
v^{n+\half} &= (1 + \frac{b}{m}|v^{n-\half}|\Delta t)^{-1}\left(
v^{n-\half} + {\Delta t}
m^{-1}\left(F^n - s(u^n)\right)\right)\tp
\end{align*}
$$
<p>&nbsp;<br>
</section>


<section>
<h2 id="___sec70">Initial conditions </h2>

<p>&nbsp;<br>
$$
\begin{align*}
u^0 &= I\\ 
v^{\half} &= V - \half\Delta t\omega^2I
\end{align*}
$$
<p>&nbsp;<br>
</section>



</div> <!-- class="slides" -->
</div> <!-- class="reveal" -->

<script src="reveal.js/lib/js/head.min.js"></script>
<script src="reveal.js/js/reveal.min.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

    // Display navigation controls in the bottom right corner
    controls: true,

    // Display progress bar (below the horiz. slider)
    progress: true,

    // Display the page number of the current slide
    slideNumber: true,

    // Push each slide change to the browser history
    history: false,

    // Enable keyboard shortcuts for navigation
    keyboard: true,

    // Enable the slide overview mode
    overview: true,

    // Vertical centering of slides
    //center: true,
    center: false,

    // Enables touch navigation on devices with touch input
    touch: true,

    // Loop the presentation
    loop: false,

    // Change the presentation direction to be RTL
    rtl: false,

    // Turns fragments on and off globally
    fragments: true,

    // Flags if the presentation is running in an embedded mode,
    // i.e. contained within a limited portion of the screen
    embedded: false,

    // Number of milliseconds between automatically proceeding to the
    // next slide, disabled when set to 0, this value can be overwritten
    // by using a data-autoslide attribute on your slides
    autoSlide: 0,

    // Stop auto-sliding after user input
    autoSlideStoppable: true,

    // Enable slide navigation via mouse wheel
    mouseWheel: false,

    // Hides the address bar on mobile devices
    hideAddressBar: true,

    // Opens links in an iframe preview overlay
    previewLinks: false,

    // Transition style
    transition: 'default', // default/cube/page/concave/zoom/linear/fade/none

    // Transition speed
    transitionSpeed: 'default', // default/fast/slow

    // Transition style for full page slide backgrounds
    backgroundTransition: 'default', // default/none/slide/concave/convex/zoom

    // Number of slides away from the current that are visible
    viewDistance: 3,

    // Parallax background image
    //parallaxBackgroundImage: '', // e.g. "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'"

    // Parallax background size
    //parallaxBackgroundSize: '' // CSS syntax, e.g. "2100px 900px"

    theme: Reveal.getQueryHash().theme, // available themes are in reveal.js/css/theme
    transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/none

});

Reveal.initialize({
    dependencies: [
        // Cross-browser shim that fully implements classList - https://github.com/eligrey/classList.js/
        { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },

        // Interpret Markdown in <section> elements
        { src: 'reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
        { src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },

        // Syntax highlight for <code> elements
        { src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },

        // Zoom in and out with Alt+click
        { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },

        // Speaker notes
        { src: 'reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } },

        // Remote control your reveal.js presentation using a touch device
        //{ src: 'reveal.js/plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } },

        // MathJax
        //{ src: 'reveal.js/plugin/math/math.js', async: true }
    ]
});

Reveal.initialize({

    // The "normal" size of the presentation, aspect ratio will be preserved
    // when the presentation is scaled to fit different resolutions. Can be
    // specified using percentage units.
    width: 1170,  // original: 960,
    height: 700,

    // Factor of the display size that should remain empty around the content
    margin: 0.1,

    // Bounds for smallest/largest possible scale to apply to content
    minScale: 0.2,
    maxScale: 1.0

});
</script>

<!-- begin footer logo
<div style="position: absolute; bottom: 0px; left: 0; margin-left: 0px">
<img src="somelogo.png">
</div>
     end footer logo -->



</body>
</html>
