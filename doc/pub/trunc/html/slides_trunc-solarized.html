<!--
Automatically generated HTML file from DocOnce source
(https://github.com/hplgit/doconce/)
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/" />
<meta name="description" content="Study guide: Truncation error analysis">
<meta name="keywords" content="truncation error general,finite differences backward,truncation error Backward Euler scheme,finite differences forward,truncation error Forward Euler scheme,finite differences centered,truncation error Crank-Nicolson scheme,truncation error table of formulas,decay ODE,correction terms,truncation error correction terms,verification">

<title>Study guide: Truncation error analysis</title>


<link href="https://cdn.rawgit.com/hplgit/doconce/master/bundled/html_styles/style_solarized_box/css/solarized_light_code.css" rel="stylesheet" type="text/css" title="light"/>
<script src="https://cdn.rawgit.com/hplgit/doconce/master/bundled/html_styles/style_solarized_box/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<link href="http://thomasf.github.io/solarized-css/solarized-light.min.css" rel="stylesheet">
<style type="text/css">
h1 {color: #b58900;}  /* yellow */
/* h1 {color: #cb4b16;}  orange */
/* h1 {color: #d33682;}  magenta, the original choice of thomasf */
code { padding: 0px; background-color: inherit; }
pre {
  border: 0pt solid #93a1a1;
  box-shadow: none;
}
.alert-text-small   { font-size: 80%;  }
.alert-text-large   { font-size: 130%; }
.alert-text-normal  { font-size: 90%;  }
.alert {
  padding:8px 35px 8px 14px; margin-bottom:18px;
  text-shadow:0 1px 0 rgba(255,255,255,0.5);
  border:1px solid #93a1a1;
  border-radius: 4px;
  -webkit-border-radius: 4px;
  -moz-border-radius: 4px;
  color: #555;
  background-color: #eee8d5;
  background-position: 10px 5px;
  background-repeat: no-repeat;
  background-size: 38px;
  padding-left: 55px;
  width: 75%;
 }
.alert-block {padding-top:14px; padding-bottom:14px}
.alert-block > p, .alert-block > ul {margin-bottom:1em}
.alert li {margin-top: 1em}
.alert-block p+p {margin-top:5px}
.alert-notice { background-image: url(https://cdn.rawgit.com/hplgit/doconce/master/bundled/html_images/small_yellow_notice.png); }
.alert-summary  { background-image:url(https://cdn.rawgit.com/hplgit/doconce/master/bundled/html_images/small_yellow_summary.png); }
.alert-warning { background-image: url(https://cdn.rawgit.com/hplgit/doconce/master/bundled/html_images/small_yellow_warning.png); }
.alert-question {background-image:url(https://cdn.rawgit.com/hplgit/doconce/master/bundled/html_images/small_yellow_question.png); }

div { text-align: justify; text-justify: inter-word; }
</style>


</head>

<!-- tocinfo
{'highest level': 1,
 'sections': [('Overview of what truncation errors are', 1, None, '___sec0'),
              ('Abstract problem setting', 2, None, '___sec1'),
              ('Various error measures', 2, None, '___sec2'),
              ('Truncation errors in finite difference formulas',
               1,
               'trunc:finite:differences',
               'trunc:finite:differences'),
              ("Example: The backward difference for $u'(t)$",
               2,
               'trunc:fd:backward',
               'trunc:fd:backward'),
              ('Taylor series', 2, None, '___sec5'),
              ('Taylor series inserted in the backward difference approximation',
               2,
               None,
               '___sec6'),
              ("The forward difference for $u'(t)$",
               2,
               'trunc:fd:forward',
               'trunc:fd:forward'),
              ("The central difference for $u'(t)$ (1)",
               2,
               'trunc:fd:central',
               'trunc:fd:central'),
              ("The central difference for $u'(t)$ (1)", 2, None, '___sec9'),
              ('Leading-order error terms in finite differences (1)',
               2,
               'trunc:table',
               'trunc:table'),
              ('Leading-order error terms in finite differences (2)',
               2,
               None,
               '___sec11'),
              ('Leading-order error terms in mean values (1)',
               2,
               None,
               '___sec12'),
              ('Leading-order error terms in mean values (2)',
               2,
               None,
               '___sec13'),
              ('Software for computing truncation errors',
               2,
               'trunc:sympy',
               'trunc:sympy'),
              ('Symbolic computing with difference operators',
               2,
               None,
               '___sec15'),
              ('Truncation errors in exponential decay ODE',
               1,
               'trunc:decay',
               'trunc:decay'),
              ('Truncation error of the Forward Euler scheme',
               2,
               'trunc:decay:FE',
               'trunc:decay:FE'),
              ('Truncation error of the Crank-Nicolson scheme',
               2,
               'trunc:decay:CN',
               'trunc:decay:CN'),
              ('Test the understanding!', 2, None, '___sec19'),
              ('Truncation error of the $\\theta$-rule',
               2,
               'trunc:decay:theta',
               'trunc:decay:theta'),
              ('Using symbolic software',
               2,
               'trunc:decay:software',
               'trunc:decay:software'),
              ('Empirical verification of the truncation error (1)',
               2,
               'trunc:decay:estimate:R',
               'trunc:decay:estimate:R'),
              ('Empirical verification of the truncation error (2)',
               2,
               None,
               '___sec23'),
              ('Empirical verification of the truncation error in the Forward Euler scheme',
               2,
               None,
               '___sec24'),
              ('Empirical verification of the truncation error in the Forward Euler scheme',
               2,
               None,
               '___sec25'),
              ('Increasing the accuracy by adding correction terms',
               2,
               'trunc:decay:corr',
               'trunc:decay:corr'),
              ('Lowering the order of the derivative in the correction term',
               2,
               None,
               '___sec27'),
              ('With a correction term Forward Euler becomes Crank-Nicolson',
               2,
               None,
               '___sec28'),
              ('Correction terms in the Crank-Nicolson scheme (1)',
               2,
               None,
               '___sec29'),
              ('Correction terms in the Crank-Nicolson scheme (2)',
               2,
               None,
               '___sec30'),
              ('Extension to variable coefficients', 2, None, '___sec31'),
              ('Exact solutions of the finite difference equations',
               2,
               None,
               '___sec32'),
              ('Computing truncation errors in nonlinear problems (1)',
               2,
               'trunc:decay:gen',
               'trunc:decay:gen'),
              ('Computing truncation errors in nonlinear problems (2)',
               2,
               None,
               '___sec34'),
              ('Truncation errors in vibration ODEs',
               1,
               'trunc:vib',
               'trunc:vib'),
              ('Linear model without damping', 2, None, '___sec36'),
              ('Truncation errors in the initial condition',
               2,
               None,
               '___sec37'),
              ('Computing correction terms', 2, None, '___sec38'),
              ('Model with damping and nonlinearity',
               2,
               'trunc:vib:gen',
               'trunc:vib:gen'),
              ('Carrying out the truncation error analysis',
               2,
               None,
               '___sec40'),
              ('Extension to quadratic damping', 2, None, '___sec41'),
              ('The truncation error for quadratic damping (1)',
               2,
               None,
               '___sec42'),
              ('The truncation error for quadratic damping (2)',
               2,
               None,
               '___sec43'),
              ('The general model formulated as first-order ODEs',
               2,
               'trunc:vib:gen:staggered',
               'trunc:vib:gen:staggered'),
              ('The forward-backward scheme', 2, None, '___sec45'),
              ('Truncation error analysis', 2, None, '___sec46'),
              ('A centered scheme on a staggered mesh', 2, None, '___sec47'),
              ('Truncation error analysis (1)', 2, None, '___sec48'),
              ('Truncation error analysis (2)', 2, None, '___sec49')]}
end of tocinfo -->

<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "AMS"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<!-- newcommands_keep.tex -->
$$
\newcommand{\half}{\frac{1}{2}}
\newcommand{\tp}{\thinspace .}
\newcommand{\uex}{{u_{\small\mbox{e}}}}
\newcommand{\vex}{{v_{\small\mbox{e}}}}
\newcommand{\Oof}[1]{\mathcal{O}(#1)}
$$




    
<!-- ------------------- main content ---------------------- -->



<center><h1>Study guide: Truncation error analysis</h1></center>  <!-- document title -->

<p>
<!-- author(s): Hans Petter Langtangen -->

<center>
<b>Hans Petter Langtangen</b> [1, 2]
</center>

<p>
<!-- institution(s) -->

<center>[1] <b>Center for Biomedical Computing, Simula Research Laboratory</b></center>
<center>[2] <b>Department of Informatics, University of Oslo</b></center>
<br>
<p>
<center><h4>Oct 17, 2015</h4></center> <!-- date -->
<br>
<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2>Table of contents</h2>

<p>
<a href="#___sec0"> Overview of what truncation errors are </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec1"> Abstract problem setting </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec2"> Various error measures </a><br>
<a href="#trunc:finite:differences"> Truncation errors in finite difference formulas </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:fd:backward"> Example: The backward difference for \( u'(t) \) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec5"> Taylor series </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec6"> Taylor series inserted in the backward difference approximation </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:fd:forward"> The forward difference for \( u'(t) \) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:fd:central"> The central difference for \( u'(t) \) (1) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec9"> The central difference for \( u'(t) \) (1) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:table"> Leading-order error terms in finite differences (1) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec11"> Leading-order error terms in finite differences (2) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec12"> Leading-order error terms in mean values (1) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec13"> Leading-order error terms in mean values (2) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:sympy"> Software for computing truncation errors </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec15"> Symbolic computing with difference operators </a><br>
<a href="#trunc:decay"> Truncation errors in exponential decay ODE </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:decay:FE"> Truncation error of the Forward Euler scheme </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:decay:CN"> Truncation error of the Crank-Nicolson scheme </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec19"> Test the understanding! </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:decay:theta"> Truncation error of the \( \theta \)-rule </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:decay:software"> Using symbolic software </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:decay:estimate:R"> Empirical verification of the truncation error (1) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec23"> Empirical verification of the truncation error (2) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec24"> Empirical verification of the truncation error in the Forward Euler scheme </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec25"> Empirical verification of the truncation error in the Forward Euler scheme </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:decay:corr"> Increasing the accuracy by adding correction terms </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec27"> Lowering the order of the derivative in the correction term </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec28"> With a correction term Forward Euler becomes Crank-Nicolson </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec29"> Correction terms in the Crank-Nicolson scheme (1) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec30"> Correction terms in the Crank-Nicolson scheme (2) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec31"> Extension to variable coefficients </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec32"> Exact solutions of the finite difference equations </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:decay:gen"> Computing truncation errors in nonlinear problems (1) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec34"> Computing truncation errors in nonlinear problems (2) </a><br>
<a href="#trunc:vib"> Truncation errors in vibration ODEs </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec36"> Linear model without damping </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec37"> Truncation errors in the initial condition </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec38"> Computing correction terms </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:vib:gen"> Model with damping and nonlinearity </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec40"> Carrying out the truncation error analysis </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec41"> Extension to quadratic damping </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec42"> The truncation error for quadratic damping (1) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec43"> The truncation error for quadratic damping (2) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#trunc:vib:gen:staggered"> The general model formulated as first-order ODEs </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec45"> The forward-backward scheme </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec46"> Truncation error analysis </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec47"> A centered scheme on a staggered mesh </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec48"> Truncation error analysis (1) </a><br>
&nbsp; &nbsp; &nbsp; <a href="#___sec49"> Truncation error analysis (2) </a><br>
</p>
<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h1 id="___sec0">Overview of what truncation errors are </h1>

<ul>
 <p><li> Definition: The <em>truncation error</em> is the discrepancy that
   arises from performing a finite number of steps to approximate a
   process with infinitely many steps.</li>
 <p><li> Widely used: truncation of infinite series, finite
   precision arithmetic, finite differences, and differential equations.</li>
 <p><li> Why? The truncation error is an error measure that is easy to compute.</li>
</ul>

<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec1">Abstract problem setting </h2>

<p>
Consider an abstract differential equation

$$ \mathcal{L}(u)=0$$

Example: \( \mathcal{L}(u)=u'(t)+a(t)u(t)-b(t) \).

<p>
The corresponding discrete equation:

$$ \mathcal{L}_{\Delta}(u) =0$$

Let now

<ul>
 <p><li> \( u \) be the numerical solution of the discrete equations,
   computed at mesh points: \( u^n \), \( n=0,\ldots,N_t \)</li>
 <p><li> \( \uex \) the exact solution of the differential equation</li>
</ul>

$$
\begin{align*}
 \mathcal{L}(\uex)&=0\\ 
 \mathcal{L}_\Delta(u)&=0
\end{align*}
$$

\( u \) is computed at mesh points

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec2">Various error measures </h2>

<ul>
 <p><li> Dream: the true error \( e = \uex-u \), but usually impossible</li>
 <p><li> Must find other error measures that are easier to calculate</li>

<ul>
   <p><li> Derive formulas for \( u \) in (very) special, simplified cases</li>
   <p><li> Compute empirical convergence rates for special choices of \( \uex \)
     (usually non-physical \( \uex \))</li>
</ul>

 <p><li> To what extent does \( \uex \) fulfill \( \mathcal{L}_\Delta(\uex)=0 \)?</li>
 <p><li> It does not fit, but we can measure the error \( \mathcal{L}_\Delta(\uex)=R \)</li>
 <p><li> \( R \) is the truncation error and it is easy to compute
   in general, without considering special cases</li>
</ul>

<!-- !split --><br><br><br><br><br><br><br><br>

<h1 id="trunc:finite:differences">Truncation errors in finite difference formulas</h1>

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="trunc:fd:backward">Example: The backward difference for \( u'(t) \)</h2>

<p>
Backward difference approximation to \( u' \):

$$
\lbrack D_t^- u\rbrack^n  = \frac{u^{n} - u^{n-1}}{\Delta t} \approx u'(t_n)
$$

<p>
Define the truncation error of this approximation as

$$
R^n = [D^-_tu]^n - u'(t_n)
$$

<p>
The common way of calculating \( R^n \) is to

<ol>
<p><li> expand \( u(t) \) in a Taylor series around the point where the
   derivative is evaluated, here \( t_n \),</li>
<p><li> insert this Taylor series in \eqref{trunc:fd:bw3},
   and</li>
<p><li> collect terms that cancel and simplify the expression.</li>
</ol>

<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec5">Taylor series </h2>

<p>
General Taylor series expansion from calculus:

$$ f(x+h) = \sum_{i=0}^\infty \frac{1}{i!}\frac{d^if}{dx^i}(x)h^i$$

<p>
Here: expand \( u^{n-1} \) around \( t_n \):

$$
\begin{align*}
u(t_{n-1}) = u(t-\Delta t) &= \sum_{i=0}^\infty \frac{1}{i!}\frac{d^iu}{dt^i}(t_n)(-\Delta t)^i\\ 
& = u(t_n) - u'(t_n)\Delta t + {\half}u''(t_n)\Delta t^2
+ \Oof{\Delta t^3}
\end{align*}
$$


<ul>
 <p><li> \( \Oof{\Delta t^3} \): power-series in \( \Delta t \) where
   the lowest power is \( \Delta t^3 \)</li>
 <p><li> Small \( \Delta t \): \( \Delta t \gg \Delta t^3 \gg \Delta t^4 \)</li>
</ul>

<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec6">Taylor series inserted in the backward difference approximation </h2>

$$
\begin{align*}
[D_t^-u]^n - u'(t_n) &= \frac{u(t_n) - u(t_{n-1})}{\Delta t} - u'(t_n)\\ 
&= \frac{u(t_n) - (u(t_n) - u'(t_n)\Delta t + {\half}u''(t_n)\Delta t^2 + \Oof{\Delta t^3} )}{\Delta t}\\ 
&\quad -u'(t_n)\\ 
&= -{\half}u''(t_n)\Delta t + \Oof{\Delta t^2} )
\end{align*}
$$

<p>
Result:

$$
R^n = -{\half}u''(t_n)\Delta t + \Oof{\Delta t^2} )
$$

The difference approximation is of
<em>first order</em> in \( \Delta t \). It is exact for linear \( \uex \).

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="trunc:fd:forward">The forward difference for \( u'(t) \)</h2>

<p>
Now consider a forward difference:

$$ u'(t_n) \approx [D_t^+ u]^n = \frac{u^{n+1}-u^n}{\Delta t}$$

Define the truncation error:
$$ R^n = [D_t^+ u]^n - u'(t_n)$$

Expand \( u^{n+1} \) in a Taylor series around \( t_n \),

$$ u(t_{n+1}) = u(t_n) + u'(t_n)\Delta t +
{\half}u''(t_n)\Delta t^2 + \Oof{\Delta t^3}
$$

We get
$$ R = {\half}u''(t_n)\Delta t +
\Oof{\Delta t^2}$$

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="trunc:fd:central">The central difference for \( u'(t) \) (1)</h2>

<p>
For the central difference approximation,

$$ u'(t_n)\approx [ D_tu]^n, \quad [D_tu]^n =
\frac{u^{n+\half} - u^{n-\half}}{\Delta t}
$$

the truncation error is

$$ R^n = [ D_tu]^n - u'(t_n)$$

Expand \( u(t_{n+\half}) \) and
\( u(t_{n-1/2}) \) in Taylor series around the point \( t_n \) where
the derivative is evaluated:
$$
\begin{align*}
u(t_{n+\half}) = &u(t_n) + u'(t_n)\half\Delta t +
{\half}u''(t_n)(\half\Delta t)^2 + \\ 
& \frac{1}{6}u'''(t_n) (\half\Delta t)^3
+ \frac{1}{24}u''''(t_n) (\half\Delta t)^4 + \Oof{\Delta t^5}\\ 
u(t_{n-1/2}) = &u(t_n) - u'(t_n)\half\Delta t +
{\half}u''(t_n)(\half\Delta t)^2 - \\ 
& \frac{1}{6}u'''(t_n) (\half\Delta t)^3
+ \frac{1}{24}u''''(t_n) (\half\Delta t)^4 + \Oof{\Delta t^5}
\end{align*}
$$

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec9">The central difference for \( u'(t) \) (1) </h2>

$$
u(t_{n+\half}) - u(t_{n-1/2}) = u'(t_n)\Delta t + \frac{1}{24}u'''(t_n) \Delta t^3 +  \Oof{\Delta t^5}
\tp
$$

By collecting terms in \( [D_t u]^n - u(t_n) \) we find \( R^n \) to be

$$
R^n = \frac{1}{24}u'''(t_n)\Delta t^2 + \Oof{\Delta t^4}
$$

Note:

<ul>
 <p><li> Second-order accuracy since the leading term is \( \Delta t^2 \)</li>
 <p><li> Only even powers of \( \Delta t \)</li>
</ul>

<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="trunc:table">Leading-order error terms in finite differences (1)</h2>

$$
\begin{align*}
\lbrack D_tu \rbrack^n &= \frac{u^{n+\half} - u^{n-\half}}{\Delta t} = u'(t_n) + R^n\\ 
R^n &= \frac{1}{24}u'''(t_n)\Delta t^2 + \Oof{\Delta t^4}\\ 
\lbrack D_{2t}u \rbrack^n &= \frac{u^{n+1} - u^{n-1}}{2\Delta t} = u'(t_n) + R^n\\ 
R^n &= \frac{1}{6}u'''(t_n)\Delta t^2 + \Oof{\Delta t^4}\\ 
\lbrack D_t^-u \rbrack^n &= \frac{u^{n} - u^{n-1}}{\Delta t} = u'(t_n) + R^n\\ 
R^n &= -{\half}u''(t_n)\Delta t + \Oof{\Delta t^2}\\ 
\lbrack D_t^+u \rbrack^n &= \frac{u^{n+1} - u^{n}}{\Delta t} = u'(t_n) + R^n\\ 
R^n &= {\half}u''(t_n)\Delta t + \Oof{\Delta t^2}
\end{align*}
$$

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec11">Leading-order error terms in finite differences (2) </h2>

$$
\begin{align*}
[\bar D_tu]^{n+\theta} &= \frac{u^{n+1} - u^{n}}{\Delta t} = u'(t_{n+\theta}) + R^{n+\theta}\\ 
R^{n+\theta} &= \half(1-2\theta)u''(t_{n+\theta})\Delta t -
\frac{1}{6}((1 - \theta)^3 - \theta^3)u'''(t_{n+\theta})\Delta t^2 +
\Oof{\Delta t^3}\\ 
\lbrack D_t^{2-}u \rbrack^n &= \frac{3u^{n} - 4u^{n-1} + u^{n-2}}{2\Delta t} = u'(t_n) + R^n\\ 
R^n &= -\frac{1}{3}u'''(t_n)\Delta t^2 + \Oof{\Delta t^3}\\ 
\lbrack D_tD_t u \rbrack^n &= \frac{u^{n+1} - 2u^{n} + u^{n-1}}{\Delta t^2} = u''(t_n) + R^n\\ 
R^n &= \frac{1}{12}u''''(t_n)\Delta t^2 + \Oof{\Delta t^4}\\ 
\end{align*}
$$

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec12">Leading-order error terms in mean values (1) </h2>

<p>
Weighted arithmetic mean:
$$
\begin{align*}
[\overline{u}^{t,\theta}]^{n+\theta}
& = \theta u^{n+1} + (1-\theta)u^n =
u(t_{n+\theta}) + R^{n+\theta}\\ 
R^{n+\theta} &= {\half}u''(t_{n+\theta})\Delta t^2\theta (1-\theta) +
\Oof{\Delta t^3}
\end{align*}
$$

Standard arithmetic mean:

$$
\begin{align*}
[\overline{u}^{t}]^{n} &= \half(u^{n-\half} + u^{n+\half})
= u(t_n) + R^{n}\\ 
R^{n} &= \frac{1}{8}u''(t_{n})\Delta t^2 + \frac{1}{384}u''''(t_n)\Delta t^4
+ \Oof{\Delta t^6}
\end{align*}
$$

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec13">Leading-order error terms in mean values (2) </h2>

<p>
Geometric mean:

$$
\begin{align*}
[\overline{u^2}^{t,g}]^{n} &= u^{n-\half}u^{n+\half} = (u^n)^2 + R^n\\ 
R^n &= - \frac{1}{4}u'(t_n)^2\Delta t^2  + \frac{1}{4}u(t_n)u''(t_n)\Delta t^2
+ \Oof{\Delta t^4}
\end{align*}
$$

<p>
Harmonic mean:

$$
\begin{align*}
[\overline{u}^{t,h}]^{n} &= u^n = \frac{2}{\frac{1}{u^{n-\half}} + \frac{1}{u^{n+\half}}}
+ R^{n+\half}\\ 
R^n &= - \frac{u'(t_n)^2}{4u(t_n)}\Delta t^2 + \frac{1}{8}u''(t_n)\Delta t^2
\end{align*}
$$

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="trunc:sympy">Software for computing truncation errors</h2>

<ul>
 <p><li> Can use <code>sympy</code> to automate calculations with Taylor series.</li>
 <p><li> Tool: course module <code>truncation_errors</code></li>
</ul>

<p>

<!-- code=ipy (!bc ipy) typeset with pygments style "perldoc" -->
<table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">&gt;&gt;&gt; <span style="color: #8B008B; font-weight: bold">from</span> <span style="color: #008b45; text-decoration: underline">truncation_errors</span> <span style="color: #8B008B; font-weight: bold">import</span> TaylorSeries
&gt;&gt;&gt; <span style="color: #8B008B; font-weight: bold">from</span> <span style="color: #008b45; text-decoration: underline">sympy</span> <span style="color: #8B008B; font-weight: bold">import</span> *
&gt;&gt;&gt; u, dt = symbols(<span style="color: #CD5555">&#39;u dt&#39;</span>)
&gt;&gt;&gt; u_Taylor = TaylorSeries(u, <span style="color: #B452CD">4</span>)
&gt;&gt;&gt; u_Taylor(dt)
D1u*dt + D2u*dt**<span style="color: #B452CD">2</span>/<span style="color: #B452CD">2</span> + D3u*dt**<span style="color: #B452CD">3</span>/<span style="color: #B452CD">6</span> + D4u*dt**<span style="color: #B452CD">4</span>/<span style="color: #B452CD">24</span> + u
&gt;&gt;&gt; FE = (u_Taylor(dt) - u)/dt
&gt;&gt;&gt; FE
(D1u*dt + D2u*dt**<span style="color: #B452CD">2</span>/<span style="color: #B452CD">2</span> + D3u*dt**<span style="color: #B452CD">3</span>/<span style="color: #B452CD">6</span> + D4u*dt**<span style="color: #B452CD">4</span>/<span style="color: #B452CD">24</span>)/dt
&gt;&gt;&gt; simplify(FE)
D1u + D2u*dt/<span style="color: #B452CD">2</span> + D3u*dt**<span style="color: #B452CD">2</span>/<span style="color: #B452CD">6</span> + D4u*dt**<span style="color: #B452CD">3</span>/<span style="color: #B452CD">24</span>
</pre></div>
</td></tr></table><p>
Notation: <code>D1u</code> for \( u' \), <code>D2u</code> for \( u'' \), etc.

<p>
See <a href="http://tinyurl.com/nm5587k/trunc/truncation_errors.py" target="_self"><tt>trunc/truncation_errors.py</tt></a>.

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec15">Symbolic computing with difference operators </h2>

<p>
A class <code>DiffOp</code> represents many common difference operators:

<p>

<!-- code=text typeset with pygments style "perldoc" -->
<table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">&gt;&gt;&gt; from truncation_errors import DiffOp
&gt;&gt;&gt; from sympy import *
&gt;&gt;&gt; u = Symbol(&#39;u&#39;)
&gt;&gt;&gt; diffop = DiffOp(u, independent_variable=&#39;t&#39;)
&gt;&gt;&gt; diffop[&#39;geometric_mean&#39;]
-D1u**2*dt**2/4 - D1u*D3u*dt**4/48 + D2u**2*dt**4/64 + ...
&gt;&gt;&gt; diffop[&#39;Dtm&#39;]
D1u + D2u*dt/2 + D3u*dt**2/6 + D4u*dt**3/24
&gt;&gt;&gt; diffop.operator_names()
[&#39;geometric_mean&#39;, &#39;harmonic_mean&#39;, &#39;Dtm&#39;, &#39;D2t&#39;, &#39;DtDt&#39;,
 &#39;weighted_arithmetic_mean&#39;, &#39;Dtp&#39;, &#39;Dt&#39;]
</pre></div>
</td></tr></table><p>
Names in <code>diffop</code>:
<code>Dtp</code> for \( D^+_t \), <code>Dtm</code> for \( D_t^- \), <code>Dt</code> for \( D_t \), <code>D2t</code> for
\( D_{2t} \), <code>DtDt</code> for \( D_tD_t \).

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h1 id="trunc:decay">Truncation errors in exponential decay ODE</h1>

$$
u'(t)=-au(t)
$$

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="trunc:decay:FE">Truncation error of the Forward Euler scheme</h2>

<p>
The Forward Euler scheme:

$$
\lbrack D_t^+ u = -au \rbrack^n
\tp
$$

Definition of the truncation error \( R^n \):

$$
\lbrack D_t^+ \uex + a\uex = R \rbrack^n
\tp
$$

From \eqref{trunc:table:fd1:fw:eq}-\eqref{trunc:table:fd1:fw}:
$$ [D_t^+ \uex]^n = \uex'(t_n) +
\half\uex''(t_n)\Delta t + \Oof{\Delta t^2}\tp$$

Inserted in \eqref{trunc:decay:FE:uex}:
$$
\uex'(t_n) +
\half\uex''(t_n)\Delta t + \Oof{\Delta t^2}
+ a\uex(t_n) = R^n
\tp
$$

Note: \( \uex'(t_n) + a\uex^n = 0 \) since \( \uex \) solves the ODE. Then
$$
R^n = \half\uex''(t_n)\Delta t + \Oof{\Delta t^2}
\tp
$$

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="trunc:decay:CN">Truncation error of the Crank-Nicolson scheme</h2>

<p>
Crank-Nicolson:
$$
[D_t u = -au]^{n+\half}
$$

Truncation error:

$$
[D_t \uex + a\overline{\uex}^{t} = R]^{n+\half}
$$

<p>
From \eqref{trunc:table:fd1:center:eq}-\eqref{trunc:table:fd1:center} and \eqref{trunc:table:avg:arith:eq}-\eqref{trunc:table:avg:arith}:

$$
\begin{align*}
\lbrack D_t\uex \rbrack^{n+\half} &= u'(t_{n+\half}) +
\frac{1}{24}\uex'''(t_{n+\half})\Delta t^2 + \Oof{\Delta t^4}\\ 
[a\overline{\uex}^{t}]^{n+\half}
&= u(t_{n+\half}) + \frac{1}{8}u''(t_{n})\Delta t^2 +
+ \Oof{\Delta t^4}
\end{align*}
$$

Inserted in the scheme we get
$$
R^{n+\half} = \left(
\frac{1}{24}\uex'''(t_{n+\half}) + \frac{1}{8}u''(t_{n})
\right)\Delta t^2 + \Oof{\Delta t^4}
$$

\( R^n = \Oof{\Delta t^2} \) (second-order scheme)

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec19">Test the understanding! </h2>

<p>
Analyze the the truncation error of the Backward Euler scheme
and show that it is \( \Oof{\Delta t} \) (first order scheme).

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="trunc:decay:theta">Truncation error of the \( \theta \)-rule</h2>

<p>
The \( \theta \)-rule:
$$
[\bar D_t u = -a\overline{u}^{t,\theta}]^{n+\theta}
\tp
$$

<p>
Truncation error:
$$
[\bar D_t \uex  + a\overline{\uex}^{t,\theta} = R]^{n+\theta}
\tp
$$

Use \eqref{trunc:table:fd1:theta:eq}-\eqref{trunc:table:fd1:theta} and \eqref{trunc:table:avg:theta:eq}-\eqref{trunc:table:avg:theta} along with
\( \uex'(t_{n+\theta}) + a\uex(t_{n+\theta})=0 \) to show

<p>
<!-- -D2u*a*dt**2*theta**2/2 + D2u*a*dt**2*theta/2 - D2u*dt*theta + D2u*dt/2  + D3u*dt**2*theta**2/2 - D3u*dt**2*theta/2 + D3u*dt**2/6 -->

$$
\begin{align}
R^{n+\theta}
=
&({\half}-\theta)\uex''(t_{n+\theta})\Delta t +
\half\theta (1-\theta)\uex''(t_{n+\theta})\Delta t^2 + \nonumber\\ 
& \half(\theta^2 -\theta + 3)\uex'''(t_{n+\theta})\Delta t^2
+ \Oof{\Delta t^3}
\label{_auto1}
\end{align}
$$

Note: 2nd-order scheme if and only if \( \theta =1/2 \).

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="trunc:decay:software">Using symbolic software</h2>

<p>
Can use <code>sympy</code> and the tools in
<a href="http://tinyurl.com/nm5587k/trunc/truncation_errors.py" target="_self"><tt>truncation_errors.py</tt></a>:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"><span style="color: #8B008B; font-weight: bold">def</span> <span style="color: #008b45">decay</span>():
    u, a = sm.symbols(<span style="color: #CD5555">&#39;u a&#39;</span>)
    diffop = DiffOp(u, independent_variable=<span style="color: #CD5555">&#39;t&#39;</span>,
                    num_terms_Taylor_series=<span style="color: #B452CD">3</span>)
    D1u = diffop.D(<span style="color: #B452CD">1</span>)   <span style="color: #228B22"># symbol for du/dt</span>
    ODE = D1u + a*u     <span style="color: #228B22"># define ODE</span>

    <span style="color: #228B22"># Define schemes</span>
    FE = diffop[<span style="color: #CD5555">&#39;Dtp&#39;</span>] + a*u
    CN = diffop[<span style="color: #CD5555">&#39;Dt&#39;</span> ] + a*u
    BE = diffop[<span style="color: #CD5555">&#39;Dtm&#39;</span>] + a*u
    <span style="color: #228B22"># Residuals (truncation errors)</span>
    R = {<span style="color: #CD5555">&#39;FE&#39;</span>: FE-ODE, <span style="color: #CD5555">&#39;BE&#39;</span>: BE-ODE, <span style="color: #CD5555">&#39;CN&#39;</span>: CN-ODE}
    <span style="color: #8B008B; font-weight: bold">return</span> R
</pre></div>
</td></tr></table><p>
The returned dictionary becomes

<p>

<!-- code=text typeset with pygments style "perldoc" -->
<table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%">1
2
3
4
5</pre></div></td><td class="code"><div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">decay: {
 &#39;BE&#39;: D2u*dt/2 + D3u*dt**2/6,
 &#39;FE&#39;: -D2u*dt/2 + D3u*dt**2/6,
 &#39;CN&#39;: D3u*dt**2/24,
}
</pre></div>
</td></tr></table><p>
\( \theta \)-rule: see <code>truncation_errors.py</code> (long expression, very advantageous
to automate the math!)

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="trunc:decay:estimate:R">Empirical verification of the truncation error (1)</h2>

<p>
Ideas:

<ul>
 <p><li> Compute \( R^n \) numerically</li>
 <p><li> Run a sequence of meshes</li>
 <p><li> Estimate the convergence rate of \( R^n \)</li>
</ul>

For the Forward Euler scheme:

$$
R^n = \lbrack D_t^+\uex + a\uex \rbrack^n
\tp
$$

Insert correct \( \uex(t)=Ie^{-at} \) (or use method of manufactured solution
in more general cases).

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec23">Empirical verification of the truncation error (2) </h2>

<ul>
 <p><li> Assume \( R^n = C\Delta t^r \)</li>
 <p><li> \( C \) and \( r \) will vary with \( n \) - must estimate
   \( r \) for each mesh point</li>
 <p><li> Use a sequence of meshes with \( N_t = 2^{-k}N_0 \) intervals, \( k=1,2,\ldots \)</li>
 <p><li> Transform \( R^n \) data to the coarsest mesh and estimate \( r \) for
   each coarse mesh point</li>
</ul>

See the <a href="http://tinyurl.com/opdfafk/pub/sphinx-trunc/index.html" target="_self">text</a>
for more details and an implementation.

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec24">Empirical verification of the truncation error in the Forward Euler scheme </h2>

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 1:  Estimated truncation error at mesh points for different meshes. <div id="trunc:fig:FE:rates"></div> </p></center>
<p><img src="fig-trunc/R_series.png" align="bottom" width=400></p>
</center>

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec25">Empirical verification of the truncation error in the Forward Euler scheme </h2>

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 2:  Difference between theoretical and estimated truncation error at mesh points for different meshes. <div id="trunc:fig:FE:error"></div> </p></center>
<p><img src="fig-trunc/R_error.png" align="bottom" width=400></p>
</center>

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="trunc:decay:corr">Increasing the accuracy by adding correction terms</h2>

<p>
<div class="alert alert-block alert-question alert-text-normal">
<b>Question.</b>
<p>
Can we add terms in the differential equation
that can help increase the order of the truncation error?

<p>
To be precise for the Forward Euler scheme, can we find \( C \)
to make \( R \) $\Oof{\Delta t^2}$?

$$
\lbrack D_t^+ \uex + a\uex = C + R \rbrack^n\tp
$$
</div>


$$
\half\uex''(t_n)\Delta t - \frac{1}{6}\uex'''(t_n)\Delta t^2
+ \Oof{\Delta t^3}  = C^n + R^n\tp$$

Choosing

$$ C^n = \half\uex''(t_n)\Delta t$$

makes

$$ R^n = \frac{1}{6}\uex'''(t_n)\Delta t^2 + \Oof{\Delta t^3}\tp$$

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec27">Lowering the order of the derivative in the correction term </h2>

<ul>
 <p><li> \( C^n \) contains \( u'' \)</li>
 <p><li> Can discretize \( u'' \) (requires \( u^{n+1} \), \( u^n \), and \( u^{n-1} \))</li>
 <p><li> Can also express \( u'' \) in terms of \( u' \) or \( u \)</li>
</ul>

$$ u' = -au,\quad\Rightarrow\quad u''=-au'=a^2u\tp$$

Result for \( u''=a^2u \): apply Forward Euler to a <em>perturbed ODE</em>,

$$
u' = -\hat au ,\quad \hat a = a(1 - {\half}a\Delta t)
$$

to make a second-order scheme!

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec28">With a correction term Forward Euler becomes Crank-Nicolson </h2>

<p>
Use the other alternative \( u''=-au' \):

$$ u'=-au - {\half}a\Delta t u'\quad\Rightarrow\quad
\left( 1 + {\half}a\Delta t\right) u' = -au\tp$$

Apply Forward Euler:

$$
\left( 1 + {\half}a\Delta t\right)\frac{u^{n+1}-u^n}{\Delta t}
= -au^n$$

which after some algebra can be written as

$$ u^{n+1} = \frac{1 - {\half}a\Delta t}{1+{\half}a\Delta t}u^n\tp$$

This is a Crank-Nicolson scheme (of second order)!

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec29">Correction terms in the Crank-Nicolson scheme (1) </h2>

$$ [D_t u = -a\overline{u}^t]^{n+\half}$$

Definition of the truncation error \( R \) and correction terms \( C \):

$$ [D_t \uex + a\overline{\uex}^{t} = C + R]^{n+\half}\tp$$

<p>
Must Taylor expand

<ul>
 <p><li> the derivative</li>
 <p><li> the arithmetic mean</li>
</ul>

$$
C^{n+\half} + R^{n+\half} =
\frac{1}{24}\uex'''(t_{n+\half})\Delta t^2
+ \frac{a}{8}\uex''(t_{n+\half})\Delta t^2 + \Oof{\Delta t^4}\tp$$

Let \( C^{n+\half} \) cancel the \( \Delta t^2 \) terms:

$$ C^{n+\half} =
\frac{1}{24}\uex'''(t_{n+\half})\Delta t^2
+ \frac{a}{8}\uex''(t_{n})\Delta t^2\tp$$

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec30">Correction terms in the Crank-Nicolson scheme (2) </h2>

<ul>
 <p><li> Must replace \( u''' \) and \( u'' \) in correction term</li>
 <p><li> Using \( u'=-au \): \( u''=a^2u \) and \( u'''=-a^3u \)</li>
</ul>

Result: solve the perturbed ODE by a Crank-Nicolson method,

$$ u' = -\hat a u,\quad \hat a = a(1 - \frac{1}{12}a^2\Delta t^2)\tp$$

and experience an error \( \Oof{\Delta t^4} \).

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec31">Extension to variable coefficients </h2>

$$ u'(t) = -a(t)u(t) + b(t)$$

<p>
Forward Euler:

$$
[D_t^+ u = -au + b]^n
\tp
$$

The truncation error is found from

$$
[D_t^+ \uex + a\uex - b = R]^n
\tp
$$

Using \eqref{trunc:table:fd1:fw:eq}-\eqref{trunc:table:fd1:fw}:

$$ \uex'(t_n) - \half\uex''(t_n)\Delta t + \Oof{\Delta t^2}
+ a(t_n)\uex(t_n) - b(t_n) = R^n
\tp
$$

Because of the ODE, \( \uex'(t_n) + a(t_n)\uex(t_n) - b(t_n) =0 \), and

$$
R^n = -\half\uex''(t_n)\Delta t + \Oof{\Delta t^2}
\tp
$$

No problems with variable coefficients!

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec32">Exact solutions of the finite difference equations </h2>

<p>
How does the truncation error depend on \( \uex \) in finite differences?

<ul>
 <p><li> One-sided differences: \( \uex''\Delta t \) (lowest order)</li>
 <p><li> Centered differences: \( \uex'''\Delta t^2 \) (lowest order)</li>
 <p><li> Only harmonic and geometric mean involve \( \uex' \) or \( \uex \)</li>
</ul>

Consequence:

<ul>
 <p><li> \( \uex(t)=ct+d \) will very often give exact solution
   of the discrete equations (\( R=0 \))!</li>
 <p><li> Ideal for verification</li>
 <p><li> Centered schemes allow quadratic \( \uex \)</li>
</ul>

Problem: harmonic and geometric mean (error depends on \( \uex' \) and \( \uex \))

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="trunc:decay:gen">Computing truncation errors in nonlinear problems (1)</h2>

$$
u'=f(u,t)
$$

Crank-Nicolson scheme:

$$
[D_t u =\overline{f}^{t}]^{n+\half}
$$

Truncation error:

$$
[D_t \uex - \overline{f}^{t}= R]^{n+\half}\tp
$$

Using \eqref{trunc:table:avg:arith:eq}-\eqref{trunc:table:avg:arith} for the arithmetic mean:

$$
\begin{align*}
\lbrack\overline{f}^{t}\rbrack^{n+\half} &=
\half(f(\uex^n,t_n) + f(\uex^{n+1},t_{n+1}))\\ 
&= f(\uex^{n+\half},t_{n+\half}) +
\frac{1}{8}\uex''(t_{n+\half})\Delta t^2
+ \Oof{\Delta t^4}\tp
\end{align*}
$$

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec34">Computing truncation errors in nonlinear problems (2) </h2>

<p>
With \eqref{trunc:table:fd1:center:eq}-\eqref{trunc:table:fd1:center}, \eqref{trunc:decay:gen:ode:CN} leads to
\( R^{n+\half} \) equal to

$$
\uex'(t_{n+\half}) +
\frac{1}{24}\uex'''(t_{n+\half})\Delta t^2
- f(\uex^{n+\half},t_{n+\half}) -
\frac{1}{8}\uex''(t_{n+\half})\Delta t^2
+ \Oof{\Delta t^4} \tp
$$

Since \( \uex'(t_{n+\half}) - f(\uex^{n+\half},t_{n+\half})=0 \),
the truncation error becomes

$$ R^{n+\half} = (\frac{1}{24}\uex'''(t_{n+\half})
- \frac{1}{8}\uex''(t_{n+\half})) \Delta t^2\tp
$$

The computational techniques worked well
even for this <em>nonlinear</em> ODE!

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h1 id="trunc:vib">Truncation errors in vibration ODEs</h1>

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec36">Linear model without damping </h2>

$$
u''(t) + \omega^2 u(t) = 0,\quad u(0)=I,\ u'(0)=0\tp
$$

Centered difference approximation:

$$
[D_tD_t u + \omega^2u=0]^n
$$

Truncation error:

$$
[D_tD_t \uex + \omega^2\uex =R]^n
\tp
$$

Use \eqref{trunc:table:fd2:center:eq}-\eqref{trunc:table:fd2:center} to expand \( [D_t D_t\uex]^n \):

$$ [D_tD_t \uex]^n = \uex''(t_n) + \frac{1}{12}\uex''''(t_n)\Delta t^2$$

Collect terms: \( \uex''(t) + \omega^2\uex(t)=0 \). Then,

$$
R^n =  \frac{1}{12}\uex''''(t_n)\Delta t^2 + \Oof{\Delta t^4}
\tp
$$

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec37">Truncation errors in the initial condition </h2>

<ul>
 <p><li> Initial conditions: \( u(0)=I \), \( u'(0)=V \)</li>
 <p><li> Need discretization of \( u'(0) \)</li>
 <p><li> Standard, centered difference: \( [D_{2t} u=V]^0 \), \( R^0=\Oof{\Delta t^2} \)</li>
 <p><li> Simpler, forward difference: \( [D_t^+u=V]^0 \), \( R^0=\Oof{\Delta t} \)</li>
 <p><li> Does the lower order of the forward scheme impact the order of
   the whole simulation?</li>
 <p><li> Answer: run experiments!</li>
</ul>

<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec38">Computing correction terms </h2>

<ul>
 <p><li> Can we add terms to the ODE such that the truncation error
   is improved?</li>
</ul>

$$ [D_tD_t \uex + \omega^2\uex =C + R]^n$$


<ul>
 <p><li> Idea: choose \( C^n \) such that it absorbs the \( \Delta t^2 \) term in \( R^n \),</li>
</ul>

$$ C^n = \frac{1}{12}\uex''''(t_n)\Delta t^2\tp$$


<ul>
 <p><li> Downside: got a \( u'''' \) term</li>
 <p><li> Remedy: use the ODE \( u''=-\omega^2u \) to see that \( u'''' = \omega^4 u \).</li>
 <p><li> Just apply the standard scheme to a modified ODE:</li>
</ul>

$$ [D_tD_t u + \omega^2(1 - \frac{1}{12}\omega^2\Delta t^2)u=0]^n$$


<ul>
 <p><li> Accuracy is \( \Oof{\Delta t^4} \).</li>
</ul>

<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="trunc:vib:gen">Model with damping and nonlinearity</h2>

<p>
Linear damping \( \beta u' \), nonlinear spring force \( s(u) \), and excitation \( F \):

$$
mu'' + \beta u' + s(u) =F(t)
$$

Central difference discretization:

$$
[mD_tD_t u + \beta D_{2t} u + s(u)=F]^n
\tp
$$

Truncation error is defined by

$$
[mD_tD_t \uex + \beta D_{2t} \uex + s(\uex)=F + R]^n
\tp
$$

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec40">Carrying out the truncation error analysis </h2>

<p>
Using \eqref{trunc:table:fd2:center:eq}-\eqref{trunc:table:fd2:center} and \eqref{trunc:table:fd1:center2:eq}-\eqref{trunc:table:fd1:center2} we
get

$$
\begin{align*}
\lbrack mD_tD_t \uex + \beta D_{2t} \uex\rbrack^n &=
m\uex''(t_n) + \beta\uex'(t_n) + \\ 
&\quad \left(\frac{m}{12}\uex''''(t_n) +
  \frac{\beta}{6}\uex'''(t_n)\right)\Delta t^2 + \Oof{\Delta t^4}
\end{align*}
$$

The terms
$$ m\uex''(t_n) + \beta\uex'(t_n) + \omega^2\uex(t_n) + s(\uex(t_n)) - F^n$$

correspond to the ODE (= zero).

<p>
Result: accuracy of \( \Oof{\Delta t^2} \) since
$$
R^n = \left(\frac{m}{12}\uex''''(t_n) +
  \frac{\beta}{6}\uex'''(t_n)\right)\Delta t^2 + \Oof{\Delta t^4}
$$

<p>
Correction terms: complicated when the ODE has many terms...

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec41">Extension to quadratic damping </h2>

$$
mu'' + \beta |u'|u' + s(u) =F(t)
$$

Centered scheme: \( |u'|u' \) gives rise to a nonlinearity.

<p>
Linearization trick: use a geometric mean,

$$ [|u'|u']^n \approx |[u']^{n-\half}|[u']^{n+\half}\tp$$

<p>
Scheme:

$$
[mD_t D_t u]^n + \beta |[D_{t} u]^{n-\half}|[D_t u]^{n+\half}
+ s(u^n)=F^n\tp
$$

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec42">The truncation error for quadratic damping (1) </h2>

<p>
Definition of \( R^n \):

$$
[mD_t D_t \uex]^n +
\beta |[D_{t} \uex]^{n-\half}|[D_t \uex]^{n+\half}
+ s(\uex^n)-F^n = R^n\tp
$$

<p>
Truncation error of the geometric mean, see \eqref{trunc:table:avg:geom:eq}-\eqref{trunc:table:avg:geom},

$$
\begin{align*}
|[D_{t} \uex]^{n-\half}|[D_t \uex]^{n+\half}
&= [|D_t\uex|D_t\uex]^n
- \frac{1}{4}u'(t_n)^2\Delta t^2  + \\ 
&\quad \frac{1}{4}u(t_n)u''(t_n)\Delta t^2
+ \Oof{\Delta t^4}\tp
\end{align*}
$$

Using \eqref{trunc:table:fd1:center:eq}-\eqref{trunc:table:fd1:center} for the \( D_t\uex \) factors results in

$$
\begin{align*}
[|D_t\uex|D_t\uex]^n &= |\uex' + \frac{1}{24}\uex'''(t_n)\Delta t^2 +
\Oof{\Delta t^4}|\times\\ 
&\quad (\uex' + \frac{1}{24}\uex'''(t_n)\Delta t^2 +
\Oof{\Delta t^4})
\end{align*}
$$

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec43">The truncation error for quadratic damping (2) </h2>

<p>
For simplicity, remove the absolute value. The product becomes

$$
[D_t\uex D_t\uex]^n = (\uex'(t_n))^2 +
\frac{1}{12}\uex(t_n)\uex'''(t_n)\Delta t^2 +
\Oof{\Delta t^4}\tp$$

<p>
With

$$ m[D_t D_t\uex]^n = m\uex''(t_n) + \frac{m}{12}\uex''''(t_n)\Delta t^2
+\Oof{\Delta t^4}$$

and using \( mu'' + \beta (u')^2 + s(u)=F \), we end up with

$$ R^n = (\frac{m}{12}\uex''''(t_n) +
\frac{\beta}{12}\uex(t_n)\uex'''(t_n))
\Delta t^2 + \Oof{\Delta t^4}\tp$$

Second-order accuracy! Thanks to

<ul>
 <p><li> difference approximation with error \( \Oof{\Delta t^2} \)</li>
 <p><li> geometric mean approximation with error \( \Oof{\Delta t^2} \)</li>
</ul>

<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="trunc:vib:gen:staggered">The general model formulated as first-order ODEs</h2>

$$
mu'' + \beta |u'|u' + s(u) =F(t)
$$

Rewritten as first-order system:

$$
\begin{align*}
u' &= v\\ 
v' &= \frac{1}{m}\left( F(t) - \beta |v|v - s(u)\right)
\end{align*}
$$

<p>
To solution methods:

<ul>
 <p><li> Forward-backward scheme</li>
 <p><li> Centered scheme on a staggered mesh</li>
</ul>

<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec45">The forward-backward scheme </h2>

<p>
Forward step for \( u \), backward step for \( v \):

$$
\begin{align*}
[D_t^+ u &= v]^n\\ 
[D_t^-v &= \frac{1}{m}( F(t) - \beta |v|v - s(u))]^{n+1}
\end{align*}
$$


<ul>
 <p><li> Note:</li>

<ul>
   <p><li> step \( u \) forward with known \( v \) in \eqref{trunc:vib:gen:2x2model:ode:u:fw}</li>
   <p><li> step \( v \) forward with known \( u \) in \eqref{trunc:vib:gen:2x2model:ode:v:bw}</li>
</ul>

 <p><li> Problem: \( |v|v \) gives nonlinearity \( |v^{n+1}|v^{n+1} \).</li>
 <p><li> Remedy: linearized as \( |v^{n}|v^{n+1} \)</li>
</ul>

$$
\begin{align*}
[D_t^+ u &= v]^n\\ 
[D_t^-v]^{n+1} &= \frac{1}{m}( F(t_{n+1}) - \beta |v^n|v^{n+1} - s(u^{n+1}))
\end{align*}
$$

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec46">Truncation error analysis </h2>

<ul>
 <p><li> Aim (as always): turn difference operators into derivatives +
   truncation error terms</li>
 <p><li> One-sided forward/backward differences: error \( \Oof{\Delta t} \)</li>
 <p><li> Linearization of \( |v^{n+1}|v^{n+1} \) to \( |v^n|v^{n+1} \):
   error \( \Oof{\Delta t} \)</li>
 <p><li> All errors are \( \Oof{\Delta t} \)</li>
 <p><li> First-order scheme? No!</li>
 <p><li> "Symmetric" use of the \( \Oof{\Delta t} \) building blocks
   yields in fact a \( \Oof{\Delta t^2} \) scheme (!)</li>
 <p><li> Why? See next slide...</li>
</ul>

<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec47">A centered scheme on a staggered mesh </h2>

<p>
Staggered mesh:

<ul>
 <p><li> \( u \) is computed at mesh points \( t_n \)</li>
 <p><li> \( v \) is computed at points \( t_{n+\half} \)</li>
</ul>

Centered differences in \eqref{trunc:vib:gen:2x2model:ode:u}-\eqref{trunc:vib:gen:2x2model:ode:u}:

$$
\begin{align*}
[D_t u &= v]^{n-\half}\\ 
[D_t v &= \frac{1}{m}( F(t) - \beta |v|v - s(u))]^{n}
\end{align*}
$$


<ul>
 <p><li> Problem: \( |v^n|v^n \) because \( v^n \) is not computed directly</li>
 <p><li> Remedy: Geometric mean,</li>
</ul>

$$ |v^n|v^n \approx |v^{n-\half}|v^{n+\half}\tp$$

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec48">Truncation error analysis (1) </h2>

<p>
Resulting scheme:
$$
\begin{align*}
[D_t u]^{n-\half} &= v^{n-\half}\\ 
[D_t v]^n &= \frac{1}{m}( F(t_n) -
\beta |v^{n-\half}|v^{n+\half} - s(u^n))
\end{align*}
$$

<p>
The truncation error in each equation is found from

$$
\begin{align*}
[D_t \uex]^{n-\half} &= \vex(t_{n-\half}) + R_u^{n-\half}\\ 
[D_t \vex]^n &= \frac{1}{m}( F(t_n) -
\beta |\vex(t_{n-\half})|\vex(t_{n+\half}) - s(u^n)) + R_v^n\tp
\end{align*}
$$

Using \eqref{trunc:table:fd1:center:eq}-\eqref{trunc:table:fd1:center} for derivatives and \eqref{trunc:table:avg:geom:eq}-\eqref{trunc:table:avg:geom}
for the geometric mean:

$$
\uex'(t_{n-\half}) +
\frac{1}{24}\uex'''(t_{n-\half})\Delta t^2 + \Oof{\Delta t^4}
= \vex(t_{n-\half}) + R_u^{n-\half}$$

and
$$
\vex'(t_n) =
\frac{1}{m}( F(t_n) -
\beta |\vex(t_n)|\vex(t_n) + \Oof{\Delta t^2} - s(u^n)) + R_v^n\tp
$$

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec49">Truncation error analysis (2) </h2>

<p>
Resulting truncation error is \( \Oof{\Delta t^2} \):

$$ R_u^{n-\half}= \Oof{\Delta t^2}, \quad R_v^n = \Oof{\Delta t^2}\tp$$

<p>
<div class="alert alert-block alert-warning alert-text-normal">
<b>Observation.</b>
<p>

<p>
Comparing
The schemes \eqref{trunc:vib:gen:2x2model:ode:u:staggered2}-\eqref{trunc:vib:gen:2x2model:ode:v:staggered2} and
\eqref{trunc:vib:gen:2x2model:ode:u:fw2}-\eqref{trunc:vib:gen:2x2model:ode:v:bw2}
are equivalent. Therefore, the forward/backward scheme with ad hoc
linearization is also \( \Oof{\Delta t^2} \)!
</div>


<p>
<!-- Wave equations... -->

<!-- ------------------- end of main content --------------- -->


</body>
</html>
    

